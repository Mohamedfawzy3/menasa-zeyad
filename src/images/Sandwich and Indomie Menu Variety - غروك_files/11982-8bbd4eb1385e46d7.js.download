!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="3ef7838b-5c18-4471-969f-d5acc174bdc5",e._sentryDebugIdIdentifier="sentry-dbid-3ef7838b-5c18-4471-969f-d5acc174bdc5")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11982],{2376:(e,t,s)=>{s.d(t,{ru:()=>y,_c:()=>f,sS:()=>I,v5:()=>p});var n=s(28245),o=s(38541),i=s.n(o),r=s(88382),a=s(65146),l=s(6132),d=s(75500);let c=l.z.object({personaId:l.z.string(),prompt:l.z.string().optional()}),u=l.z.object({personaPresets:l.z.array(c)}),h=l.z.union([l.z.literal("imageGen"),l.z.literal("search"),l.z.literal("think"),l.z.literal("deepsearch")]),m=l.z.object({personaId:l.z.string(),name:l.z.string(),systemPromptName:l.z.string(),disclaimer:l.z.string().optional(),disabledTools:h.array(),prompt:l.z.string().optional()});function p(){let{stage:e}=(0,n.Sf)(),{t}=(0,a.Bd)("base"),s=function(){let e=(0,d.h)();return(0,r.useMemo)(()=>{var t;let s=null==(t=e.PERSONAS)?void 0:t.value;if(!s)return{personaPresets:[]};let n=u.safeParse(s);return n.success?n.data:{personaPresets:[]}},[e.PERSONAS])}(),o=(0,r.useMemo)(()=>({news:t("persona-name.news","Latest News"),romance:t("persona-name.romance","Companion"),unhinged:t("persona-name.unhinged","Unhinged Comedian"),friend:t("persona-name.friend","Loyal Friend"),tutor:t("persona-name.tutor","Homework Helper"),doctor:t("persona-name.doctor_with_quotes",'Grok "Doc"'),therapist:t("persona-name.therapist_with_quotes",'"Therapist"'),scientist:t("persona-name.scientist","Scientist"),coder:t("persona-name.coder","Coder")}),[t]),l=(0,r.useMemo)(()=>g.map(e=>({personaId:e,name:o[e],systemPromptName:v[e],disabledTools:[],prompt:function(e,t){let s=t.personaPresets.find(t=>t.personaId===e);return(null==s?void 0:s.prompt)||""}(e,s)})).filter(t=>!y.includes(t.personaId)||"nopass"!==e).map(e=>m.safeParse(e)).filter(e=>e.success).map(e=>e.data),[e,o,s]),c=(0,r.useMemo)(()=>i().keyBy(l,e=>e.personaId),[l]),h=(0,r.useCallback)(e=>{if(!g.includes(e))return;let t=c[e];if(t)return t},[c]),p=(0,r.useCallback)(e=>{if(!e||!e.personaId||!g.includes(e.personaId))return;let t=c[e.personaId];if(t)return t},[c]);return{personas:l,personaById:c,getPersonaForConversation:p,getPersonaFromId:h}}let g=["news","romance","unhinged","friend","tutor","doctor","therapist"],v={doctor:"grok3_personality_medical_advisor",news:"grok3_personality_latest_news",friend:"grok3_personality_loyal_friend",tutor:"grok3_personality_homework_helper",romance:"grok3_personality_romance_me",unhinged:"grok3_personality_unhinged_comedian",therapist:"grok3_personality_trusted_therapist",scientist:"grok3_personality_science_geek",coder:"grok3_personality_cracked_coder"};function f(e){if(!e)return;let t=i().invert(v)[e];if(I(t))return t}function I(e){return!!e&&g.includes(e)}let y=["romance","unhinged"]},4295:(e,t,s)=>{s.d(t,{c:()=>o,f:()=>i});var n=s(88382);function o(){let[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{let e=navigator.userAgent||navigator.vendor;t(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e))};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}function i(){let e=navigator.userAgent||navigator.vendor;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}},5663:(e,t,s)=>{s.d(t,{Bq:()=>a,He:()=>u,Ib:()=>o,VP:()=>r,Xo:()=>i,_1:()=>d,cZ:()=>l,dd:()=>c}),s(79342);var n=s(65146);let o="cmd+j, ctrl+j",i="cmd+shift+j, ctrl+shift+j",r="cmd+k, ctrl+shift+k",a="cmd+enter, ctrl+enter",l="cmd+,, ctrl+,",d="cmd+shift+p, ctrl+shift+p",c="cmd+s, ctrl+s",u="cmd+shift+m, ctrl+shift+m";n.x6,n.x6,n.x6,n.x6,n.x6,n.x6},5790:(e,t,s)=>{s.d(t,{iV:()=>c});var n=s(40764),o=s(4778),i=s(65258);let r=["home","account","appearance","chat","personality","data","billing","dev","behavior","billing","connected-apps"];var a=new WeakSet;class l{constructor(e,t){var s,l;if((0,o._)(this,a),this.set=e,this.get=t,this.open=!1,this.tab="home",this.expanded=!1,this.modelConfigOverrideTab=void 0,this.setOpen=e=>{this.set(t=>({...t,open:e})),(0,n._)(this,a,d).call(this,e)},this.toggleOpen=()=>{let e=!this.get().open;this.set(t=>({...t,open:e})),(0,n._)(this,a,d).call(this,e)},this.setTab=e=>{this.set({tab:e}),(0,n._)(this,a,d).call(this,this.get().open,e)},this.toggleExpanded=()=>{this.set(e=>({...e,expanded:!e.expanded}))},this.setModelConfigOverrideTab=(0,i.kp)(this.set,"modelConfigOverrideTab"),!(null==(l=globalThis)||null==(s=l.window)?void 0:s.location))return;let c=new URL(window.location.href).searchParams.get("_s");if(!function(e){return!!e&&r.includes(e)}(c))return;this.open=!0,this.tab=c}}function d(e,t){let s=new URL(window.location.href);e?s.searchParams.set("_s",null!=t?t:this.get().tab):s.searchParams.delete("_s"),window.history.replaceState({},"",s.toString())}let c=(0,i.y$)(l,"useSettingsDialogStore");(0,i.CP)(c,"expanded","settings-dialog-expanded",!1)},12971:(e,t,s)=>{s.d(t,{om:()=>U,BV:()=>q,DD:()=>F});var n=s(79342),o=s(38614),i=s(58192),r=s(5663),a=s(75500),l=s(33231),d=s(23232),c=s(98100),u=s(88382),h=s(41320);let m=e=>{let{onClick:t=()=>{}}=e,s=(0,h.Di)();(0,u.useEffect)(()=>{if(s)return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[s])};var p=s(24429),g=s(17703),v=s(61312),f=s(29938),I=s(44347),y=s(58711),S=s(40251),C=s(72359),w=s(74796),b=s(2034),x=s(33846),k=s(84969),_=s(16506),R=s(39116),M=s(74995),T=s(65146),P=s(39945),E=s(42557),N=s(5790),B=s(56691),V=s(73772),A=s(69648),j=s(35819),L=s(61884),z=s(38997);function U(){var e;let t=(0,a.h)(),{t:s}=(0,T.Bd)("base"),[h,p]=(0,C.Mj)("model-select-tutorial-4",!1),w=(0,d._)(),{models:b,unavailableModels:x,modelById:k,isPending:_}=(0,c.GB)(),R=(0,o.aP)(M.A("activeModelId")),E=(0,o.aP)(M.A("setActiveModelId")),z=(0,o.aP)(M.A("outputMode")),U=(0,o.aP)(M.A("setOutputMode")),F=(0,o.aP)(M.A("reasoningMode")),H=(0,I.C$)(e=>e.userSettings.preferences.selectedSystemPromptId),q=(0,f.jN)(e=>H?e.byId[H]:void 0),G=(0,N.iV)(M.A("setOpen")),Z=(0,N.iV)(M.A("setTab")),Q=(0,u.useCallback)(()=>{Z("personality"),G(!0)},[G,Z]);m({onClick:()=>p(!0)});let W=(0,u.useCallback)(e=>{w("set_model",e,{location:"query-bar"}),E(e)},[w,E]);(0,l.v)(r.He,()=>{if(b.length>1){let e=b.findIndex(e=>e.modelId===R),t=-1===e||e===b.length-1?0:e+1;W(b[t].modelId)}return!1},[b,R,W]);let K=(0,u.useMemo)(()=>{if(_)return i.oQ;let e=k[R];if(!e){(0,g.vV)("model-select:ModelSelect:prettyActiveModelName","Model ID ".concat(R," not found."));let e=Object.values(k)[0];return e?(E(e.modelId),e.name||i.oQ):i.oQ}return e.name||i.oQ},[k,R,_,E]),$=(0,u.useMemo)(()=>{var e;let t=k[R];return!!t&&!(null==(e=t.tags)?void 0:e.includes("hide_tools_settings"))},[k,R]),J=(0,u.useCallback)(e=>{let s;e.preventDefault(),w("switch_tools",s=t.TOGGLE_SEARCH_ONLY?"noSearch"===z?"auto":"noSearch":"modelOnly"===z?"auto":"modelOnly",{location:"model-select:handleToggleTools"}),U(s)},[z,w,t.TOGGLE_SEARCH_ONLY,U]),[Y,X]=(0,u.useState)(!1),ee=(0,u.useMemo)(()=>b.some(e=>e.modelId.startsWith("grok-4")),[b]),et=(0,u.useCallback)(e=>{h||p(!0),X(e)},[h,p]),es=(0,u.useId)(),{isUpselling:en}=(0,y.e)(),eo="deepsearch"===F||"auto"===(e=z)||"image"===e||"search"===e;return(0,n.jsxs)(V.rI,{open:Y,onOpenChange:et,children:[(0,n.jsx)(V.ty,{asChild:!0,children:(0,n.jsxs)(B.gx,{className:"border border-border-l2 sm:border-0",variant:"ghost",rounded:!0,tooltipProps:{open:ee&&!h&&!en},tooltipContentProps:{side:"bottom",align:"end",className:L.Gv},tooltipContent:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.i3,{className:"fill-primary"}),(0,n.jsx)("p",{className:"text-sm font-semibold",children:s("Grok 4 Enabled","Grok 4 Enabled")}),(0,n.jsx)("p",{className:"text-xs text-primary-foreground/60",children:s("You have the most powerful model available","You have the most powerful model available")})]}),children:[(0,n.jsx)("span",{className:"inline-block text-primary text-xs @[400px]/input:text-sm",children:K}),eo?null:(0,n.jsx)(P.qd,{className:"size-3 text-secondary"}),q?(0,n.jsx)(P.Wz,{className:"size-3 text-secondary"}):null,(0,n.jsx)(P.D3,{className:"size-3 text-secondary transition-transform ".concat(Y&&"rotate-180")})]})}),(0,n.jsxs)(V.SQ,{side:"bottom",align:"end",sideOffset:6,alignOffset:-5,className:"flex flex-col",children:[!t.HIDE_MODEL_SELECT_UPSELL&&(0,n.jsx)(O,{handleOpenChange:et,unavailableModels:x}),b.map(e=>{var t;return(0,n.jsx)(V._2,{className:(0,v.cn)("group/output-mode cursor-pointer",{"no-siblings-highlighted":e.modelId===R}),onClick:()=>W(e.modelId),children:(0,n.jsx)(D,{name:e.name||e.modelId,badgeText:null==(t=e.badgeText)?void 0:t.trim(),description:e.description})},e.modelId)}),(0,n.jsx)(A.w,{className:"my-1 self-center w-[90%] bg-secondary/25"}),(0,n.jsxs)(V._2,{className:(0,v.cn)("group/custom-instructions min-w-64 flex flex-row items-center gap-4 justify-between px-3 py-2"),onClick:Q,children:[(0,n.jsxs)("div",{className:"flex flex-col items-start",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-1 ",children:[(0,n.jsx)(P.Wz,{className:"size-4 text-secondary"}),(0,n.jsx)("span",{className:"font-semibold text-primary text-xs",children:s("model-select.custom-instructions","Custom Instructions")})]}),(0,n.jsx)("span",{className:"text-secondary text-xs truncate max-w-64",children:q?(0,f.Uk)(q.personalityId)?q.prompt:q.name:s("model-select.custom-instructions.description.not-set","Not set")})]}),q?(0,n.jsx)(P.vK,{className:"size-4 text-secondary"}):(0,n.jsx)(B.$n,{"aria-label":s("model-select.custom-instructions.open","Open Custom Instructions"),variant:"outline",size:"sm",rounded:!0,className:"group-hover/custom-instructions:bg-button-ghost-hover duration-0",onClick:e=>{e.stopPropagation(),Q()},children:s("model-select.custom-instructions.button","Customize")})]}),$&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.w,{className:"my-1 self-center w-[90%] bg-secondary/25"}),(0,n.jsxs)("div",{className:"min-w-64 flex flex-row items-center justify-between px-3 py-2",role:"menuitem",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start text-xs",children:[(0,n.jsxs)("span",{className:"flex flex-row items-center gap-1 text-xs font-semibold text-primary",id:es,children:[eo?(0,n.jsx)(P.fC,{className:"size-4 text-secondary"}):(0,n.jsx)(P.qd,{className:"size-4 text-secondary"}),t.TOGGLE_SEARCH_ONLY?s("Enable Search","Enable Search"):s("Enable Search and Images","Enable Search and Images")]}),(0,n.jsx)("span",{className:"me-2 text-xs text-secondary",children:"deepsearch"===F?s("Auto-enabled for DeepSearch","Auto-enabled for DeepSearch"):s("Grok can browse the web","Grok can browse the web")})]}),(0,n.jsx)(j.d,{"aria-labelledby":es,checked:eo,onClick:J,className:"deepsearch"===F?"opacity-30 cursor-not-allowed":void 0})]})]})]})]})}function D(e){let{name:t,badgeText:s,description:o,buttonText:i,buttonClassName:r}=e;return(0,n.jsxs)("div",{className:"flex flex-row items-center justify-between w-full gap-2",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,n.jsx)("span",{className:"font-semibold text-primary",children:t}),(null==s?void 0:s.trim())&&(0,n.jsx)("div",{className:"px-[5px] rounded-full text-[10px] text-secondary bg-[#D6DAE3] dark:bg-white/10",children:null==s?void 0:s.trim()})]}),(0,n.jsx)("span",{className:"text-sm text-secondary",children:o})]}),i&&(0,n.jsx)(B.$n,{variant:"filled",size:"sm",className:r,rounded:!0,children:i})]})}function O(e){let{handleOpenChange:t,unavailableModels:s}=e,{t:o}=(0,T.Bd)("base"),{resolvedTheme:i}=(0,_.D)(),{bestSubscription:r}=(0,p.Q2)(),a=(0,y.e)(M.A("setIsUpselling")),l=(0,y.e)(M.A("setTargetTier")),{user:d}=(0,E.wV)(),c=(0,R.useRouter)(),h=(0,u.useCallback)(e=>{d?(l(e),a(!0),t(!1)):c.push("/sign-in")},[t,l,a,d,c]);if(0===s.length)return null;switch(r){case p.i.SuperGrokPro:return null;case p.i.SuperGrok:return(0,n.jsx)(n.Fragment,{children:s.map(e=>(0,n.jsx)(V._2,{className:"group flex flex-col items-start",onClick:()=>h(p.i.SuperGrokPro),children:(0,n.jsx)(D,{name:e.name||e.modelId,description:e.description,buttonText:o("model-select.upsell.heavy-button","Get SuperGrok Heavy"),buttonClassName:"group-hover:bg-button-filled-hover"})},e.modelId))});default:return(0,n.jsxs)(V._2,{className:"group/model-select-upsell relative rounded-2xl bg-surface-l3 border-2 border-border-l2  flex flex-col items-start p-0 mb-1",onClick:()=>h(p.i.SuperGrok),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&h(p.i.SuperGrok)},children:[s.map(e=>(0,n.jsx)("div",{className:"flex flex-col items-start px-3 py-2",children:(0,n.jsx)(D,{name:e.name||e.modelId,description:e.description})},e.modelId)),(0,n.jsx)("div",{className:"absolute inset-0 backdrop-blur-md rounded-2xl flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full px-4 text-center",children:[(0,n.jsx)(z.iM,{className:"h-8 -mt-2",isDark:"dark"===i}),(0,n.jsx)("span",{className:"text-sm text-secondary mb-2",children:o("model-select.upsell.description","Unlock Grok 4 and more")}),(0,n.jsx)(B.$n,{variant:"filled",size:"sm",rounded:!0,className:"group-hover/model-select-upsell:bg-button-filled-hover",children:d?o("model-select.upsell.button","Upgrade"):o("model-select.upsell.button-sign-in","Sign in")})]})})]})}}let F={fast:"grok-3",expert:"grok-4",heavy:"grok-4-heavy"},H=()=>{let{t:e}=(0,T.Bd)("base");return(0,u.useMemo)(()=>[{modelId:"grok-3",mode:"fast",prettyModeName:e("Fast","Fast"),iconRender:(0,n.jsx)(P.C2,{size:16})},{modelId:"grok-4",mode:"expert",prettyModeName:e("Expert","Expert"),iconRender:(0,n.jsx)(w.A,{size:16})},{modelId:"grok-4-heavy",mode:"heavy",prettyModeName:e("Heavy","Heavy"),iconRender:(0,n.jsx)(b.A,{size:16})}],[e])};function q(){let e=(0,o.aP)(M.A("modelSliderMode")),t=(0,o.aP)(M.A("setModelSliderMode")),s=H();return(0,n.jsx)("div",{className:(0,v.cn)("flex text-sm font-bold p-0.5 border rounded-full text-fg-secondary cursor-pointer relative bg-surface-inset"),children:s.map(s=>(0,n.jsxs)(x.P.div,{layout:!0,className:"flex flex-row items-center px-3 relative",onClick:()=>t(s.mode),children:[(0,n.jsx)(x.P.div,{layout:!0,className:"flex-shrink-0 z-10",children:s.iconRender}),s.mode===e&&(0,n.jsx)(k.N,{children:(0,n.jsx)(x.P.div,{layoutId:"highlight",className:"absolute inset-0 rounded-full bg-surface-l3 border border-border-l1 py-1.5",transition:{type:"spring",stiffness:400,damping:50}})}),(0,n.jsx)(k.N,{children:s.mode===e&&(0,n.jsx)(x.P.span,{className:"text-sm text-secondary py-1.5 z-10 whitespace-nowrap overflow-hidden",layout:!0,initial:{opacity:0,width:0,marginLeft:0},animate:{opacity:1,width:"auto",marginLeft:4},exit:{opacity:0,width:0,marginLeft:0},transition:{type:"spring",stiffness:400,damping:50},children:s.prettyModeName},s.mode)})]},s.modelId))})}},17014:(e,t,s)=>{s.d(t,{Oj5:()=>C,Qtr:()=>c,c11:()=>h,nfr:()=>p,VAL:()=>v,id:()=>I,vjv:()=>S});var n=s(79342),o=s(40409),i=s(37953);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,o.$)(t))}var a=s(88382);let l=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"m10.828 12 4.95 4.95-1.414 1.415L8 12l6.364-6.364 1.414 1.414z"})}),d=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 33 33",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"m13.237 21.04 11.082-8.19c.543-.4 1.32-.244 1.578.38 1.363 3.288.754 7.241-1.957 9.955-2.71 2.714-6.482 3.31-9.93 1.954l-3.765 1.745c5.401 3.697 11.96 2.782 16.059-1.324 3.251-3.255 4.258-7.692 3.317-11.693l.008.009c-1.365-5.878.336-8.227 3.82-13.031q.123-.17.247-.345l-4.585 4.59v-.014L13.234 21.044M10.95 23.031c-3.877-3.707-3.208-9.446.1-12.755 2.446-2.449 6.454-3.448 9.952-1.979L24.76 6.56c-.677-.49-1.545-1.017-2.54-1.387A12.465 12.465 0 0 0 8.675 7.901c-3.519 3.523-4.625 8.94-2.725 13.561 1.42 3.454-.907 5.898-3.251 8.364-.83.874-1.664 1.749-2.335 2.674l10.583-9.466"})}),c=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(d,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};c.displayName="GrokLogoIcon";let u=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})}),h=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(u,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};h.displayName="PlusIcon";let m=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{height:24,width:24,marginRight:0},viewBox:"0 0 122.8 122.8",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"M25.8 77.6c0 7.1-5.8 12.9-12.9 12.9S0 84.7 0 77.6s5.8-12.9 12.9-12.9h12.9zm6.5 0c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9v32.3c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9zM45.2 25.8c-7.1 0-12.9-5.8-12.9-12.9S38.1 0 45.2 0s12.9 5.8 12.9 12.9v12.9zm0 6.5c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9H12.9C5.8 58.1 0 52.3 0 45.2s5.8-12.9 12.9-12.9zM97 45.2c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9-5.8 12.9-12.9 12.9H97zm-6.5 0c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9V12.9C64.7 5.8 70.5 0 77.6 0s12.9 5.8 12.9 12.9zM77.6 97c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9-12.9-5.8-12.9-12.9V97zm0-6.5c-7.1 0-12.9-5.8-12.9-12.9s5.8-12.9 12.9-12.9h32.3c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9z"})}),p=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(m,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};p.displayName="SlackLogoIcon";let g=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.712 4.33a9 9 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.01 9.01 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.01 9.01 0 0 1 0 9.424m-4.138-5.976a3.7 3.7 0 0 0-.88-1.388 3.7 3.7 0 0 0-1.388-.88m2.268 2.268a3.77 3.77 0 0 1 0 2.528m-2.268-4.796a3.77 3.77 0 0 0-2.528 0m4.796 4.796a3.75 3.75 0 0 1-.88 1.388 3.7 3.7 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9 9 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.01 9.01 0 0 1-9.424 0m5.976-4.138a3.77 3.77 0 0 1-2.528 0m0 0a3.7 3.7 0 0 1-1.388-.88 3.7 3.7 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9 9 0 0 1-1.652-1.306 9 9 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.01 9.01 0 0 1 0-9.424m4.138 5.976a3.77 3.77 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.7 3.7 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9 9 0 0 0-1.652 1.306A9 9 0 0 0 4.33 7.288"})}),v=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(g,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};v.displayName="SupportIcon";let f=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"})}),I=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(f,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};I.displayName="WarningIcon";let y=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M8 2H1l8.26 11.015L1.45 22H4.1l6.388-7.349L16 22h7l-8.608-11.478L21.8 2h-2.65l-5.986 6.886zm9 18L5 4h2l12 16z"})}),S=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(y,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};S.displayName="XLogoIcon";let C=e=>{let{"aria-label":t,className:s,color:o,disabled:i,size:d="medium",type:c="button",...u}=e,h=(0,a.useRef)(null),m=null!=i?!!i:!t,p="number"==typeof d?{height:d,width:d}:void 0;return(0,n.jsx)("button",{...u,type:c,"aria-disabled":i,"aria-hidden":m,"aria-label":t,className:r("inline-flex items-center justify-center border-none bg-transparent hover:bg-muted/50 rounded-full p-0 m-0 appearance-none disabled:opacity-30",{"w-4 h-4":"x-small"===d,"w-5 h-5":"small"===d,"w-6 h-6":"medium"===d,"w-8 h-8":"large"===d,"w-full h-full":"fill"===d},s),"data-namespace":"@xai/icons","data-slot":"icon",disabled:i,ref:h,style:{color:o,...p},children:(0,n.jsx)(l,{className:r({"w-[1.125rem] h-[1.125rem]":"medium"===d,"w-[1.375rem] h-[1.375rem]":"large"===d,"w-3.5 h-3.5":"x-small"===d,"w-4 h-4":"small"===d,"w-full h-full":"fill"===d}),focusable:"false",style:{fill:"currentColor",...p}})})};C.displayName="ArrowLeftIconButton"},24994:(e,t,s)=>{s.d(t,{R:()=>d});var n=s(79342);s(88382);var o=s(13103),i=s(34500),r=s(41320),a=s(61312),l=s(65146);function d(e){let{open:t,setOpen:s,trigger:d,title:c,description:u,footer:h,children:m,contentClassName:p,headerClassName:g,footerClassName:v,titleClassName:f,descriptionClassName:I,blurBackground:y}=e,{t:S}=(0,l.Bd)();return!(0,r.Di)()&&t?(0,n.jsxs)(o.lG,{open:t,onOpenChange:s,children:[d&&(0,n.jsx)(o.zM,{asChild:!0,children:d}),(0,n.jsxs)(o.Cf,{className:(0,a.cn)("focus:outline-none rounded-none",p),overlayClassname:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,n.jsxs)(o.c7,{className:(0,a.cn)(!c&&!u&&"sr-only",g),children:[(0,n.jsx)(o.L3,{className:f,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,n.jsx)(o.rr,{className:I,children:u}):null]}),m,h?(0,n.jsx)(o.Es,{className:v,children:h}):null]})]}):(0,n.jsxs)(i._s,{open:t,onOpenChange:s,dismissible:!!s,children:[d&&(0,n.jsx)(i.Uz,{asChild:!0,children:d}),(0,n.jsxs)(i.zj,{className:(0,a.cn)("focus:outline-none",p,"max-w-none !rounded-b-none"),overlayClassName:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,n.jsxs)(i.BE,{className:(0,a.cn)(!c&&!u&&"sr-only","p-0 text-left",g),children:[(0,n.jsx)(i.gk,{className:f,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,n.jsx)(i.I6,{className:I,children:u}):null]}),m,h?(0,n.jsx)(i.tb,{className:(0,a.cn)("pt-2",v),children:h}):null]})]})}},28245:(e,t,s)=>{s.d(t,{Sf:()=>y,TL:()=>S});var n=s(79342),o=s(56691),i=s(24994);s(37931);var r=s(61312),a=s(23232),l=s(38541),d=s.n(l),c=s(32171),u=s.n(c),h=s(68332),m=s(44347),p=s(88382),g=s(65146),v=s(4890),f=s(17823),I=s(69648);d().range(1900,new Date().getFullYear()).map(e=>e.toString()).reverse();let y=(0,v.v)()((0,f.Zr)(e=>({stage:"start",setStage:t=>e({stage:t})}),{name:"age-verif"}));function S(e){let{onPass:t}=e,{t:s}=(0,g.Bd)("base"),{stage:l,setStage:d}=y(),{routeToConversation:c}=(0,h.o)(),v=(0,a._)(),f=(0,p.useCallback)(()=>{v("clicked_signin",void 0,{location:"age-verification"})},[v]),S=(0,p.useCallback)(()=>{d("pass"),null==t||t(),v("selected_over_18","pass",{location:"over-18-verification"})},[t,v,d]),C=(0,p.useCallback)(()=>{d("nopass"),v("selected_over_18","nopass",{location:"over-18-verification"})},[v,d]),w=(0,p.useCallback)(()=>{let{setShowAgeVerification:e}=m.C$.getState();e(!1),c(void 0)},[c]);return(0,n.jsxs)(i.R,{open:"pass"!==l,contentClassName:(0,r.cn)("focus:outline-0 focus-within:outline-0 gap-2","bg-background rounded-3xl","w-full md:w-5/6 lg:w-3/5 max-w-sm","flex flex-col","md:overflow-hidden","px-6 py-6"),blurBackground:!0,headerClassName:(0,r.cn)("nopass"===l&&"mb-4"),titleClassName:(0,r.cn)("nopass"===l&&"mb-1"),title:"nopass"===l?s("Restricted","Restricted"):"start"===l?s("Please confirm your age","Please confirm your age"):null,description:"nopass"===l?s("Restricted.description","Based on the information you provided you cannot use Grok image generation or 18+ personas."):"start"===l?s("Please confirm your age.description","In order to continue using Grok we need to confirm your age."):null,children:["start"===l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-4 p-1",children:[(0,n.jsx)(o.$n,{className:"w-full",variant:"secondary",onClick:C,tabIndex:-1,children:s("I am not over 18","I am not over 18")}),(0,n.jsx)(o.$n,{className:"w-full",variant:"primary",onClick:S,children:s("I am 18 or older","I am 18 or older")})]}),(0,n.jsxs)("div",{className:"relative flex items-center justify-center w-full",children:[(0,n.jsx)(I.w,{className:"absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),(0,n.jsx)("p",{className:"relative px-2 py-1 mx-auto text-xs bg-background text-secondary",children:s("Or","Or")})]}),(0,n.jsx)(o.$n,{asChild:!0,variant:"secondary",size:"lg",onClick:f,children:(0,n.jsx)(u(),{href:"sign-in",children:s("Sign in or create an account","Sign in or create an account")})})]}),"nopass"===l&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.$n,{className:"w-full mt-2",variant:"primary",size:"lg",onClick:w,children:s("Start a new chat","Start a new chat")})})]})}},29938:(e,t,s)=>{s.d(t,{Uk:()=>c,X4:()=>d,jN:()=>p,yo:()=>g});var n=s(65258),o=s(38541),i=s.n(o),r=s(6132),a=s(56173);let l="custom_personality_id",d={personalityId:l,name:"Custom",prompt:"",description:"Responds to you as you please.",isPreset:!1};function c(e){return!!e&&(e===l||36===e.length)}function u(e){return{name:e.name,content:[{text:e.prompt}]}}function h(e){var t,s;return{personalityId:e.systemPromptId||"",name:e.name||d.name,prompt:(null==(s=e.content)||null==(t=s[0])?void 0:t.text)||"",description:d.description,isPreset:!1}}class m{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.draftPromptById={},this.upsertPersonality=(0,n.el)(this.set,"byId","personalityId"),this.appendPersonalities=(0,n.BC)(this.set,"byId","personalityId"),this.removePersonality=(0,n.TF)(this.set,"byId"),this.idsertPersonalityPromise=(0,n.q5)(this.set,"promiseById"),this.removePersonalityPromise=(0,n.TF)(this.set,"promiseById"),this.upsertDraftPrompt=(0,n.q5)(this.set,"draftPromptById"),this.fetchCreatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryCreateSystemPrompt({body:u(e)}).then(e=>{let t=h(e);return t.description=d.description,t}).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(s,e.personalityId),e));return s},this.fetchUpdatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryUpdateSystemPrompt({systemPromptId:e.personalityId,body:u(e)}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),e));return t.idsertPersonalityPromise(s,e.personalityId),s},this.fetchDeletePersonality=e=>(this.get().removePersonality(e.personalityId),a.eb.systemPromptRepositoryDeleteSystemPrompt({systemPromptId:e.personalityId})),this.fetchListPersonalities=()=>{let e=this.get();return a.eb.systemPromptRepositoryListSystemPrompts({body:{pageSize:100}}).then(e=>{var t;return(null==(t=e.assets)?void 0:t.map(h))||[]}).then(t=>(e.appendPersonalities(t),e.set(e=>({promiseById:{...e.promiseById,...i().mapValues(i().keyBy(t,"personalityId"),e=>Promise.resolve(e))}})),t))},this.fetchGetPersonality=e=>{let t=this.get(),s=e.personalityId;if(s in t.promiseById)return t.promiseById[s];let n=a.eb.systemPromptRepositoryGetSystemPrompt({systemPromptId:s}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(n,e.personalityId),e));return n}}}let p=(0,n.y$)(m,"usePersonalityStore");(0,n.lB)(p,"byId","list",Object.values);let g=r.z.object({personalityId:r.z.string(),name:r.z.string(),prompt:r.z.string(),description:r.z.string(),isPreset:r.z.boolean()});r.z.array(g)},33231:(e,t,s)=>{s.d(t,{v:()=>i});var n=s(46994),o=s(88382);function i(e,t,s){(0,o.useEffect)(()=>((0,n.A)(e,t),()=>n.A.unbind(e,t)),[...s,e])}n.A.filter=()=>!0},34500:(e,t,s)=>{s.d(t,{BE:()=>h,I6:()=>g,Uz:()=>l,_s:()=>a,gk:()=>p,tb:()=>m,zj:()=>u});var n=s(79342),o=s(88382),i=s(49872),r=s(61312);let a=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,n.jsx)(i._.Root,{shouldScaleBackground:t,...s})};a.displayName="Drawer";let l=i._.Trigger,d=i._.Portal;i._.Close;let c=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Overlay,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/20 dark:bg-black/80",s),...o})});c.displayName=i._.Overlay.displayName;let u=o.forwardRef((e,t)=>{let{className:s,overlayClassName:o,disableDrag:a,children:l,...u}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:o}),(0,n.jsxs)(i._.Content,{ref:t,className:(0,r.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[24px] bg-surface-base dark:border dark:border-border-l1",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...u,children:[a?null:(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-1 mx-auto mt-3 mb-0 rounded-full bg-secondary/80"}),l]})]})});u.displayName="DrawerContent";let h=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("grid gap-1.5 p-4 text-center sm:text-left",t),...s})};h.displayName="DrawerHeader";let m=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})};m.displayName="DrawerFooter";let p=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Title,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",s),...o})});p.displayName=i._.Title.displayName;let g=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Description,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...o})});g.displayName=i._.Description.displayName},35819:(e,t,s)=>{s.d(t,{d:()=>a});var n=s(79342),o=s(38930),i=s(88382),r=s(61312);let a=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(o.bL,{className:(0,r.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full","border-[1px] border-transparent transition-colors","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring","focus-visible:ring-offset-2 focus-visible:ring-offset-background","ring-card-border ring-1","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-primary data-[state=unchecked]:bg-dove","dark:data-[state=checked]:bg-ivory dark:data-[state=unchecked]:bg-button-secondary-selected",s),...i,ref:t,children:(0,n.jsx)(o.zi,{className:(0,r.cn)("pointer-events-none block h-4 w-4 rounded-full bg-white dark:bg-background shadow-lg ring-0 transition-transform","data-[state=unchecked]:translate-x-0 ms-0.5","data-[state=checked]:translate-x-5 rtl:data-[state=checked]:-translate-x-5","dark:data-[state=unchecked]:bg-overlay")})})});a.displayName=o.bL.displayName},36936:(e,t,s)=>{s.d(t,{V:()=>i});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t,this.models=[],this.unavailableModels=[],this.defaultAnonModelId="",this.defaultFreeModelId="",this.defaultProModelId="",this.modelById={},this.isPending=!1}}let i=(0,n.y$)(o,"useModelsStore")},37931:(e,t,s)=>{s.d(t,{bq:()=>u,eb:()=>m,gC:()=>h,l6:()=>d,yv:()=>c});var n=s(79342),o=s(64653),i=s(67811),r=s(82263),a=s(59346);s(88382);var l=s(61312);function d(e){let{...t}=e;return(0,n.jsx)(o.bL,{"data-slot":"select",...t})}function c(e){let{...t}=e;return(0,n.jsx)(o.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:s="default",children:r,...a}=e;return(0,n.jsxs)(o.l9,{"data-slot":"select-trigger","data-size":s,className:(0,l.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[r,(0,n.jsx)(o.In,{asChild:!0,children:(0,n.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function h(e){let{className:t,children:s,position:i="popper",...r}=e;return(0,n.jsxs)(o.UC,{"data-slot":"select-content",className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,n.jsx)(p,{}),(0,n.jsx)(o.LM,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,n.jsx)(g,{})]})}function m(e){let{className:t,children:s,...i}=e;return(0,n.jsxs)(o.q7,{"data-slot":"select-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[(0,n.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,n.jsx)(o.VF,{children:(0,n.jsx)(r.A,{className:"size-4"})})}),(0,n.jsx)(o.p4,{children:s})]})}function p(e){let{className:t,...s}=e;return(0,n.jsx)(o.PP,{"data-slot":"select-scroll-up-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(a.A,{className:"size-4"})})}function g(e){let{className:t,...s}=e;return(0,n.jsx)(o.wn,{"data-slot":"select-scroll-down-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(i.A,{className:"size-4"})})}},38614:(e,t,s)=>{s.d(t,{aP:()=>U});var n=s(36653),o=s(58192),i=s(44845),r=s(83626),a=s(17703),l=s(33960);class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}startVoiceSession(e){let{sessionId:t,voiceId:s,personalityId:n,customInstructions:o,playbackSpeed:i,enableSearch:r,enableVision:l}=e,d=Date.now();this.currentSession={sessionId:t,requestId:null,connectionStartTime:d,voiceId:s,personalityId:n,customInstructions:o,playbackSpeed:i,enableSearch:r,enableVision:l,userTurns:0,assistantTurns:0,errors:[],personalityChanges:[],voiceChanges:[],manualMessagesSent:0},(0,a.iu)("voice_session_started",t,{location:"voice-metrics-tracker",sessionId:t,voiceId:s,personalityId:n||"none",customInstructions:o||"none",playbackSpeed:i.toString(),enableSearch:r.toString(),enableVision:l.toString()}),this.trackPersonalityChange({fromPersonality:null,toPersonality:n,fromCustomInstructions:null,toCustomInstructions:o}),this.trackVoiceChange({fromVoice:null,toVoice:s}),this.trackPlaybackSpeedChange({fromSpeed:1,toSpeed:i})}trackLivekitTokenReceived(e){this.currentSession&&!this.currentSession.livekitTokenReceivedTime&&(this.currentSession.livekitTokenReceivedTime=Date.now(),this.currentSession.requestId=e,(0,a.iu)("voice_livekit_token_received",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:e||"unavailable",timestamp:this.currentSession.livekitTokenReceivedTime.toString(),duration:(this.currentSession.livekitTokenReceivedTime-this.currentSession.connectionStartTime).toString()}))}trackLocalTrackSubscribed(){this.currentSession&&this.currentSession.livekitTokenReceivedTime&&!this.currentSession.trackSubscribedTime&&(this.currentSession.trackSubscribedTime=Date.now(),(0,a.iu)("voice_local_track_subscribed",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",timestamp:this.currentSession.trackSubscribedTime.toString(),duration:(this.currentSession.trackSubscribedTime-this.currentSession.livekitTokenReceivedTime).toString()}))}trackConversationCreated(e){let{conversationId:t,connectionState:s}=e;if(!this.currentSession||!this.currentSession.trackSubscribedTime||this.currentSession.conversationCreatedTime)return;let n=Date.now();this.currentSession.conversationCreatedTime=n,(0,a.iu)("voice_conversation_created",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",conversationId:t||"unavailable",connectionState:s,timestamp:n.toString(),duration:(n-this.currentSession.trackSubscribedTime).toString()})}trackConnectionReady(){if(!this.currentSession)return;let e=Date.now();this.currentSession.readyTime=e,(0,a.iu)("voice_connection_ready",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",timestamp:e.toString(),duration:(e-this.currentSession.connectionStartTime).toString()})}trackUserTurn(){this.currentSession&&this.currentSession.userTurns++}trackAssistantTurn(){this.currentSession&&this.currentSession.assistantTurns++}trackManualMessage(){this.currentSession&&this.currentSession.manualMessagesSent++}trackPersonalityChange(e){let{fromPersonality:t,toPersonality:s,fromCustomInstructions:n,toCustomInstructions:o}=e;if(!this.currentSession)return;let i={fromPersonality:t,toPersonality:s,fromCustomInstructions:n,toCustomInstructions:o,timestamp:Date.now()};this.currentSession.personalityChanges.push(i),this.currentSession.personalityId=s,this.currentSession.customInstructions=o,(0,a.iu)("voice_personality_changed",o?"custom-instructions":s||void 0,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromPersonality:t||"none",toPersonality:s||"none",fromCustomInstructions:n||"none",toCustomInstructions:o||"none",changeCount:this.currentSession.personalityChanges.length.toString()})}trackVoiceChange(e){let{fromVoice:t,toVoice:s}=e;if(!this.currentSession)return;let n={fromVoice:t,toVoice:s,timestamp:Date.now()};this.currentSession.voiceChanges.push(n),this.currentSession.voiceId=s,(0,a.iu)("voice_voice_changed",s,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromVoice:t||"none",toVoice:s,changeCount:this.currentSession.voiceChanges.length.toString()})}trackPlaybackSpeedChange(e){let{fromSpeed:t,toSpeed:s}=e;this.currentSession&&(this.currentSession.playbackSpeed=s,(0,a.iu)("voice_playback_speed_changed",s.toString(),{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromSpeed:t.toString(),toSpeed:s.toString()}))}trackScreenShareStart(){this.currentSession&&(this.currentSession.screenShareStartTime=Date.now(),(0,a.iu)("voice_screen_share_started",void 0,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable"}))}trackScreenShareEnd(){if(!this.currentSession||!this.currentSession.screenShareStartTime)return;let e=Date.now()-this.currentSession.screenShareStartTime;this.currentSession.screenShareDuration=(this.currentSession.screenShareDuration||0)+e,this.currentSession.screenShareStartTime=void 0,(0,a.iu)("voice_screen_share_ended",e.toString(),{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",duration:e.toString(),totalScreenShareDuration:this.currentSession.screenShareDuration.toString()})}trackError(e,t){if(!this.currentSession)return;let s={type:e,message:t,timestamp:Date.now()};this.currentSession.errors.push(s),(0,a.iu)("voice_session_error",void 0,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",errorType:e,errorMessage:t,errorCount:this.currentSession.errors.length.toString()})}endVoiceSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user_initiated";if(!this.currentSession)return;let t=Date.now();this.currentSession.endTime=t,this.currentSession.endReason=e,this.currentSession.readyTime&&(this.currentSession.totalDuration=t-this.currentSession.readyTime),this.currentSession.screenShareStartTime&&this.trackScreenShareEnd(),(0,a.iu)("voice_session_ended",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",endReason:e,totalDuration:(this.currentSession.totalDuration||0).toString(),livekitTokenReceivedDuration:(this.currentSession.livekitTokenReceivedTime?this.currentSession.livekitTokenReceivedTime-this.currentSession.connectionStartTime:0).toString(),trackSubscribedDuration:(this.currentSession.trackSubscribedTime&&this.currentSession.livekitTokenReceivedTime?this.currentSession.trackSubscribedTime-this.currentSession.livekitTokenReceivedTime:0).toString(),conversationCreatedDuration:(this.currentSession.conversationCreatedTime&&this.currentSession.trackSubscribedTime?this.currentSession.conversationCreatedTime-this.currentSession.trackSubscribedTime:0).toString(),readyDuration:(this.currentSession.readyTime?this.currentSession.readyTime-this.currentSession.connectionStartTime:0).toString(),userTurns:this.currentSession.userTurns.toString(),assistantTurns:this.currentSession.assistantTurns.toString(),totalTurns:(this.currentSession.userTurns+this.currentSession.assistantTurns).toString(),screenShareDuration:(this.currentSession.screenShareDuration||0).toString(),personalityChanges:this.currentSession.personalityChanges.length.toString(),voiceChanges:this.currentSession.voiceChanges.length.toString(),errors:this.currentSession.errors.length.toString(),manualMessages:this.currentSession.manualMessagesSent.toString(),voiceId:this.currentSession.voiceId,personalityId:this.currentSession.personalityId||"none",customInstructions:this.currentSession.customInstructions||"none",enableSearch:this.currentSession.enableSearch.toString(),enableVision:this.currentSession.enableVision.toString()}),this.currentSession=null}trackConnectionStateChange(e,t){this.currentSession&&"disconnected"===t&&"disconnecting"!==e&&this.trackError("unexpected_disconnection","Connection changed from ".concat(e," to ").concat(t))}constructor(){this.currentSession=null}}d.instance=null;let c=d.getInstance();var u=s(65258),h=s(56173),m=s(49972),p=s(36936),g=s(29938),v=s(43893),f=s(44347),I=s(13511),y=s(83318),S=s(38541),C=s.n(S),w=s(12110),b=s(14908),x=s(27853),k=s(6132),_=s(4890),R=s(17823),M=s(79342);let T=[1];var P=s(98100),E=s(17014),N=s(88382),B=s(65146);let V=e=>{let{modelName:t,reasoningMode:s,waitTimeSeconds:n}=e,{t:o}=(0,B.Bd)("chat"),{modelById:i}=(0,P.GB)(),r=(0,N.useMemo)(()=>{var e;return(null==(e=i[t])?void 0:e.name)||t},[i,t]),a=(0,N.useMemo)(()=>{let e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0&&t>0?"".concat(o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[n,o]),l=(0,N.useMemo)(()=>"DEEPSEARCH"===s?o("Rate Limit Reached.description-deepsearch","Query limit reached for {{modelName}} with DeepSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"DEEPERSEARCH"===s?o("Rate Limit Reached.description-deepersearch","Query limit reached for {{modelName}} with DeeperSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"REASONING"===s?o("Rate Limit Reached.description-reasoning","Query limit reached for {{modelName}} with Think. Limit refreshes in {{time}}.",{modelName:r,time:a}):o("Rate Limit Reached.description","Query limit reached for {{modelName}}. Limit refreshes in {{time}}.",{modelName:r,time:a}),[a,r,o,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(E.id,{className:"size-5"}),(0,M.jsx)("div",{className:"font-semibold text-xs",children:l})]})},A=e=>{let{modelName:t,reasoningMode:s,remainingQueries:n,windowSizeSeconds:o}=e,{t:i}=(0,B.Bd)("chat"),{modelById:r}=(0,P.GB)(),a=(0,N.useMemo)(()=>{var e;return(null==(e=r[t])?void 0:e.name)||t},[r,t]),l=(0,N.useMemo)(()=>{let e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0&&t>0?"".concat(i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[o,i]),d=(0,N.useMemo)(()=>"DEEPSEARCH"===s?i("Remaining Queries.description-deepsearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeepSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeepSearch. Limit resets every {{time}}."}):"DEEPERSEARCH"===s?i("Remaining Queries.description-deepersearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeeperSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeeperSearch. Limit resets every {{time}}."}):"REASONING"===s?i("Remaining Queries.description-reasoning",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with Think. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with Think. Limit resets every {{time}}."}):i("Remaining Queries.description",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}}. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}}. Limit resets every {{time}}."}),[n,a,l,i,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(E.id,{className:"size-5"}),(0,M.jsx)("div",{className:"text-xs font-semibold",children:d})]})};function j(e){h.tW.rateLimitsGetRateLimits({body:e}).then(t=>{void 0!==t.remainingQueries&&T.includes(t.remainingQueries)?b.oR.info((0,M.jsx)(A,{reasoningMode:e.requestKind,modelName:e.modelName,remainingQueries:t.remainingQueries,windowSizeSeconds:t.windowSizeSeconds||0}),{duration:7e3}):0===t.remainingQueries&&t.waitTimeSeconds&&b.oR.info((0,M.jsx)(V,{reasoningMode:e.requestKind,modelName:e.modelName,waitTimeSeconds:t.waitTimeSeconds}),{duration:7e3})}).catch(e=>{(0,a.vV)("chat-page-store:checkRateLimits",e)})}function L(e,t){let s=function(e,t){let s=e.trim().replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");return s.length>200?s.slice(0,200)+"...":s}(e,200);b.oR.info(s,{duration:7e3}),(0,a.iu)("show_disclaimer",s,{location:"chat-page-store",conversationId:t})}k.z.union([k.z.literal("auto"),k.z.literal("image"),k.z.literal("search"),k.z.literal("modelOnly"),k.z.literal("noSearch")]),k.z.union([k.z.literal("chat"),k.z.literal("voice")]);class z{constructor(e,t){this.set=e,this.get=t,this.activeModelId=o.Sk,this.isRateLimited=!1,this.isThinkingRateLimited=!1,this.isDeepSearchRateLimited=!1,this.isUnauthenticated=!1,this.hasDismissedDisclaimer=!1,this.conversationMode="chat",this.outputMode="auto",this.reasoningMode="none",this.usingExperiment=!1,this.experiments=[],this.streamingExperimentsIds=[],this.queryBarExpanded=!1,this.isTypingDebounce=!1,this.showStreamingIndicator=!1,this.modelSliderMode="expert",this.metadata={},this.selectedPersonalityId=void 0,this.customPersonality=void 0,this.quotedText=void 0,this.queryByConversationId={},this.chatPageLoaded=!1,this.isDeeperSearchSelected=!1,this.livekitRoom=null,this.livekitToken=null,this.livekitRequestId=null,this.voiceConnectionStatus="disconnected",this.voiceId="Ara",this.voicePersonalityId="assistant",this.voiceCustomInstructions=null,this.voicePlaybackSpeed=1,this.voiceModeTimeoutId=null,this.currentVoiceSessionId=null,this.exitVoiceModePromise=null,this.setModelSliderMode=(0,u.kp)(this.set,"modelSliderMode"),this.setConversationId=(0,u.kp)(this.set,"conversationId"),this.setOptimisticConversationId=(0,u.kp)(this.set,"optimisticConversationId"),this.setLastMessageId=(0,u.kp)(this.set,"lastMessageId"),this.setSidePanelContent=(0,u.kp)(this.set,"sidePanelContent"),this.toggleSidePanelContent=e=>{let t=this.get().sidePanelContent;(null==t?void 0:t.type)===e.type&&t.data===e.data?this.setSidePanelContent(void 0):this.setSidePanelContent(e)},this.setStreamedMessageId=(0,u.kp)(this.set,"streamedMessageId"),this.setActiveModelId=(0,u.kp)(this.set,"activeModelId"),this.setSelectedSystemPromptId=(0,u.kp)(this.set,"selectedSystemPromptId"),this.setIsRateLimited=(0,u.kp)(this.set,"isRateLimited"),this.setIsUnauthenticated=(0,u.kp)(this.set,"isUnauthenticated"),this.setHasDismissedDisclaimer=(0,u.kp)(this.set,"hasDismissedDisclaimer"),this.setOptimisticMessageId=(0,u.kp)(this.set,"optimisticMessageId"),this.setConversationMode=(0,u.kp)(this.set,"conversationMode"),this.setOutputMode=(0,u.kp)(this.set,"outputMode"),this.setReasoningMode=(0,u.kp)(this.set,"reasoningMode"),this.setChatPageLoaded=(0,u.kp)(this.set,"chatPageLoaded"),this.setDefaultAnonModelId=(0,u.kp)(this.set,"defaultAnonModelId"),this.setDefaultFreeModelId=(0,u.kp)(this.set,"defaultFreeModelId"),this.setDefaultProModelId=(0,u.kp)(this.set,"defaultProModelId"),this.setMetadata=(0,u.kp)(this.set,"metadata"),this.setUsingExperiment=e=>{this.removeAllExperiments(),this.removeAllStreamingExperiments(),this.set(t=>({...t,usingExperiment:e}))},this.removeAllExperiments=(0,u.dX)(this.set,"experiments",[]),this.setExperiments=(0,u.kp)(this.set,"experiments"),this.addExperiment=(0,u.WQ)(this.set,"experiments"),this.removeExperiment=e=>{this.set(t=>{let s=[...t.experiments];return s.splice(e,1),{...t,experiments:s}})},this.setStreamingExperimentsIds=(0,u.kp)(this.set,"streamingExperimentsIds"),this.addStreamingExperimentId=(0,u.WQ)(this.set,"streamingExperimentsIds"),this.removeAllStreamingExperiments=(0,u.dX)(this.set,"streamingExperimentsIds",[]),this.setSelectedPersonalityId=(0,u.kp)(this.set,"selectedPersonalityId"),this.setCustomPersonality=(0,u.kp)(this.set,"customPersonality"),this.setQuotedText=(0,u.kp)(this.set,"quotedText"),this.idsetQueryByConversationId=(0,u.q5)(this.set,"queryByConversationId"),this.setQueryBarExpanded=e=>this.set({queryBarExpanded:e}),this.setIsTypingDebounce=e=>this.set({isTypingDebounce:e}),this.setIsDeeperSearchSelected=(0,u.kp)(this.set,"isDeeperSearchSelected"),this.setLivekitRoom=(0,u.kp)(this.set,"livekitRoom"),this.setLivekitToken=(0,u.kp)(this.set,"livekitToken"),this.setLivekitRequestId=(0,u.kp)(this.set,"livekitRequestId"),this.setVoiceConnectionStatus=e=>{let t=this.get().voiceConnectionStatus;this.set({voiceConnectionStatus:e}),this.get().currentVoiceSessionId&&t!==e&&(c.trackConnectionStateChange(t,e),"ready"===e&&c.trackConnectionReady())},this.setVoiceId=(0,u.kp)(this.set,"voiceId"),this.setVoicePersonalityId=(0,u.kp)(this.set,"voicePersonalityId"),this.setVoiceCustomInstructions=(0,u.kp)(this.set,"voiceCustomInstructions"),this.setVoicePlaybackSpeed=(0,u.kp)(this.set,"voicePlaybackSpeed"),this.setVoiceModeTimeoutId=(0,u.kp)(this.set,"voiceModeTimeoutId"),this.setCurrentVoiceSessionId=(0,u.kp)(this.set,"currentVoiceSessionId"),this.isErrorRetryable=e=>{let t=(0,l.G1)(e);return 429===t?(this.setIsRateLimited(!0),!1):401===t?(this.setIsUnauthenticated(!0),!1):!(t&&t>=400&&t<500||e.message.includes("Failed to respond")||e.message.includes(I.CZ)||e.message.includes(I.S3))},this.establishNewConversation=async e=>{let{temporary:t,message:s,fileAttachmentIds:n,webpageUrls:a,toolOverrides:l,isPreset:d,persona:c,enableRetries:u,disableArtifactDiff:h,imageEditUri:m,workspaceIds:p,responseMetadata:I,isFromGrokFiles:y,disableToolComposer:S=!1,disableMemory:w=!1,ff:b}=e,x=this.get(),k=v.A3.getState(),_=f.C$.getState(),R=g.jN.getState(),M=C().get(R.byId,_.userSettings.preferences.selectedSystemPromptId||""),T=x.activeModelId,P=H(void 0,x.reasoningMode,T),E=void 0,N=(null==M?void 0:M.prompt)||x.customPersonality,B=c&&T!==o.E8?"".concat(N,"\n\n").concat(c.prompt,"."):N,V=!1,A={...x.metadata,...I};return x.setMetadata({}),new Promise((e,o)=>{k.streamCreateAndRespond({temporary:t,message:s,modelName:T,fileAttachmentIds:n,webpageUrls:a,systemPromptName:null==c?void 0:c.systemPromptName,personaId:null==c?void 0:c.personaId,toolOverrides:null!=l?l:D(x.outputMode,P),isPreset:d,customInstructions:E,customPersonality:B,deepsearchPreset:(0,i.Ku)(P),isReasoning:"think"===P,imageEditUri:m,enableRetries:u,disableArtifactDiff:h,workspaceIds:p,responseMetadata:A,isFromGrokFiles:y,disableToolComposer:S,disableMemory:w,modelSliderMode:x.modelSliderMode,onOptimisticConversation:e=>{let{conversationId:t}=e;x.setOptimisticConversationId(t)},onOptimisticResponse:e=>{let{responseId:t}=e;x.setOptimisticMessageId(t)},onStart:e=>{var t;x.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onConversation:t=>{x.setConversationId(t.conversationId),x.setOptimisticConversationId(void 0),V=!0,e(t)},onUserResponse:e=>{x.setLastMessageId(e.responseId),x.setOptimisticMessageId(e.responseId)},onStartExperiment:e=>{x.setUsingExperiment(!0),e.forEach(e=>{x.addStreamingExperimentId(e),x.addExperiment({})})},onCitations:()=>{},onDisclaimer:c?()=>{}:L,onHasImage:(0,r.S)(()=>_.setShowAgeVerification(!0)),onClose:e=>{e.length>1&&(x.setExperiments(e),x.setStreamingExperimentsIds(e.map(e=>e.responseId)));let t=C().first(e);t&&this.get().lastMessageId===t.parentResponseId&&(x.setLastMessageId(t.responseId),x.setStreamedMessageId(t.responseId)),j({modelName:T,requestKind:(0,i.ot)(P)}),V?x.setOptimisticConversationId(void 0):o(Error("Not resolved by close"))},onWke:e=>{"RateLimitError"===e.name&&x.setIsRateLimited(!0),o(e)},onError:this.isErrorRetryable,ff:b}).catch(e=>{o(e)})})},this.sendResponse=async e=>{var t;let{message:s,parentResponseId:n,parentQuotedText:a,conversationId:l,fileAttachmentIds:d,webpageUrls:c,toolOverrides:u,setOpimisticUserResponse:h,setUserResponse:m,onOptimisticUserResponse:p,onError:I,imageEditUri:y,persona:S,enableRetries:w,disableArtifactDiff:b,metadata:x,followUpType:k,reasoningMode:_,isFromGrokFiles:R,resumeResponseId:M,disableToolComposer:T=!1,disableMemory:P=!1,modelIdOverride:E,ff:N}=e,B=this.get(),V=v.A3.getState(),A=f.C$.getState(),z=g.jN.getState(),U=C().get(z.byId,A.userSettings.preferences.selectedSystemPromptId||""),O=null!=E?E:B.activeModelId,F=void 0,q=null!=(t=(null==U?void 0:U.prompt)||B.customPersonality)?t:"",G=S&&O!==o.E8?"".concat(q,"\n\n").concat(S.prompt,"."):q;B.setUsingExperiment(!1),B.setLastMessageId(n);let Z=H(_,B.reasoningMode,O),Q={...B.metadata,...x};return B.setMetadata({}),new Promise((e,t)=>{V.streamResponse({message:s,metadata:Q,parentResponseId:n,parentQuotedText:a,conversationId:l,modelName:O,systemPromptName:null==S?void 0:S.systemPromptName,fileAttachmentIds:d,webpageUrls:c,toolOverrides:{...D(B.outputMode,Z),...null!=u?u:{}},customInstructions:F,customPersonality:G,deepsearchPreset:(0,i.Ku)(Z),isReasoning:"think"===Z,imageEditUri:y,enableRetries:w,disableArtifactDiff:b,followUpType:k,isFromGrokFiles:R,resumeResponseId:M,disableToolComposer:T,disableMemory:P,modelSliderMode:B.modelSliderMode,onOptimisticUserResponse:e=>{h&&(B.setOptimisticMessageId(e.responseId),null==p||p(e))},onOptimisticModelResponse:e=>{B.setStreamedMessageId(e.responseId)},onStart:e=>{var t;B.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onUserResponse:e=>{m&&(B.setLastMessageId(e.responseId),B.setOptimisticMessageId(e.responseId))},onStartExperiment:e=>{B.setUsingExperiment(!0),e.forEach(e=>{B.addStreamingExperimentId(e),B.addExperiment({})})},onCitations:()=>{},onDisclaimer:S?()=>{}:L,onHasImage:(0,r.S)(()=>A.setShowAgeVerification(!0)),onClose:s=>{s.length>1&&(B.setExperiments(s),B.setStreamingExperimentsIds(s.map(e=>e.responseId)));let n=C().first(s);if(n&&this.get().lastMessageId===n.parentResponseId&&(B.setLastMessageId(n.responseId),B.setStreamedMessageId(n.responseId)),s.length&&s.every(e=>"closed"===e.state))e(s);else{let e=Error("Responses missing, errored, or not closed");null==I||I(e),t(e)}j({modelName:O,requestKind:(0,i.ot)(Z)})},onWke:e=>{"RateLimitError"===e.name&&B.setIsRateLimited(!0),null==I||I(e),t(e)},onError:this.isErrorRetryable,ff:N}).catch(e=>{null==I||I(e),t(e)})})},this.reconnectToInflightResponses=async(e,t,s)=>{let n=this.get(),o=v.A3.getState(),l=f.C$.getState(),d=n.activeModelId;try{let c=await o.fetchListInflightResponses(e);if(!c.length)return;let u=C().maxBy(c,e=>new Date(e.createTime?e.createTime:0));if(!u)return;if(!u.responseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing response id");if(!u.parentResponseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing parent response id:");n.setLastMessageId(u.parentResponseId),await o.reconnectToResponse({inflightResponse:u,conversationId:e,modelName:d,parentResponseId:u.parentResponseId,enableRetries:t,isReasoning:"think"===n.reasoningMode,deepsearchPreset:(0,i.Ku)(n.reasoningMode),modelSliderMode:n.modelSliderMode,onStart:e=>{let t=e[0];t&&n.setStreamedMessageId(t.responseId)},onCitations:()=>{},onDisclaimer:L,onHasImage:(0,r.S)(()=>l.setShowAgeVerification(!0)),onClose:(e,t)=>{e.length>1&&(n.setExperiments(e),n.setStreamingExperimentsIds(t));let s=C().first(e);s&&(n.setLastMessageId(s.responseId),n.setStreamedMessageId(void 0)),j({modelName:d,requestKind:(0,i.ot)(n.reasoningMode)})},onWke:e=>{"RateLimitError"===e.name&&n.setIsRateLimited(!0),(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error reconnecting to inflight response")},onError:this.isErrorRetryable,ff:s})}catch(e){(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error checking inflight responses")}},this.requestLivekitToken=async e=>{let{livekitUrl:t,conversationId:s,ff:o}=e,i=this.get(),r=null===n.sessionStoreState||void 0===n.sessionStoreState?void 0:n.sessionStoreState.getState();try{var l,d,c;let e=await h.hx.livekitCreateToken({body:{conversationId:s,sessionPayload:JSON.stringify({...F({username:null==r||null==(l=r.user)?void 0:l.givenName,customInstructions:i.voiceCustomInstructions,voiceId:i.voiceId,personalityId:i.voicePersonalityId,playbackSpeed:i.voicePlaybackSpeed,ff:o}),enable_vision:(null==(c=i.livekitRoom)||null==(d=c.localParticipant)?void 0:d.isScreenShareEnabled)||!1,turn_detection:{type:"server_vad"}}),requestAgentDispatch:!1,livekitUrl:t}});if(!e.token)throw Error("No livekit token returned");return i.setLivekitToken(e.token),i.setLivekitRequestId(e.requestId||null),{token:e.token,requestId:e.requestId||null}}catch(e){throw(0,a.vV)("chat-page-store:requestLivekitToken","Failed to get livekit token"),e}},this.enterVoiceMode=async e=>{var t,s;let{livekitUrl:n,ff:o}=e,i=this.get();if(this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),"voice"===i.conversationMode&&"disconnected"!==i.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:enterVoiceMode","Already in voice mode"),Error("Already in voice mode");let r=(0,x.A)();this.setCurrentVoiceSessionId(r),c.startVoiceSession({sessionId:r,voiceId:i.voiceId,personalityId:i.voicePersonalityId,customInstructions:i.voiceCustomInstructions,playbackSpeed:i.voicePlaybackSpeed,enableSearch:O({personalityId:i.voicePersonalityId,voiceId:i.voiceId,ff:o}),enableVision:!!(null==(s=i.livekitRoom)||null==(t=s.localParticipant)?void 0:t.isScreenShareEnabled)}),this.setConversationMode("voice"),this.setVoiceConnectionStatus("connecting"),(0,y.He)("silent");try{let{token:e,requestId:t}=await this.requestLivekitToken({livekitUrl:n,conversationId:i.conversationId,ff:o});c.trackLivekitTokenReceived(t);let s=new y.Wv({publishDefaults:{screenShareEncoding:{maxBitrate:35e5,maxFramerate:1}}});this.setLivekitRoom(s),s.prepareConnection(n,e).catch(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Failed to prepare connection"),c.trackError("connection_prepare_failed","Failed to prepare connection")});let r=null,l=new Promise(e=>{r=e});s.on(y.u9.Disconnected,async()=>{await this.exitVoiceMode("connection_lost")}),s.on(y.u9.Reconnecting,()=>{this.setVoiceConnectionStatus("reconnecting")}),s.on(y.u9.Reconnected,()=>{this.setVoiceConnectionStatus("connected")}),s.on(y.u9.LocalTrackSubscribed,e=>{e.source===y.CC.Source.Microphone&&c.trackLocalTrackSubscribed()}),s.on(y.u9.ParticipantDisconnected,async()=>(c.trackError("participant_disconnected","Participant disconnected"),this.exitVoiceMode("participant_disconnected").finally(()=>{b.oR.error("Voice connection lost")}))),s.on(y.u9.DataReceived,(e,t,s,n)=>{let o=new TextDecoder().decode(e);if("realtime_server_events"===n){let e=JSON.parse(o);switch(e.type){case"ping":return this.handleVoiceConnectionPing();case"conversation.created":var i;if(c.trackConversationCreated({conversationId:null==e||null==(i=e.conversation)?void 0:i.id,connectionState:this.get().voiceConnectionStatus}),["connecting","reconnecting","connected"].includes(this.get().voiceConnectionStatus))return this.setVoiceConnectionStatus("ready"),r&&r(),this.handleConversationCreated(e);break;case"conversation.item.created":return this.handleConversationItemCreated(e);case"response.created":return this.handleAssistantVoiceResponseCreated(e);case"response.audio_transcript.delta":return this.handleAssistantVoiceResponseTranscriptDelta(e);case"response.search.result":return this.handleVoiceResponseSearchResult(e);case"response.grok.output":return this.handleVoiceGrokOutput(e)}}}),s.localParticipant.on(y.YI.LocalTrackPublished,e=>{if(e.source===y.CC.Source.ScreenShare)return c.trackScreenShareStart(),i.sendVoiceSettingsUpdate({voiceId:i.voiceId,voicePersonalityId:i.voicePersonalityId,voiceCustomInstructions:i.voiceCustomInstructions,voicePlaybackSpeed:i.voicePlaybackSpeed,ff:o})}),s.localParticipant.on(y.YI.LocalTrackUnpublished,e=>{if(e.source===y.CC.Source.ScreenShare)return c.trackScreenShareEnd(),i.sendVoiceSettingsUpdate({voiceId:i.voiceId,voicePersonalityId:i.voicePersonalityId,voiceCustomInstructions:i.voiceCustomInstructions,voicePlaybackSpeed:i.voicePlaybackSpeed,ff:o})}),await s.connect(n,e).then(()=>this.setVoiceConnectionStatus("connected")),await s.localParticipant.setMicrophoneEnabled(!0,{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}).catch(()=>{let e="Failed to set microphone enabled";throw(0,a.vV)("chat-page-store:enterVoiceMode",e),c.trackError("microphone_enable_failed",e),Error("mic-permission-denied")});let d=new Promise((e,t)=>{this.setVoiceModeTimeoutId(setTimeout(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Connection ready timeout after 10 seconds"),t(Error("Voice connection ready timeout after 10 seconds"))},1e4))});try{await Promise.race([l,d]),this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null))}catch(e){throw this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),c.trackError("enter_voice_mode_timeout","Connection ready timeout after 10 seconds"),await this.exitVoiceMode("connection_timeout"),e}}catch(s){(0,a.vV)("chat-page-store:enterVoiceMode","Failed to enter voice mode");let e=s.message||"Unknown error",t="connection_error";throw(null==e?void 0:e.includes("Permission denied"))||(null==e?void 0:e.includes("NotAllowedError"))||"mic-permission-denied"===e?(e="mic-permission-denied",t="mic_permission_denied"):((null==e?void 0:e.includes("Rate limit exceeded"))||(null==e?void 0:e.includes("429")))&&(e="rate-limit-exceeded",t="rate_limit_exceeded"),c.trackError("enter_voice_mode_failed",e),await this.exitVoiceMode(t),Error(e)}},this.exitVoiceMode=async e=>{let t=this.get();if("disconnected"!==t.voiceConnectionStatus){if("disconnecting"===t.voiceConnectionStatus&&this.exitVoiceModePromise)return this.exitVoiceModePromise;this.exitVoiceModePromise=this.performExitVoiceMode(e);try{await this.exitVoiceModePromise}finally{this.exitVoiceModePromise=null}}},this.performExitVoiceMode=async e=>{let t=this.get(),s=m.w.getState();if(t.setVoiceConnectionStatus("disconnecting"),t.currentVoiceSessionId&&(c.endVoiceSession(e),this.setCurrentVoiceSessionId(null)),t.voiceModeTimeoutId&&(clearTimeout(t.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),t.streamedMessageId){let e=v.A3.getState(),s=e.byId[t.streamedMessageId],n=s.responseId,o=s.inflightResponseId||(0,x.A)();e.upsertResponse({...s,state:"closed",partial:!0,responseId:o}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(o),e.removeResponse(n)}if(t.livekitRoom){try{var n;await (null==(n=t.livekitRoom.localParticipant)?void 0:n.publishData(new TextEncoder().encode(""),{topic:"disconnect"}))}catch(e){(0,a.vV)("chat-page-store:exitVoiceMode","Failed to publish disconnect data"),c.trackError("disconnect_data_publish_failed","Failed to publish disconnect data")}await t.livekitRoom.disconnect()}t.optimisticConversationId&&(s.removeConversation(t.optimisticConversationId),this.setOptimisticConversationId(void 0),s.removeAbortControllerById(t.optimisticConversationId)),this.setLivekitRoom(null),this.setLivekitToken(null),this.setLivekitRequestId(null),this.setVoiceConnectionStatus("disconnected"),this.setConversationMode("chat")},this.toggleScreenSharing=async()=>{var e;let t=this.get();if(!(null==t?void 0:t.livekitRoom)||!(null==t||null==(e=t.livekitRoom)?void 0:e.localParticipant)||"ready"!==t.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:startScreenShare","Voice connection not ready"),Error("Voice connection not ready");let s=t.livekitRoom.localParticipant.isScreenShareEnabled;try{await t.livekitRoom.localParticipant.setScreenShareEnabled(!s,{audio:!1,video:!0,selfBrowserSurface:"exclude",surfaceSwitching:"include"})}catch(e){throw(0,a.vV)("chat-page-store:toggleScreenSharing","Failed to toggle screen share"),c.trackError("screen_share_toggle_failed","Failed to toggle screen share"),e}},this.sendVoiceSettingsUpdate=async e=>{var t,s,o;let{voiceId:i,voicePersonalityId:r,voiceCustomInstructions:l,voicePlaybackSpeed:d,ff:u}=e,h=this.get();if(!h.livekitRoom||"ready"!==h.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceSessionUpdate","Voice connection not ready or disconnected"),Error("Voice connection not ready or disconnected");let m={voiceId:h.voiceId,voicePersonalityId:h.voicePersonalityId,voiceCustomInstructions:h.voiceCustomInstructions,playbackSpeed:h.voicePlaybackSpeed};(m.voicePersonalityId!==r||m.voiceCustomInstructions!==l)&&c.trackPersonalityChange({fromPersonality:m.voicePersonalityId,toPersonality:r,fromCustomInstructions:m.voiceCustomInstructions,toCustomInstructions:l}),m.voiceId!==i&&c.trackVoiceChange({fromVoice:m.voiceId,toVoice:i}),m.playbackSpeed!==d&&c.trackPlaybackSpeedChange({fromSpeed:m.playbackSpeed,toSpeed:d}),this.setVoiceId(i),this.setVoicePersonalityId(r),this.setVoiceCustomInstructions(l),this.setVoicePlaybackSpeed(d);let p=null===n.sessionStoreState||void 0===n.sessionStoreState?void 0:n.sessionStoreState.getState(),g={...F({username:null==p||null==(t=p.user)?void 0:t.givenName,voiceId:i,personalityId:r,customInstructions:l,playbackSpeed:d,ff:u}),enable_vision:(null==(o=h.livekitRoom)||null==(s=o.localParticipant)?void 0:s.isScreenShareEnabled)||!1};return h.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"session.update",session:g})),{topic:"realtime_client_event"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceSettingsUpdate","Failed to send voice settings update"),c.trackError("voice_settings_update_failed","Failed to send voice settings update"),this.setVoiceId(m.voiceId),this.setVoicePersonalityId(m.voicePersonalityId),this.setVoiceCustomInstructions(m.voiceCustomInstructions),this.setVoicePlaybackSpeed(m.playbackSpeed),Error("Failed to send voice settings update")})},this.sendVoiceManualMessage=async e=>{let{message:t}=e,s=this.get();if(!s.livekitRoom||"ready"!==s.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Voice connection not ready"),Error("Voice connection not ready");return c.trackManualMessage(),s.livekitRoom.localParticipant.publishData(new TextEncoder().encode(t),{topic:"grok.chat"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Failed to send voice message"),c.trackError("manual_message_failed","Failed to send voice message"),Error("Failed to send voice message")})},this.handleVoiceConnectionPing=()=>{let e=this.get();return e.livekitRoom?e.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({timestamp:Date.now()})),{topic:"grok.ping"}):void(0,a.vV)("chat-page-store:handleVoiceConnectionPing","No livekit room available")},this.handleConversationCreated=e=>{let{conversation:t}=e,s=this.get(),n=m.w.getState();if(!s.conversationId&&!s.optimisticConversationId){if(!(null==t?void 0:t.id))return(0,a.vV)("chat-page-store:handleConversationCreated","Missing conversation id"),this.exitVoiceMode();let e={...(0,m.b)({conversationId:t.id,temporary:!1}),mediaTypes:["audio"]};n.upsertAndCacheConversation(e),this.setOptimisticConversationId(t.id);let s=new AbortController;n.idsertAbortControllerById(s,t.id)}},this.handleConversationItemCreated=e=>{var t,s,n,o,i,r,l,d;let{item:u}=e;if(!u||!u.id)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing item or item.id");if("user"!==u.role||"completed"!==u.status||!(null==(s=u.content)||null==(t=s[0])?void 0:t.text)&&!(null==(o=u.content)||null==(n=o[0])?void 0:n.transcript))return;c.trackUserTurn();let h=this.get(),p=v.A3.getState(),g=m.w.getState(),f=h.conversationId;if(!h.conversationId&&h.optimisticConversationId){let e={...g.byId[h.optimisticConversationId],state:"closed"};f=e.conversationId,g.upsertAndCacheConversation(e),h.set({optimisticConversationId:void 0,conversationId:e.conversationId}),p.idsertNodesByConversationId([],e.conversationId)}else if(!h.conversationId||!h.lastMessageId)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing conversationId or lastMessageId");let I=p.byId[u.id];if(I)return void p.upsertResponse({...I,message:(null==(l=u.content)?void 0:l[0].text)||(null==(d=u.content)?void 0:d[0].transcript)||""});let y=h.lastMessageId;if(h.streamedMessageId){let e=v.A3.getState(),t=e.byId[h.streamedMessageId],s=t.responseId,n=t.inflightResponseId||(0,x.A)();y=n,e.upsertResponse({...t,state:"closed",partial:!0,responseId:n,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(n),e.removeResponse(s)}p.createVoiceUserMessage({userResponseId:u.id,conversationId:f,parentResponseId:y,message:(null==(i=u.content)?void 0:i[0].text)||(null==(r=u.content)?void 0:r[0].transcript)||"",onUserResponse:e=>{h.setLastMessageId(e.responseId)},onOptimisticModelResponse:e=>{h.setStreamedMessageId(e.responseId)}})},this.handleAssistantVoiceResponseCreated=e=>{let{response:t}=e;if(!(null==t?void 0:t.id))return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing response id");let s=this.get(),n=v.A3.getState();if(!s.streamedMessageId)return;let o=n.byId[s.streamedMessageId];return o&&(null==o?void 0:o.parentResponseId)?n.byId[o.parentResponseId]?void(o.inflightResponseId?n.upsertResponse({...o,message:"",inflightResponseId:t.id,state:"streaming"}):(n.upsertResponse({...o,inflightResponseId:t.id,state:"streaming"}),s.setStreamedMessageId(o.responseId))):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing parent response"):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing streaming response or parent response id")},this.handleAssistantVoiceResponseTranscriptDelta=e=>{let{response_id:t,delta:s}=e;if(!t||!s)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing response_id or delta");let n=v.A3.getState(),o=this.get();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing conversationId");let i=n.byConversationId[o.conversationId].find(e=>e.inflightResponseId===t);i&&"streaming"===i.state&&n.upsertResponse({...i,message:i.message+s})},this.handleVoiceGrokOutput=e=>{let{response_id:t,follow_ups:s}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing response_id");let n=v.A3.getState(),o=this.get();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing conversationId");let i=n.byConversationId[o.conversationId].find(e=>e.inflightResponseId===t);i&&(c.trackAssistantTurn(),n.upsertResponse({...i,state:"closed",partial:!1,responseId:t,suggestions:s,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(t),n.removeResponse(i.responseId))},this.handleVoiceResponseSearchResult=e=>{let{response_id:t,x_posts:s,web_search_results:n}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response_id");if(!(null==s?void 0:s.length)&&!(null==n?void 0:n.length))return;let o=this.get(),i=v.A3.getState();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing conversationId");let r=i.byConversationId[o.conversationId],l=i.byId[t]||r.find(e=>e.inflightResponseId===t);if(!l)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response");let d=(null==s?void 0:s.map(e=>({username:e.userhandle,name:e.name,text:e.text,createTime:e.create_time,profileImageUrl:e.profile_image_url,postId:e.post_id,viewCount:e.view_count,citationId:e.post_id})))||[],c=(null==n?void 0:n.map(e=>({url:e.url,title:e.title,preview:e.snippet})))||[];i.upsertResponse({...l,xposts:(null==d?void 0:d.length)?d:l.xposts,xpostIds:(null==d?void 0:d.length)?C().compact(null==d?void 0:d.map(e=>e.postId)):l.xpostIds,webSearchResults:(null==c?void 0:c.length)?c:l.webSearchResults}),d.length?o.setSidePanelContent({type:"xPosts",data:d}):c.length&&o.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:c}})},this.setShowStreamingIndicator=(0,u.kp)(this.set,"showStreamingIndicator")}}let U=(0,_.v)()((0,R.eh)((0,R.Zr)((e,t)=>new z(e,t),{name:"chat-preferences",partialize:e=>({outputMode:e.outputMode,activeModelId:e.activeModelId,selectedPersonalityId:e.selectedPersonalityId,customPersonality:e.customPersonality,quotedText:e.quotedText,defaultAnonModelId:e.defaultAnonModelId,defaultFreeModelId:e.defaultFreeModelId,defaultProModelId:e.defaultProModelId,voiceId:e.voiceId,voicePersonalityId:e.voicePersonalityId,voiceCustomInstructions:e.voiceCustomInstructions,voicePlaybackSpeed:e.voicePlaybackSpeed,modelSliderMode:e.modelSliderMode}),version:2})));function D(e,t){switch(t){case"deepsearch":case"deepersearch":return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0,videoGen:void 0}}switch(e){case"modelOnly":return{imageGen:!1,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1,videoGen:void 0};case"noSearch":return{imageGen:void 0,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1,videoGen:void 0};default:return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0,videoGen:void 0}}}function O(e){var t,s,n,o,i,r,a,l,d;let{personalityId:c,voiceId:u,ff:h}=e,m=Array.isArray(null==h||null==(s=h.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.personalities)?null==h||null==(o=h.VOICE_MODE_CONFIG)||null==(n=o.value)?void 0:n.personalities:[],p=(Array.isArray(null==h||null==(r=h.VOICE_MODE_CONFIG)||null==(i=r.value)?void 0:i.voices)?null==h||null==(l=h.VOICE_MODE_CONFIG)||null==(a=l.value)?void 0:a.voices:[]).find(e=>e.id===u),g=!1;return!c||(null==p?void 0:p.disablePersonalities)||(g=(null==(d=m.find(e=>e.id===c&&e.enableSearch))?void 0:d.enableSearch)||!1),g}function F(e){var t,s,n,o;let{username:i,voiceId:r,personalityId:a,customInstructions:l,playbackSpeed:d,ff:c}=e,u=(Array.isArray(null==c||null==(s=c.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.voices)?null==c||null==(o=c.VOICE_MODE_CONFIG)||null==(n=o.value)?void 0:n.voices:[]).find(e=>e.id===r),h=null;!a||(null==u?void 0:u.disablePersonalities)||(h=a);let m=null;return!l||(null==u?void 0:u.disablePersonalities)||(m=l),{instructions:function(e){var t,s,n,o,i,r,a,l,d,c;let{username:u,customInstructions:h,voiceId:m,personalityId:p,ff:g}=e,v=Array.isArray(null==g||null==(s=g.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.voices)?null==g||null==(o=g.VOICE_MODE_CONFIG)||null==(n=o.value)?void 0:n.voices:[],f=Array.isArray(null==g||null==(r=g.VOICE_MODE_CONFIG)||null==(i=r.value)?void 0:i.personalities)?null==g||null==(l=g.VOICE_MODE_CONFIG)||null==(a=l.value)?void 0:a.personalities:[],I=(null==v||null==(d=v.find(e=>e.id===m))?void 0:d.prompt)||"Reminder: You do not need to introduce yourself unless the user asks for your name. You are Grok, a smart and helpful AI assistant created by xAI. You have a PLEASANT female voice. You're a helpful AI assistant that helps get things done. Never use commands and write your answer as if it was a transcript of an audio conversation. You are using your voice to speak aloud, so keep your responses brief.",y=(null==f||null==(c=f.find(e=>e.id===p))?void 0:c.prompt)||"";return"".concat(I," ").concat(p?y:""," ").concat(u?"You are speaking with ".concat(u,". Do not repeat the name unless necessary."):""," ").concat(h||"")}({username:i,customInstructions:m,voiceId:r,personalityId:h,ff:c}),voice:r,personality:h,enable_search:O({personalityId:a,voiceId:r,ff:c}),playback_speed:d}}function H(e,t,s){var n,o;if(e)return e;let i=p.V.getState().modelById[s];return((null==i||null==(n=i.tags)?void 0:n.includes("think"))||"think"!==t)&&((null==i||null==(o=i.tags)?void 0:o.includes("deepsearch"))||"deepsearch"!==t&&"deepersearch"!==t)?t:"none"}(0,u.lB)(U,"conversationId","optimisticConversationId",()=>void 0),(0,u.lB)(U,"conversationId","lastMessageId",e=>{if(!e)return}),(0,u.lB)(U,"conversationId","streamedMessageId",e=>{if(!e)return}),(0,u.lB)(U,"conversationId","isRateLimited",()=>!1),(0,u.lB)(U,"conversationId","isUnauthenticated",()=>!1),(0,u.lB)(U,"conversationId","hasDismissedDisclaimer",()=>!1),(0,u.lB)(U,"conversationId","usingExperiment",()=>!1),(0,u.lB)(U,"conversationId","experiments",()=>[]),(0,u.lB)(U,"conversationId","streamingExperimentsIds",()=>[]),(0,u.lB)(U,"activeModelId","isRateLimited",()=>!1),(0,u.lB)(U,"reasoningMode","isRateLimited",()=>!1),U.subscribe(e=>e,(e,t)=>{"voice"===e.conversationMode&&(e.conversationId!==t.conversationId&&e.conversationId!==t.optimisticConversationId&&e.conversationId!==e.optimisticConversationId||!e.conversationId&&t.conversationId)&&U.getState().exitVoiceMode("navigation").catch(e=>{(0,a.vV)("chat-page-store:conversationId","Failed to exit voice mode",e)})}),!function(e){let t=new w.w("/chat/:chatId").test(window.location.pathname);e.setState({conversationId:t?t.chatId:void 0})}(U)},38997:(e,t,s)=>{s.d(t,{$X:()=>o,iM:()=>i,jI:()=>r});var n=s(79342);let o=e=>{let{className:t,isDark:s}=e;return s?(0,n.jsxs)("svg",{viewBox:"0 0 92 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,n.jsx)("path",{d:"M82.7365 14.0405V0.652524H84.8705V9.48811L89.3839 4.34643H91.971L87.9108 8.75288L92.0088 14.0405H89.4594L86.1402 9.49707L84.8705 9.48811V14.0405H82.7365Z",fill:"white"}),(0,n.jsx)("path",{d:"M76.2673 14.2646C73.0947 14.2646 71.3762 12.0333 71.3762 9.18315C71.3762 6.31429 73.0947 4.1017 76.2673 4.1017C79.4588 4.1017 81.1583 6.31429 81.1583 9.18315C81.1583 12.0333 79.4588 14.2646 76.2673 14.2646ZM73.6045 9.18315C73.6045 11.3957 74.8132 12.5021 76.2673 12.5021C77.7402 12.5021 78.93 11.3957 78.93 9.18315C78.93 6.97064 77.7402 5.84556 76.2673 5.84556C74.8132 5.84556 73.6045 6.97064 73.6045 9.18315Z",fill:"white"}),(0,n.jsx)("path",{d:"M65.4377 14.0398V5.88326L67.2317 4.34574H71.0464V6.14581H67.5716V14.0398H65.4377Z",fill:"white"}),(0,n.jsx)("path",{d:"M57.2766 14.2876C53.2092 14.2876 50.7841 11.3587 50.7841 7.36482C50.7841 3.33333 53.2958 0.333252 57.3559 0.333252C60.5285 0.333252 62.8513 1.94581 63.3989 4.94596H60.9629C60.604 3.23965 59.1688 2.28337 57.3559 2.28337C54.4288 2.28337 53.1447 4.79591 53.1447 7.36482C53.1447 9.93365 54.4288 12.4275 57.3559 12.4275C60.1508 12.4275 61.3783 10.4211 61.4727 8.75237H57.2615V6.81079H63.6256L63.6152 7.82591C63.6152 11.5979 62.0651 14.2876 57.2766 14.2876Z",fill:"white"}),(0,n.jsx)("path",{d:"M5.57669 14.3937C2.02955 14.3937 0.182842 12.4556 0 10.0421H2.28553C2.55979 11.8522 3.80312 12.5287 5.57669 12.5287C7.25883 12.5287 8.59358 11.9436 8.59358 10.6089C8.59358 9.74952 7.95363 9.09128 6.36291 8.7256L4.36993 8.28678C2.46837 7.84796 0.3474 7.08002 0.3474 4.59337C0.3474 2.27127 2.35866 0.680545 5.30242 0.680545C8.28275 0.680545 10.3123 2.38098 10.4586 4.99562H8.20961C8.02677 3.22205 6.87487 2.52725 5.30242 2.52725C3.67513 2.52725 2.55979 3.2769 2.55979 4.44709C2.55979 5.39787 3.3643 5.92812 4.84532 6.25723L6.85658 6.73262C9.39809 7.29943 10.8608 8.30506 10.8608 10.4626C10.8608 12.9127 8.64843 14.3937 5.57669 14.3937Z",fill:"white"}),(0,n.jsx)("path",{d:"M15.91 14.2657C13.4782 14.2657 12.6554 12.8396 12.6554 10.8283V4.59337H14.7215V10.7186C14.7215 11.7973 15.3432 12.5104 16.4402 12.5104C18.1041 12.5104 18.9269 11.2671 18.9269 9.67638V4.59337H20.993V14.0463H19.0183V12.4373H18.9817C18.3235 13.6989 17.2813 14.2657 15.91 14.2657Z",fill:"white"}),(0,n.jsx)("path",{d:"M22.9674 17.6666V4.59337H25.0335V5.85498H25.0884C25.7466 4.75793 27.0265 4.35567 27.9956 4.35567C30.7748 4.35567 32.2558 6.62292 32.2558 9.3107C32.2558 11.9985 30.7748 14.2657 27.9956 14.2657C27.0265 14.2657 25.7466 13.8635 25.0884 12.7664H25.0335V17.6666H22.9674ZM24.9787 9.3107C24.9787 10.938 25.7283 12.547 27.5385 12.547C29.3852 12.547 30.0983 10.938 30.0983 9.3107C30.0983 7.62855 29.3852 6.05611 27.5385 6.05611C25.7283 6.05611 24.9787 7.62855 24.9787 9.3107Z",fill:"white"}),(0,n.jsx)("path",{d:"M37.9843 14.2657C35.0223 14.2657 33.3401 12.1813 33.3401 9.3107C33.3401 6.36694 35.0223 4.35567 37.8198 4.35567C40.5441 4.35567 42.208 6.20238 42.2994 9.05472L41.4035 9.89579H35.4428C35.6074 11.5779 36.5033 12.5836 37.9843 12.5836C39.0631 12.5836 39.831 12.0168 40.215 10.9746H42.2628C41.7874 13.1504 40.1784 14.2657 37.9843 14.2657ZM35.4977 8.41477H40.2516C40.0322 6.80576 39.0997 5.98297 37.8198 5.98297C36.6496 5.98297 35.7536 6.87889 35.4977 8.41477Z",fill:"white"}),(0,n.jsx)("path",{d:"M43.821 14.0463V6.09267L45.558 4.59337H49.2514V6.34865H45.8871V14.0463H43.821Z",fill:"white"})]}):(0,n.jsxs)("svg",{viewBox:"0 0 92 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,n.jsx)("path",{d:"M82.7365 14.0405V0.652524H84.8705V9.48811L89.3839 4.34643H91.971L87.9108 8.75288L92.0088 14.0405H89.4594L86.1402 9.49707L84.8705 9.48811V14.0405H82.7365Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M76.2673 14.2646C73.0947 14.2646 71.3762 12.0333 71.3762 9.18315C71.3762 6.31429 73.0947 4.1017 76.2673 4.1017C79.4588 4.1017 81.1583 6.31429 81.1583 9.18315C81.1583 12.0333 79.4588 14.2646 76.2673 14.2646ZM73.6045 9.18315C73.6045 11.3957 74.8132 12.5021 76.2673 12.5021C77.7402 12.5021 78.93 11.3957 78.93 9.18315C78.93 6.97064 77.7402 5.84556 76.2673 5.84556C74.8132 5.84556 73.6045 6.97064 73.6045 9.18315Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M65.4377 14.0398V5.88326L67.2317 4.34574H71.0464V6.14581H67.5716V14.0398H65.4377Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M57.2766 14.2876C53.2092 14.2876 50.7841 11.3587 50.7841 7.36482C50.7841 3.33333 53.2958 0.333252 57.3559 0.333252C60.5285 0.333252 62.8513 1.94581 63.3989 4.94596H60.9629C60.604 3.23965 59.1688 2.28337 57.3559 2.28337C54.4288 2.28337 53.1447 4.79591 53.1447 7.36482C53.1447 9.93365 54.4288 12.4275 57.3559 12.4275C60.1508 12.4275 61.3783 10.4211 61.4727 8.75237H57.2615V6.81079H63.6256L63.6152 7.82591C63.6152 11.5979 62.0651 14.2876 57.2766 14.2876Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M5.57669 14.3937C2.02955 14.3937 0.182842 12.4556 0 10.0421H2.28553C2.55979 11.8522 3.80312 12.5287 5.57669 12.5287C7.25883 12.5287 8.59358 11.9436 8.59358 10.6089C8.59358 9.74952 7.95363 9.09128 6.36291 8.7256L4.36993 8.28678C2.46837 7.84796 0.3474 7.08002 0.3474 4.59337C0.3474 2.27127 2.35866 0.680545 5.30242 0.680545C8.28275 0.680545 10.3123 2.38098 10.4586 4.99562H8.20961C8.02677 3.22205 6.87487 2.52725 5.30242 2.52725C3.67513 2.52725 2.55979 3.2769 2.55979 4.44709C2.55979 5.39787 3.3643 5.92812 4.84532 6.25723L6.85658 6.73262C9.39809 7.29943 10.8608 8.30506 10.8608 10.4626C10.8608 12.9127 8.64843 14.3937 5.57669 14.3937Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M15.91 14.2657C13.4782 14.2657 12.6554 12.8396 12.6554 10.8283V4.59337H14.7215V10.7186C14.7215 11.7973 15.3432 12.5104 16.4402 12.5104C18.1041 12.5104 18.9269 11.2671 18.9269 9.67638V4.59337H20.993V14.0463H19.0183V12.4373H18.9817C18.3235 13.6989 17.2813 14.2657 15.91 14.2657Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M22.9674 17.6666V4.59337H25.0335V5.85498H25.0884C25.7466 4.75793 27.0265 4.35567 27.9956 4.35567C30.7748 4.35567 32.2558 6.62292 32.2558 9.3107C32.2558 11.9985 30.7748 14.2657 27.9956 14.2657C27.0265 14.2657 25.7466 13.8635 25.0884 12.7664H25.0335V17.6666H22.9674ZM24.9787 9.3107C24.9787 10.938 25.7283 12.547 27.5385 12.547C29.3852 12.547 30.0983 10.938 30.0983 9.3107C30.0983 7.62855 29.3852 6.05611 27.5385 6.05611C25.7283 6.05611 24.9787 7.62855 24.9787 9.3107Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M37.9843 14.2657C35.0223 14.2657 33.3401 12.1813 33.3401 9.3107C33.3401 6.36694 35.0223 4.35567 37.8198 4.35567C40.5441 4.35567 42.208 6.20238 42.2994 9.05472L41.4035 9.89579H35.4428C35.6074 11.5779 36.5033 12.5836 37.9843 12.5836C39.0631 12.5836 39.831 12.0168 40.215 10.9746H42.2628C41.7874 13.1504 40.1784 14.2657 37.9843 14.2657ZM35.4977 8.41477H40.2516C40.0322 6.80576 39.0997 5.98297 37.8198 5.98297C36.6496 5.98297 35.7536 6.87889 35.4977 8.41477Z",fill:"#141414"}),(0,n.jsx)("path",{d:"M43.821 14.0463V6.09267L45.558 4.59337H49.2514V6.34865H45.8871V14.0463H43.821Z",fill:"#141414"})]})},i=e=>{let{className:t,isDark:s}=e;return(0,n.jsxs)("svg",{width:"248",height:"65",viewBox:"0 0 248 65",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,n.jsx)("g",{filter:"url(#filter0_i_3682_180386)",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M43.7186 27.4612L25.9882 40.5653L51.387 15.0223V15.0451L58.7231 7.7002C58.5911 7.88701 58.4591 8.06926 58.3271 8.25152C52.7522 15.9381 50.0308 19.6971 52.2152 29.1015L52.2016 29.0878C53.7079 35.4895 52.0969 42.5884 46.8952 47.7963C40.3373 54.3666 29.8428 55.8292 21.2006 49.915L27.226 47.122C32.7418 49.2908 38.7763 48.3385 43.1134 43.9963C47.4504 39.6541 48.4243 33.3298 46.2444 28.0672C45.8303 27.0694 44.5879 26.8188 43.7186 27.4612ZM22.4885 23.3422C17.1958 28.6367 16.1263 37.8178 22.3292 43.7502L22.3247 43.7548L5.39062 58.9002C6.45033 57.4391 7.76256 56.0579 9.0738 54.6777L9.07384 54.6777L9.12695 54.6218L9.13789 54.6102C12.8842 50.6683 16.5974 46.7612 14.3287 41.2397C11.2886 33.8447 13.059 25.1785 18.6885 19.5422C24.541 13.6873 33.1605 12.211 40.36 15.1772C41.9529 15.7695 43.3409 16.6125 44.424 17.3962L38.4122 20.1756C32.8146 17.8245 26.4023 19.4238 22.4885 23.3422ZM175.307 45.9806C167.498 45.9806 162.841 40.357 162.841 32.6888C162.841 24.9484 167.664 19.1882 175.459 19.1882C181.551 19.1882 186.01 22.2843 187.062 28.0446H182.385C181.696 24.7685 178.94 22.9325 175.459 22.9325C169.839 22.9325 167.374 27.7565 167.374 32.6888C167.374 37.621 169.839 42.4091 175.459 42.4091C180.826 42.4091 183.182 38.5569 183.364 35.3529H175.278V31.6251H187.497L187.477 33.5741C187.477 40.8163 184.501 45.9806 175.307 45.9806ZM224.19 45.5062V19.8012H228.287V36.7656V45.5062H224.19ZM228.287 36.7656L236.953 26.8935H241.92L234.125 35.3539L241.993 45.5062H237.098L230.725 36.7828L228.287 36.7656ZM211.769 45.9364C205.678 45.9364 202.378 41.6523 202.378 36.18C202.378 30.6718 205.678 26.4237 211.769 26.4237C217.897 26.4237 221.16 30.6718 221.16 36.18C221.16 41.6523 217.897 45.9364 211.769 45.9364ZM206.657 36.18C206.657 40.4282 208.977 42.5524 211.769 42.5524C214.597 42.5524 216.881 40.4282 216.881 36.18C216.881 31.932 214.597 29.7719 211.769 29.7719C208.977 29.7719 206.657 31.932 206.657 36.18ZM190.976 29.8442V45.5049H195.073V30.3483H201.745V26.8922H194.421L190.976 29.8442ZM65.3359 37.8292C65.687 42.4631 69.2327 46.1843 76.0432 46.1843C81.9409 46.1843 86.1887 43.3407 86.1887 38.6366C86.1887 34.4941 83.3803 32.5633 78.5006 31.475L74.6389 30.5623C71.7954 29.9304 70.2507 28.9123 70.2507 27.0868C70.2507 24.84 72.3922 23.4007 75.5166 23.4007C78.5357 23.4007 80.7473 24.7347 81.0984 28.14H85.4164C85.1356 23.1199 81.2388 19.855 75.5166 19.855C69.8646 19.855 66.0029 22.9092 66.0029 27.3677C66.0029 32.142 70.0752 33.6165 73.7262 34.459L77.5527 35.3015C80.6069 36.0037 81.8356 37.2675 81.8356 38.9174C81.8356 41.4801 79.2729 42.6035 76.0432 42.6035C72.6379 42.6035 70.2507 41.3046 69.7242 37.8292H65.3359ZM95.8831 45.9386C91.2141 45.9386 89.6343 43.2003 89.6343 39.3387V27.3677H93.6012V39.1281C93.6012 41.1993 94.7948 42.5684 96.9012 42.5684C100.096 42.5684 101.676 40.1812 101.676 37.127V27.3677H105.642V45.5173H101.851V42.428H101.781C100.517 44.8503 98.516 45.9386 95.8831 45.9386ZM109.433 27.3677V52.4682H113.4V43.0599H113.506C114.769 45.1662 117.227 45.9386 119.087 45.9386C124.423 45.9386 127.267 41.5855 127.267 36.4249C127.267 31.2644 124.423 26.9113 119.087 26.9113C117.227 26.9113 114.769 27.6836 113.506 29.7899H113.4V27.3677H109.433ZM118.21 42.6386C114.734 42.6386 113.295 39.5493 113.295 36.4249C113.295 33.1952 114.734 30.1761 118.21 30.1761C121.755 30.1761 123.125 33.1952 123.125 36.4249C123.125 39.5493 121.755 42.6386 118.21 42.6386ZM138.266 45.9386C132.579 45.9386 129.349 41.9365 129.349 36.4249C129.349 30.7729 132.579 26.9113 137.95 26.9113C143.181 26.9113 146.375 30.457 146.551 35.9334L144.831 37.5483H133.386C133.702 40.778 135.422 42.7088 138.266 42.7088C140.337 42.7088 141.811 41.6206 142.549 39.6195H146.481C145.568 43.7971 142.479 45.9386 138.266 45.9386ZM133.491 34.7047H142.619C142.198 31.6154 140.407 30.0357 137.95 30.0357C135.703 30.0357 133.983 31.7559 133.491 34.7047ZM149.472 30.2463V45.5173H153.439V30.7378H159.899V27.3677H152.807L149.472 30.2463Z",fill:s?"white":"black"})}),(0,n.jsx)("defs",{children:(0,n.jsxs)("filter",{id:"filter0_i_3682_180386",x:"5.39062",y:"7.7002",width:"236.602",height:"51.2",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,n.jsx)("feOffset",{dy:"0.655766"}),(0,n.jsx)("feComposite",{in2:"hardAlpha",operator:"arithmetic",k2:"-1",k3:"1"}),(0,n.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.2 0"}),(0,n.jsx)("feBlend",{mode:"normal",in2:"shape",result:"effect1_innerShadow_3682_180386"})]})})]})},r=e=>{let{className:t}=e;return(0,n.jsxs)("svg",{height:32,width:124,viewBox:"0 0 124 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,n.jsx)("g",{filter:"url(#filter0_i_3927_275932)",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8593 13.4806L12.9941 20.0327L25.6935 7.26115V7.27254L29.3615 3.6001C29.2955 3.6935 29.2296 3.78463 29.1636 3.87576C26.3761 7.71906 25.0154 9.59857 26.1076 14.3007L26.1008 14.2939C26.854 17.4948 26.0485 21.0442 23.4476 23.6482C20.1686 26.9333 14.9214 27.6646 10.6003 24.7075L13.613 23.311C16.3709 24.3954 19.3882 23.9193 21.5567 21.7481C23.7252 19.577 24.2122 16.4149 23.1222 13.7836C22.9151 13.2847 22.2939 13.1594 21.8593 13.4806ZM11.2443 11.4211C8.59788 14.0684 8.06314 18.6589 11.1646 21.6251L11.1623 21.6274L2.69531 29.2001C3.22516 28.4696 3.88128 27.7789 4.5369 27.0889L4.53692 27.0888L4.56347 27.0609L4.56894 27.0551C6.44208 25.0842 8.29869 23.1306 7.16433 20.3698C5.64432 16.6723 6.52948 12.3392 9.34423 9.52111C12.2705 6.59364 16.5802 5.8555 20.18 7.3386C20.9764 7.63477 21.6705 8.05623 22.212 8.44808L19.2061 9.83778C16.4073 8.66223 13.2012 9.46188 11.2443 11.4211ZM87.6548 22.7404C83.7501 22.7404 81.422 19.9286 81.422 16.0945C81.422 12.2243 83.8332 9.34424 87.731 9.34424C90.7766 9.34424 93.0065 10.8923 93.5322 13.7724H91.1936C90.8491 12.1344 89.4713 11.2164 87.731 11.2164C84.9209 11.2164 83.6882 13.6284 83.6882 16.0945C83.6882 18.5606 84.9209 20.9547 87.731 20.9547C90.4141 20.9547 91.5924 19.0286 91.6831 17.4266H87.6403V15.5627H93.7498L93.7399 16.5372C93.7399 20.1583 92.2518 22.7404 87.6548 22.7404ZM112.096 22.5032V9.65074H114.145V18.1329V22.5032H112.096ZM114.145 18.1329L118.478 13.1969H120.961L117.064 17.4271L120.998 22.5032H118.55L115.364 18.1415L114.145 18.1329ZM105.886 22.7183C102.84 22.7183 101.19 20.5763 101.19 17.8401C101.19 15.086 102.84 12.9619 105.886 12.9619C108.95 12.9619 110.581 15.086 110.581 17.8401C110.581 20.5763 108.95 22.7183 105.886 22.7183ZM103.33 17.8401C103.33 19.9642 104.49 21.0263 105.886 21.0263C107.3 21.0263 108.442 19.9642 108.442 17.8401C108.442 15.7161 107.3 14.6361 105.886 14.6361C104.49 14.6361 103.33 15.7161 103.33 17.8401ZM95.4894 14.6722V22.5026H97.538V14.9243H100.874V13.1962H97.2117L95.4894 14.6722ZM32.6693 18.6647C32.8448 20.9817 34.6176 22.8423 38.0229 22.8423C40.9718 22.8423 43.0957 21.4205 43.0957 19.0684C43.0957 16.9972 41.6914 16.0318 39.2516 15.4876L37.3208 15.0313C35.899 14.7153 35.1267 14.2063 35.1267 13.2935C35.1267 12.1701 36.1974 11.4505 37.7596 11.4505C39.2691 11.4505 40.375 12.1175 40.5505 13.8201H42.7095C42.5691 11.3101 40.6207 9.67764 37.7596 9.67764C34.9336 9.67764 33.0028 11.2047 33.0028 13.4339C33.0028 15.8211 35.0389 16.5584 36.8644 16.9796L38.7777 17.4009C40.3048 17.752 40.9191 18.3839 40.9191 19.2088C40.9191 20.4902 39.6378 21.0519 38.0229 21.0519C36.3203 21.0519 35.1267 20.4024 34.8634 18.6647H32.6693ZM47.9429 22.7194C45.6083 22.7194 44.8185 21.3503 44.8185 19.4195V13.4339H46.8019V19.3142C46.8019 20.3498 47.3987 21.0343 48.4519 21.0343C50.0492 21.0343 50.8391 19.8407 50.8391 18.3136V13.4339H52.8225V22.5088H50.9268V20.9641H50.8917C50.2598 22.1753 49.2593 22.7194 47.9429 22.7194ZM54.718 13.4339V25.9842H56.7015V21.2801H56.7541C57.386 22.3332 58.6147 22.7194 59.545 22.7194C62.213 22.7194 63.6348 20.5429 63.6348 17.9626C63.6348 15.3823 62.213 13.2058 59.545 13.2058C58.6147 13.2058 57.386 13.5919 56.7541 14.6451H56.7015V13.4339H54.718ZM59.1062 21.0694C57.3685 21.0694 56.6488 19.5248 56.6488 17.9626C56.6488 16.3477 57.3685 14.8382 59.1062 14.8382C60.879 14.8382 61.5636 16.3477 61.5636 17.9626C61.5636 19.5248 60.879 21.0694 59.1062 21.0694ZM69.1342 22.7194C66.2907 22.7194 64.6758 20.7184 64.6758 17.9626C64.6758 15.1366 66.2907 13.2058 68.9762 13.2058C71.5916 13.2058 73.1889 14.9786 73.2767 17.7168L72.4166 18.5243H66.6944C66.8523 20.1391 67.7124 21.1045 69.1342 21.1045C70.1698 21.1045 70.9071 20.5604 71.2757 19.5599H73.2416C72.7852 21.6487 71.2406 22.7194 69.1342 22.7194ZM66.747 17.1025H71.3108C71.1001 15.5578 70.2049 14.768 68.9762 14.768C67.8529 14.768 66.9928 15.6281 66.747 17.1025ZM74.7374 14.8733V22.5088H76.7209V15.119H79.9506V13.4339H76.4049L74.7374 14.8733Z",fill:"url(#paint0_linear_3927_275932)"})}),(0,n.jsxs)("defs",{children:[(0,n.jsxs)("filter",{id:"filter0_i_3927_275932",x:"2.69531",y:"3.6001",width:"118.301",height:"25.6001",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),(0,n.jsx)("feOffset",{dy:"0.416667"}),(0,n.jsx)("feComposite",{in2:"hardAlpha",operator:"arithmetic",k2:"-1",k3:"1"}),(0,n.jsx)("feColorMatrix",{type:"matrix",values:"0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.2 0"}),(0,n.jsx)("feBlend",{mode:"normal",in2:"shape",result:"effect1_innerShadow_3927_275932"})]}),(0,n.jsxs)("linearGradient",{id:"paint0_linear_3927_275932",x1:"61.8465",y1:"3.6001",x2:"61.8465",y2:"29.2001",gradientUnits:"userSpaceOnUse",children:[(0,n.jsx)("stop",{stopColor:"white",stopOpacity:"0.9"}),(0,n.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.5"})]})]})]})}},41320:(e,t,s)=>{s.d(t,{Di:()=>o,Iu:()=>i});var n=s(88382);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,s]=n.useState(void 0);return n.useEffect(()=>{let t=window.matchMedia("(max-width: ".concat(e-1,"px)")),n=()=>{s(window.innerWidth<e)};return t.addEventListener("change",n),s(window.innerWidth<e),()=>t.removeEventListener("change",n)},[e]),!!t}function i(){let e=o();return{isMobileSize:function(){return e},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},41739:(e,t,s)=>{s.d(t,{a:()=>d});var n=s(65258),o=s(38541),i=s.n(o),r=s(4890),a=s(17823);class l{constructor(e,t){var s=this;this.set=e,this.get=t,this.drawerOpen=!1,this.menuFixed=!0,this.menuHidden=!0,this.tabByConversationId={},this.inEditId=void 0,this.upsertConversationAsTab=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=s.get(),r=t?o.tabByConversationId[t]:void 0;r&&t&&o.removeTab(t);let a=r||o.tabByConversationId[e.conversationId];if(a)return void o.upsertTab({isTemporary:e.temporary,title:e.title,index:a.index,conversationId:e.conversationId,isPreserved:a.isPreserved});o.setTabByConversationId({...i().mapValues(o.tabByConversationId,e=>({...e,index:e.index+1})),[e.conversationId]:{isTemporary:e.temporary,title:e.title,index:0,conversationId:e.conversationId,isPreserved:n}})},this.upsertTab=(0,n.el)(this.set,"tabByConversationId","conversationId"),this.removeTab=(0,n.TF)(this.set,"tabByConversationId"),this.appendTabByConversationId=(0,n.BC)(this.set,"tabByConversationId","conversationId"),this.setTabByConversationId=(0,n.kp)(this.set,"tabByConversationId"),this.setDrawerOpen=(0,n.kp)(this.set,"drawerOpen"),this.toggleMenuFixed=(0,n.L$)(this.set,"menuFixed"),this.setMenuFixed=(0,n.kp)(this.set,"menuFixed"),this.setMenuHidden=(0,n.kp)(this.set,"menuHidden"),this.setInEditId=(0,n.kp)(this.set,"inEditId")}}let d=(0,r.v)()((0,a.eh)((0,a.Zr)((e,t)=>new l(e,t),{name:"active-chat-tabs",storage:(0,a.KU)(()=>localStorage),partialize:e=>({tabByConversationId:i().omitBy(e.tabByConversationId,e=>!e.isTemporary&&e.isPreserved)}),version:2})))},43893:(e,t,s)=>{s.d(t,{Jg:()=>B,Pn:()=>U,Ko:()=>L,Mn:()=>R,dr:()=>N,A3:()=>E});var n=s(12971),o=s(75500),i=s(4295),r=s(98100),a=s(44845),l=s(48992),d=s(17703),c=s(33960),u=s(65258),h=s(56173),m=s(5129);async function*p(e){if(null===e.body)throw Error("Cannot process response chunks of a response without body.");let t=e.body.getReader(),s=new TextDecoder,n="";for(;;){let{done:e,value:o}=await t.read();if(e)break;let[i,r]=g(n+=s.decode(o,{stream:!0}));for(let e of i)yield e;n=r}let[o,i]=g(n);for(let e of o)yield e;i.length>0&&(yield i)}function g(e){let t=e.split("\n"),s=t.pop();return[t,s]}async function*v(e){for await(let t of p(e))try{let s=JSON.parse(t);(0,m.YM)(s,e),yield s}catch(t){(0,m.YM)(t,e)}}var f=s(44347),I=s(13511),y=s(99452),S=s.n(y),C=s(38541),w=s.n(C),b=s(81353),x=s(6132),k=s(49972),_=s(56096);let R=x.z.object({memoryReferences:x.z.array(x.z.object({conversationId:x.z.string()})).optional().catch(void 0),deepsearchPreset:x.z.string().optional().catch(void 0),ui_layout:x.z.object({reasoningUiLayout:x.z.enum(["UNIFIED","SPLIT"]).optional().catch(void 0)}).optional().catch(void 0),artifactAction:x.z.enum(["ask","explain"]).optional().catch(void 0),agenticWorkspace:x.z.object({workspaceId:x.z.string()}).optional().catch(void 0),requestModelDetails:x.z.object({modelId:x.z.string().nullish(),name:x.z.string().nullish(),description:x.z.string().nullish()}).optional().catch(void 0),modelConfigOverride:f.DC.optional().catch(void 0),isMozart:x.z.boolean().optional().catch(void 0),parentQuotedText:x.z.string().optional().catch(void 0),usedCustomInstructions:x.z.boolean().optional().catch(void 0)}),M={nodesPromisesByConversationId:{},nodesByConversationId:{},initialResponsesPromisesByConversationId:{},loadMoreResponsesPromisesByConversationId:{},previewResponsesPromisesByConversationIdResponseId:{},conversationImageResponsesPromisesByConversationId:{},byId:{},byConversationId:{},imageIdByUrl:{},inflightPromisesByConversationId:{}};class T{constructor(e,t){var s=this;this.set=e,this.get=t,this.nodesPromisesByConversationId=M.nodesPromisesByConversationId,this.nodesByConversationId=M.nodesByConversationId,this.initialResponsesPromisesByConversationId=M.initialResponsesPromisesByConversationId,this.loadMoreResponsesPromisesByConversationId=M.loadMoreResponsesPromisesByConversationId,this.previewResponsesPromisesByConversationIdResponseId=M.previewResponsesPromisesByConversationIdResponseId,this.conversationImageResponsesPromisesByConversationId=M.conversationImageResponsesPromisesByConversationId,this.byId=M.byId,this.byConversationId=M.byConversationId,this.imageIdByUrl=M.imageIdByUrl,this.inflightPromisesByConversationId=M.inflightPromisesByConversationId,this.upsertResponse=(0,u.el)(this.set,"byId","responseId"),this.appendResponses=(0,u.BC)(this.set,"byId","responseId"),this.removeResponse=(0,u.TF)(this.set,"byId"),this.idsertInitialResponsesPromisesByConversationId=(0,u.q5)(this.set,"initialResponsesPromisesByConversationId"),this.removeInitialResponsesPromiseByConversationId=(0,u.TF)(this.set,"initialResponsesPromisesByConversationId"),this.idsertLoadMoreResponsesPromisesByConversationId=(0,u.q5)(this.set,"loadMoreResponsesPromisesByConversationId"),this.removeLoadMoreResponsesPromiseByConversationId=(0,u.TF)(this.set,"loadMoreResponsesPromisesByConversationId"),this.idsertPreviewResponsesPromisesByConversationIdResponseId=(0,u.q5)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.removePreviewResponsesPromiseByConversationIdResponseId=(0,u.TF)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.idsertConversationImageResponsesPromisesByConversationId=(0,u.q5)(this.set,"conversationImageResponsesPromisesByConversationId"),this.removeConversationImageResponsesPromiseByConversationId=(0,u.TF)(this.set,"conversationImageResponsesPromisesByConversationId"),this.setOneImageIdByUrl=(0,u.q5)(this.set,"imageIdByUrl"),this.idsertInflightPromisesByConversationId=(0,u.q5)(this.set,"inflightPromisesByConversationId"),this.idsertNodesByConversationId=(0,u.q5)(this.set,"nodesByConversationId"),this.idsertNodesPromisesByConversationId=(0,u.q5)(this.set,"nodesPromisesByConversationId"),this.removeNodesPromise=(0,u.TF)(this.set,"nodesPromisesByConversationId"),this.fetchListResponseNodes=async e=>{let t=this.get();if(t.nodesByConversationId[e])return t.nodesByConversationId[e];if(e in t.nodesPromisesByConversationId)return t.nodesPromisesByConversationId[e];let s=h.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{responseNodes:t=[]}=e;return t});return t.idsertNodesPromisesByConversationId(s,e),s.then(s=>{t.idsertNodesByConversationId(s,e)}).catch(console.error).finally(()=>{t.removeNodesPromise(e)}),s},this.fetchListInflightResponses=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=s.get();if(!t&&e in n.inflightPromisesByConversationId)return n.inflightPromisesByConversationId[e];let o=h.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{inflightResponses:t=[]}=e;return t});return n.idsertInflightPromisesByConversationId(o,e),o.then(n.appendResponses).catch(console.error),o},this.loadResponses=async(e,t)=>{let s=this.get(),n=t.filter(e=>!s.byId[e]);if(n.length){var o;let t=((null==(o=await h.chatApi.chatLoadResponses({conversationId:e,body:{responseIds:n}}))?void 0:o.responses)||[]).map(t=>{let s=R.optional().parse(t.metadata),{toolUsageResultById:n,traceSteps:o}=U(t.steps);return{...t,conversationId:e,memoryReferences:null==s?void 0:s.memoryReferences,deepsearchPreset:null==s?void 0:s.deepsearchPreset,parentQuotedText:null==s?void 0:s.parentQuotedText,usedCustomInstructions:null==s?void 0:s.usedCustomInstructions,toolUsageResultById:n,traceSteps:o}});s.appendResponses(t)}return t.map(e=>this.get().byId[e]).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())},this.loadInitialResponses=async e=>{let t=this.get(),s=t.initialResponsesPromisesByConversationId[e];if(s)return s;let n=t.nodesPromisesByConversationId[e];return n||(n=this.fetchListResponseNodes(e)),s=(async()=>{try{let s=await n;if(!s.length)return[];let o=s[s.length-1],i=(0,l.d7)(o.responseId||"",s,30).filter(e=>!!e.responseId).map(e=>e.responseId);return t.loadResponses(e,i)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeInitialResponsesPromiseByConversationId(e)}),t.idsertInitialResponsesPromisesByConversationId(s,e),s},this.loadMoreResponses=async(e,t)=>{let s=this.get(),n=s.nodesByConversationId[e];if(!n.length)return[];if(e in s.initialResponsesPromisesByConversationId)return s.initialResponsesPromisesByConversationId[e];let o=s.loadMoreResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=s.byConversationId[e]||[],i=(0,l.d7)(t,n),r=(0,l.m$)(i,o),a=i.findIndex(e=>e.responseId===(null==r?void 0:r.responseId)),d=i.slice(a+1,a+30+1).filter(e=>!!e.responseId).map(e=>e.responseId);return s.loadResponses(e,d)}catch(e){return console.error(e),[]}})().finally(()=>{s.removeLoadMoreResponsesPromiseByConversationId(e)}),s.idsertLoadMoreResponsesPromisesByConversationId(o,e)),o},this.loadPreviewResponses=async(e,t)=>{let s=this.get(),n=s.nodesPromisesByConversationId[e];n||(n=this.fetchListResponseNodes(e));let o=s.previewResponsesPromisesByConversationIdResponseId[e+t];return o||(o=(async()=>{try{let o=await n,i=(0,l.d7)(o[o.length-1].responseId,o);if(!i.length)return{responses:[],hasOlderResponses:!1,hasNewerResponses:!1};let r=[];if(t&&i.some(e=>e.responseId===t)){let e=i.findIndex(e=>e.responseId===t),s=Math.max(0,e-5);r=i.slice(s,e+5+1).map(e=>e.responseId)}else r=i.slice(0,10).map(e=>e.responseId);let a=i[i.length-1],d=i[0],c=await s.loadResponses(e,r);return{responses:c,hasOlderResponses:!(null==c?void 0:c.some(e=>e.responseId===a.responseId)),hasNewerResponses:!(null==c?void 0:c.some(e=>e.responseId===d.responseId))}}catch(e){return console.error(e),{responses:[],hasOlderResponses:!1,hasNewerResponses:!1}}})(),s.idsertPreviewResponsesPromisesByConversationIdResponseId(o,e+t)),o},this.loadConversationBranch=async(e,t,s)=>{let n=this.get(),o=n.nodesByConversationId[e];if(!o.length)return[];let i=(0,l.d7)(t,o),r=i.slice(0,i.findIndex(e=>e.responseId===s)+1).filter(e=>!!e.responseId).map(e=>e.responseId);return n.loadResponses(e,r)},this.loadConversationImageResponses=async e=>{let t=this.get(),s=t.nodesPromisesByConversationId[e];s||(s=this.fetchListResponseNodes(e));let n=t.conversationImageResponsesPromisesByConversationId[e];return n||(n=(async()=>{try{let n=(await s).map(e=>e.responseId);return await t.loadResponses(e,n)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeConversationImageResponsesPromiseByConversationId(e)}),t.idsertConversationImageResponsesPromisesByConversationId(n,e)),n},this.processResponseChunk=e=>{var t,s,n,o,i,r,a,l,d;let{currentStreamResponse:c,responseChunk:u,onCitations:h,onHasImage:m,onDisclaimer:p,onFollowUpSuggestedMode:g,onUiLayout:v}=e,f=this.get(),{responseId:I,token:y,modelResponse:S,webSearchResults:C,citedWebSearchResults:b,xSearchResults:x,queryAction:k,cachedImageGenerationResponse:_,followUpSuggestions:R,cardAttachment:M,streamingImageGenerationResponse:T,finalMetadata:P,isThinking:E,messageTag:N,messageStepId:B,bannerMessage:V,disclaimer:A,imageAttachmentInfo:j,progressReport:L,memoryReferences:z,imageDimensions:U,followUpSuggestedMode:D,uiLayout:O,authNotification:F,toolUsageCardId:H}=u;if(void 0!=B&&c.steps.length<=B&&(c.steps=[...c.steps,...w().map(Array(B-c.steps.length+1),()=>({text:[],tags:[],webSearchResults:[],xpostIds:[],xposts:[],toolUsageResults:[]}))]),I&&c.inflightResponseId!==I&&(c.inflightResponseId=I),k&&(("aurora"===k.type||"flux"===k.type)&&(c.hasImages=!0,m()),"x"===k.type&&(c.hasSearches=!0)),j&&j.imageAttachmentCount&&(c.imageAttachmentCount=j.imageAttachmentCount),U&&(U.height&&(c.generatedImageHeight=U.height),U.width&&(c.generatedImageWidth=U.width)),null==C?void 0:C.results)if(void 0!=B){let e=c.steps[B];if(e.webSearchResults=C.results||[],H){let t={toolUsageCardId:H,webSearchResults:{results:C.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else 0===c.steps.length&&(c.webSearchResults=[...c.webSearchResults||[],...C.results||[]],h());if(null==x?void 0:x.results)if(void 0!=B){let e=c.steps[B];if(e){if(e.xposts=x.results||[],e.xpostIds=w().compact(e.xposts.map(e=>e.postId)),H){let t={toolUsageCardId:H,xSearchResults:{results:x.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else c.steps.push({text:[],tags:[],webSearchResults:[],xpostIds:w().compact(x.results.map(e=>e.postId)),xposts:x.results||[],toolUsageResults:H?[{toolUsageCardId:H,xSearchResults:{results:x.results}}]:[]})}else 0===c.steps.length&&(c.xposts=[...c.xposts||[],...x.results||[]],c.xpostIds=w().compact(c.xposts.map(e=>e.postId)),h());if((null==b?void 0:b.results)&&(c.citedWebSearchResults=[...c.citedWebSearchResults||[],...b.results||[]],h()),_&&_.imageUrl&&(c.generatedImageUrls=c.generatedImageUrls.concat([_.imageUrl])),M&&M.jsonData&&(c.cardAttachmentsJson=c.cardAttachmentsJson.concat([M.jsonData])),z&&(null==(t=z.references)?void 0:t.length)&&(c.memoryReferences=z.references),E&&!c.liveThinkingStartTime&&(c.liveThinkingStartTime=new Date(c.createTime).getTime()),"summary"===N?(y&&(y.includes("xai:tool_usage_card")?c.traceSteps.push({type:"tool",text:y}):c.traceSteps.push({type:"summary",text:y})),H&&(C&&(null!=(s=c.toolUsageResultById)[H]||(s[H]={}),c.toolUsageResultById={...c.toolUsageResultById,[H]:{...c.toolUsageResultById[H],webSearchResults:C}},c.webSearchResults=[...c.webSearchResults||[],...C.results||[]]),x&&(null!=(o=c.toolUsageResultById)[H]||(o[H]={}),c.toolUsageResultById={...c.toolUsageResultById,[H]:{...c.toolUsageResultById[H],xSearchResults:x}},c.xposts=[...c.xposts||[],...x.results||[]]))):"header"===N&&y&&c.traceSteps.push({type:"header",text:y}),y)if(N&&"UNSET"!==N.toUpperCase()){if(c.searchingStartTime||(c.searchingStartTime=new Date(c.createTime).getTime()),"FINAL"===N.toUpperCase())c.searchingStartTime&&!c.searchingEndTime&&(c.searchingEndTime=Date.now()),c.message+=y;else if(null!=B){let e=c.steps[B];if(e)if(e.tags.includes(N)){let t=e.tags.indexOf(N);t>=0&&(e.text[t]+=y)}else e.text.push(y),e.tags.push(N)}}else E?c.thinkingTrace+=y:c.message+=y;if(c.liveThinkingStartTime&&!c.liveThinkingEndTime&&!E&&y&&(c.liveThinkingEndTime=Date.now()),R&&R.suggestions&&(c.suggestions=R.suggestions),D&&(c.followUpSuggestedMode=D,g(D)),P&&(P.followUpSuggestions&&(c.suggestions=P.followUpSuggestions),P.disclaimer&&p(P.disclaimer,c.conversationId)),T){let{imageId:e,imageUrl:t}=T;if(e&&t){let s=null!=(r=c.streamingImageById)?r:{};T.progress&&(c.streamingImageById={...s,[e]:{...null!=(a=s[e])?a:{},[T.progress]:T}}),f.setOneImageIdByUrl(e,t)}}return V&&V.message&&p(V.message,c.conversationId),A&&A.message&&p(A.message,c.conversationId),L&&(c.progressReport=L),O&&(c.uiLayout={...null!=(l=c.uiLayout)?l:{},...O},null==v||v(c.uiLayout)),F&&(c.authNotification={...null!=(d=c.authNotification)?d:{},...F}),S&&(c={...c,...S,state:c.authNotification?"streaming":"closed"}),c},this.processSideBySide=e=>{let{responseChunk:t,toggledExperiment:s,conversationId:n,parentResponseId:o,userResponseId:i,modelName:r}=e,{sideBySideIndex:a,responseId:l}=t;if(null!=a&&!s){let e="streaming_in_progress_".concat(a,"_").concat(S()());return A({conversationId:n,responseId:l||e,parentResponseId:i||o,sender:r})}},this.processSoftStop=e=>{let{currentStreamResponse:t,responseChunk:s,startTimeMs:n}=e;return t.liveThinkingStartTime&&!t.liveThinkingEndTime&&(t.liveThinkingEndTime=Date.now()),t.generationTimeMs=Date.now()-n,t.state="closed",s.responseId&&(t.responseId=s.responseId),t.partial=!1,t},this.streamResponse=e=>{var t,s,u;let m,{message:p,metadata:g={},parentResponseId:y,parentQuotedText:w,conversationId:b,modelName:x,fileAttachmentIds:R,webpageUrls:M,toolOverrides:T,customInstructions:E,customPersonality:N,deepsearchPreset:L,systemPromptName:U,isReasoning:D,imageEditUri:O,followUpType:F,enableRetries:H,disableArtifactDiff:q,onOptimisticUserResponse:G,onOptimisticModelResponse:Z,onStart:Q,onUserResponse:W,onStartExperiment:K,onCitations:$,onDisclaimer:J,onHasImage:Y,onClose:X,onWke:ee,onError:et,isFromGrokFiles:es,resumeResponseId:en,disableToolComposer:eo=!1,disableMemory:ei=!1,modelSliderMode:er,ff:ea}=e,el=k.w.getState(),ed=this.get(),ec=(0,i.f)(),eu=new AbortController;el.idsertAbortControllerById(eu,b);let eh=_.x.getState().bestSubscription,em=[];x=(0,o.S_)(ea.MODEL_MODE_MODELS.value)[x]?n.DD[null!=er?er:"expert"]:x;let ep=!p;if(ep||(m=V({conversationId:b,responseId:"optimistic_query_".concat(S()()),parentResponseId:y,message:p,parentQuotedText:w,fileAttachments:R,webpageUrls:M,state:"optimistic"}),ed.upsertResponse(m),G(m)),!ep&&(0,C.isEmpty)(y)){let e=null==(t=ed.byConversationId[b])?void 0:t.length,s=(0,l.Po)(ed.byConversationId[b]);(0,d.iu)("root_pivot",s.toString(),{location:"response-store",conversationId:b,totalResponses:String(e),longestBranchLength:String(s)})}let eg="streaming_in_progress_".concat(S()()),ev="",ef="";if(en&&ed.byId[en]){let e=ed.byId[en];ev=e.message,ef=e.thinkingTrace}let eI=A({conversationId:b,responseId:eg,parentResponseId:ep?y:null==m?void 0:m.responseId,sender:x,state:"optimistic",message:ev,thinkingTrace:ef},L,D);em.push(eI),ed.upsertResponse(eI),Z(eI);let{modelConfigOverrideByModel:ey,isToolComposer2:eS,sideBySideMode:eC}=f.C$.getState(),ew=null!=(s=ey[x||"undefined"])?s:{};if((0,f.Qy)(ew)){let e={...ew};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,g.modelConfigOverride=e}!eo&&(null!=eS?eS:ea.DEFAULT_USE_TOOL_COMPOSER2)&&(g.isMozart=!0);let eb=(u={parentResponseId:y,parentQuotedText:w,message:p,metadata:{...g,requestModelDetails:(0,r.I2)(x,ea)},modelName:x,fileAttachments:R,webpageUrls:M,toolOverrides:T,enableSideBySide:"never"!==eC&&!ec,forceSideBySide:"always"===eC,systemPromptName:U,customInstructions:E,customPersonality:N,deepsearchPreset:L,disableArtifactDiff:q,isReasoning:D,imageEditUri:O,followUpType:F,isFromGrokFiles:es,resumeResponseId:en,disableMemory:ei},{message:"",modelName:"",parentResponseId:"",parentQuotedText:void 0,systemPromptName:void 0,disableSearch:!1,imageAttachments:[],returnImageBytes:!1,returnRawGrokInXaiRequest:!1,fileAttachments:[],enableImageGeneration:!0,forceConcise:!1,enableImageStreaming:!0,enableSideBySide:!0,sendFinalMetadata:!0,imageGenerationCount:B,deepsearchPreset:"",isReasoning:!1,disableTextFollowUps:!0,followUpType:"",disableMemory:!1,...u}),ex=!1,ek=!1,e_=!1,eR=Date.now(),[eM,eT]=j(),{log:eP,stop:eE,resetTime:eN}=(0,d.Pp)("streamResponse",{type:"milliseconds_per_token",subscriptionTier:eh||"unknown",modelId:x,modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L}),millisecondsPerTokenList:[]}),eB=(0,d.wl)("streamResponse",{type:"time_to_first_token",modelId:x,subscriptionTier:eh||"unknown",modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L}),timeToFirstTokenMs:0},e=>{(0,d.iu)("response_start_streaming",e.toString(),{location:"response-store:streamResponse",conversationId:b,responseId:eg,modelId:x,ttftMs:e.toString(),modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L})}),em.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eV=(0,d.hl)("streamResponse",{type:"time_to_first_chunk",modelId:x,subscriptionTier:eh||"unknown",modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L}),timeToFirstChunkMs:0},e=>{em.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return h.chatApi.chatAddResponseRaw({conversationId:b,body:eb}).then(async e=>{for await(let r of(m&&(m.state="streaming",eT(m)),(em=em.map(e=>({...e,state:"streaming"}))).forEach(eT),Q(em),(0,d.N8)("streamResponse",{type:"send_query_stream_start",subscriptionTier:eh||"unknown",modelId:x,modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L})}),eN(),v(e.raw))){var t,s,n,o,i;if(eV(),eP(),r.error){let e=Error(r.error.message);throw ee(e),e}if(!r.result)continue;let e=r.result,{userResponse:a,sideBySideIndex:l,isSoftStop:c,modelResponse:u,authNotification:h}=e;if(null==a?void 0:a.error)throw m&&(m.state="error",m.error=a.error,eT(m)),(0,d.vV)("response-store:streamResponse:userResponseChunk",a.error),Error(a.error);if(null==u?void 0:u.error)throw(em=em.map(e=>({...e,state:"error",error:u.error}))).forEach(eT),(0,d.vV)("response-store:streamResponse:modelResponseChunk",u.error),Error(u.error);let p=this.processSideBySide({responseChunk:e,toggledExperiment:ex,conversationId:b,parentResponseId:y,userResponseId:null==m?void 0:m.responseId,modelName:x});if(p&&(ex=!0,p.uiLayout=null==(t=em[0])?void 0:t.uiLayout,em.push(p),eT(p),K(em.map(e=>e.responseId))),a){eM(m={...a,conversationId:b,state:"closed",parentQuotedText:w}),W(m),ek=!0,(em=em.map(e=>({...e,parentResponseId:null==m?void 0:m.responseId}))).forEach(eT);continue}let g=null!=l?l:0,v=em[g];if(!v)return;v=this.processResponseChunk({currentStreamResponse:v,responseChunk:e,onCitations:()=>$(v),onHasImage:Y,onDisclaimer:J,onFollowUpSuggestedMode:e=>{var t;(0,d.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:v.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{em=em.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&eB(),eM(v),em[g]=v,c&&(v=this.processSoftStop({currentStreamResponse:v,responseChunk:e,startTimeMs:eR}),(0,d.iu)("generation_time_ms",null==(s=v.generationTimeMs)?void 0:s.toString(),{location:"response-store",conversationId:b,responseId:v.responseId}),eT(v),em.every(e=>"closed"===e.state)&&((0,d.iu)("finished_query",null==(n=em[0])?void 0:n.responseId,{location:"response-store",conversationId:b,toggledExperiment:ex.toString(),secondResponse:(null==(o=em[1])?void 0:o.responseId)||"",isReasoning:D?D.toString():"",deepsearchPreset:L||""}),em.forEach(eT),X(em,em.map(e=>e.responseId)),e_=!0)),h&&((0,d.iu)("auth_notification_received",null==(i=em[0])?void 0:i.responseId,{location:"response-store",conversationId:b}),e_=!0)}if(ek||ep||(this.ensureUserResponseSaved({conversationId:b,message:p,userResponse:m,onUserResponse:W,forceUpsertResponse:eT}).then(z(em)).then(e=>em=e).catch((0,d.HX)("response-store:useResponseStore:streamResponse")),ek=!0),!e_){let e=Error(I.CZ);(0,d.vV)("response-store:useResponseStore:streamResponse:closedStream",e,{conversationId:b,modelName:x,modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L})})}(0,d.N8)("streamResponse",{type:"send_query_stream_success",subscriptionTier:eh||"unknown",modelId:x,modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L})})}).catch(e=>{(0,c.GQ)(e)&&((0,d.vV)("response-store:useResponseStore:streamResponse",e,{conversationId:b,modelName:x,isReasoning:D?D.toString():"",deepsearchPreset:L||""}),(0,d.N8)("streamResponse",{type:"send_query_stream_error",subscriptionTier:eh||"unknown",modelId:x,modelMode:(0,a.yv)({isReasoning:D,deepsearchPreset:L})}));let t=et(e);if(H&&t)P(x,b,em,D,L,Q,$,J,Y,X,ee).catch(e=>{throw(0,d.vV)("response-store:useResponseStore:streamResponse:handleStreamError",e),e});else throw(em=em.map(e=>({...e,state:"error",compoutedThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(eT),e}).finally(()=>{eE()})},this.reconnectToResponse=e=>{let{inflightResponse:t,conversationId:s,modelName:i,parentResponseId:r,enableRetries:l,isReasoning:c,deepsearchPreset:u,modelSliderMode:m,onStart:p,onCitations:g,onDisclaimer:f,onHasImage:y,onClose:C,onWke:w,onError:b,ff:x}=e,R=this.get(),M=k.w.getState(),T=new AbortController,E=_.x.getState().bestSubscription;i=(0,o.S_)(x.MODEL_MODE_MODELS.value)[i]?n.DD[null!=m?m:"expert"]:i;let N=!1;if(!t.responseId)throw Error("Inflight response missing responseId");let B=[],V={type:"milliseconds_per_token",subscriptionTier:E||"unknown",modelId:i,modelMode:(0,a.yv)({isReasoning:c,deepsearchPreset:u}),millisecondsPerTokenList:[]},{log:L,stop:z,resetTime:U}=(0,d.Pp)("reconnectToResponse",V);return h.chatApi.chatReconnectResponseV2Raw({responseId:t.responseId}).then(async e=>{var n,o,h,m,S,b,x,k,_,P,V,z,D,O,F,H,q,G,Z,Q,W,K;(0,d.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_start",subscriptionTier:E||"unknown",modelId:i,modelMode:(0,a.yv)({isReasoning:c,deepsearchPreset:u})}),U();let $=v(e.raw);L();let J=await $.next();if(!(null==(n=J.value)?void 0:n.result)||!(null==(m=J.value)||null==(h=m.result)||null==(o=h.response)?void 0:o.modelResponse))throw Error("No initial state received from reconnect");let{title:Y,response:X}=J.value.result;if(Y){let e=M.byId[s];M.upsertAndCacheConversation({...e,title:Y.newTitle})}let ee=A({...X.modelResponse,responseId:t.responseId,inflightResponseId:t.responseId,conversationId:s,parentResponseId:r,sender:i,state:"streaming",...t.createTime&&{createTime:t.createTime}});if(((null==(S=X.queryAction)?void 0:S.type)==="aurora"||(null==(b=X.queryAction)?void 0:b.type)==="flux")&&(ee.hasImages=!0,y()),(null==(x=X.queryAction)?void 0:x.type)==="x"&&(ee.hasSearches=!0),(null==(k=X.followUpSuggestions)?void 0:k.suggestions)&&(ee.suggestions=X.followUpSuggestions.suggestions),X.followUpSuggestedMode&&(ee.followUpSuggestedMode=X.followUpSuggestedMode),X.finalMetadata&&(X.finalMetadata.followUpSuggestions&&(ee.suggestions=X.finalMetadata.followUpSuggestions),X.finalMetadata.disclaimer&&f(X.finalMetadata.disclaimer,ee.conversationId)),X.cachedImageGenerationResponse&&X.cachedImageGenerationResponse.imageUrl&&(ee.generatedImageUrls=ee.generatedImageUrls.concat([X.cachedImageGenerationResponse.imageUrl])),X.cardAttachment&&X.cardAttachment.jsonData&&(ee.cardAttachmentsJson=ee.cardAttachmentsJson.concat([X.cardAttachment.jsonData])),(null==(P=X.modelResponse)||null==(_=P.steps)?void 0:_.length)&&(ee.searchingStartTime=new Date(ee.createTime).getTime(),(null==(H=X.modelResponse)?void 0:H.message)&&(ee.searchingEndTime=Date.now())),(null==(V=X.modelResponse)?void 0:V.thinkingTrace)&&(ee.liveThinkingStartTime=new Date(ee.createTime).getTime(),X.isThinking||ee.liveThinkingEndTime||(ee.liveThinkingEndTime=Date.now())),X.bannerMessage&&X.bannerMessage.message&&f(X.bannerMessage.message,ee.conversationId),X.disclaimer&&X.disclaimer.message&&f(X.disclaimer.message,ee.conversationId),(null==(z=X.modelResponse)?void 0:z.uiLayout)&&(ee.uiLayout=null==(q=X.modelResponse)?void 0:q.uiLayout),B=[ee],M.idsertAbortControllerById(T,s),R.upsertResponse(ee),p(B),X.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=X.streamingImageGenerationResponse;if(e&&t){let s=null!=(G=ee.streamingImageById)?G:{};X.streamingImageGenerationResponse.progress&&(ee.streamingImageById={...s,[e]:{...null!=(Z=s[e])?Z:{},[X.streamingImageGenerationResponse.progress]:X.streamingImageGenerationResponse}}),R.setOneImageIdByUrl(e,t)}}((null==(D=ee.webSearchResults)?void 0:D.length)||(null==(O=ee.citedWebSearchResults)?void 0:O.length)||(null==(F=ee.xposts)?void 0:F.length))&&g(ee);let[et,es]=j(),en=new Date(ee.createTime).getTime();try{for await(let e of $){if(L(),e.error){let t=Error(e.error.message);throw w(t),t}if(!e.result)continue;let{title:t,response:n}=e.result;if(null==t?void 0:t.newTitle){let e=M.byId[s];M.upsertAndCacheConversation({...e,title:t.newTitle})}if(n){if(null==(Q=n.modelResponse)?void 0:Q.error)throw(0,d.vV)("response-store:reconnectToResponse:modelResponse",n.modelResponse.error),Error(n.modelResponse.error);ee={...this.processResponseChunk({currentStreamResponse:ee,responseChunk:n,onCitations:()=>g(ee),onHasImage:y,onDisclaimer:f,onFollowUpSuggestedMode:e=>{var t;(0,d.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:ee.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:r},et(ee),B[0]=ee,n.isSoftStop&&(ee=this.processSoftStop({currentStreamResponse:ee,responseChunk:n,startTimeMs:en}),(0,d.iu)("generation_time_ms",null==(W=ee.generationTimeMs)?void 0:W.toString(),{location:"response-store",conversationId:s,responseId:ee.responseId}),es(ee),B.every(e=>"closed"===e.state)&&((0,d.iu)("finished_query",null==(K=B[0])?void 0:K.responseId,{location:"response-store",conversationId:s,isReasoning:c?c.toString():"",deepsearchPreset:u||""}),B.forEach(es),C(B,B.map(e=>e.responseId)),N=!0)),n.authNotification&&(N=!0)}}if(!N){let e=Error(I.CZ);(0,d.vV)("response-store:useResponseStore:reconnectToResponse:closedStream",e)}(0,d.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_success",subscriptionTier:E||"unknown",modelId:i,modelMode:(0,a.yv)({isReasoning:c,deepsearchPreset:u})})}catch(e){throw l||(ee={...ee,state:"error",liveThinkingEndTime:ee.liveThinkingStartTime&&!ee.liveThinkingEndTime?Date.now():ee.liveThinkingEndTime,searchingEndTime:ee.searchingStartTime&&!ee.searchingEndTime?Date.now():ee.searchingEndTime},B[0]=ee,es(ee)),e}}).catch(e=>{(0,d.vV)("response-store:reconnectToResponse",e),(0,d.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_error",subscriptionTier:E||"unknown",modelId:i,modelMode:(0,a.yv)({isReasoning:c,deepsearchPreset:u})});let t=b(e);if(l&&t)P(i,s,B,c,u,p,g,f,y,C,w).catch(e=>{throw(0,d.vV)("response-store:reconnectToResponse:handleStreamError",e),e});else{if(0===B.length){let e=A({conversationId:s,responseId:"streaming_in_progress_".concat(S()()),parentResponseId:r,sender:i,state:"error"});B=[e],R.upsertResponse(e)}throw e}}).finally(()=>{M.removeAbortControllerById(s),z()})},this.streamCreateAndRespond=async e=>{var t,s;let{temporary:l,message:u,modelName:m,fileAttachmentIds:p,webpageUrls:g,systemPromptName:y,personaId:C,toolOverrides:w,isPreset:b,customInstructions:x,customPersonality:R,deepsearchPreset:M,isReasoning:T,imageEditUri:E,enableRetries:N,disableArtifactDiff:L,onOptimisticConversation:U,onOptimisticResponse:D,onStart:O,onConversation:F,onUserResponse:H,onStartExperiment:q,onCitations:G,onDisclaimer:Z,onHasImage:Q,onClose:W,onWke:K,onError:$,workspaceIds:J,responseMetadata:Y={},isFromGrokFiles:X,disableToolComposer:ee=!1,disableMemory:et=!1,modelSliderMode:es,ff:en}=e,eo=this.get(),ei=k.w.getState(),er=(0,i.f)(),ea=_.x.getState().bestSubscription,el="optimistic_conversation_".concat(S()()),ed=(0,k.b)({conversationId:el,personaId:C,temporary:l});ei.upsertAndCacheConversation(ed),U(ed);let ec="optimistic_response_".concat(S()()),eu=V({conversationId:ed.conversationId,responseId:ec,message:u,fileAttachments:p,webpageUrls:g});eo.upsertResponse(eu),D(eu),m=(0,o.S_)(en.MODEL_MODE_MODELS.value)[m]?n.DD[null!=es?es:"expert"]:m;let eh="streaming_in_progress_".concat(S()()),em=A({conversationId:ed.conversationId,responseId:eh,parentResponseId:eu.responseId,sender:m},M,T),ep=[em];eo.upsertResponse(em);let{modelConfigOverrideByModel:eg,isToolComposer2:ev,sideBySideMode:ef}=f.C$.getState(),eI=null!=(t=eg[m||"undefined"])?t:{};if((0,f.Qy)(eI)){let e={...eI};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,Y.modelConfigOverride=e}!ee&&(null!=ev?ev:en.DEFAULT_USE_TOOL_COMPOSER2)&&(Y.isMozart=!0);let ey=(s={temporary:l,message:u,modelName:m,fileAttachments:p,webpageUrls:g,systemPromptName:null!=y?y:C,toolOverrides:w,enableSideBySide:"never"!==ef&&!er,forceSideBySide:"always"===ef,customInstructions:x,customPersonality:R,deepsearchPreset:M,isReasoning:T,disableArtifactDiff:L,imageEditUri:E,workspaceIds:J,isFromGrokFiles:X,responseMetadata:{...Y,requestModelDetails:(0,r.I2)(m,en)},disableMemory:et},{systemPromptName:"",temporary:!1,message:"",modelName:"",fileAttachments:[],imageAttachments:[],disableSearch:!1,enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:B,forceConcise:!1,enableSideBySide:!0,sendFinalMetadata:!0,disableTextFollowUps:!0,...s}),eS=new AbortController;ei.idsertAbortControllerById(eS,el);let eC=!1,ew=!1,eb=!1,ex=Date.now(),[ek,e_]=j(),{log:eR,stop:eM,resetTime:eT}=(0,d.Pp)("streamCreateAndRespond",{type:"milliseconds_per_token",subscriptionTier:ea||"unknown",modelId:m,modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M}),millisecondsPerTokenList:[]}),eP=(0,d.wl)("streamCreateAndRespond",{type:"time_to_first_token",modelId:m,subscriptionTier:ea||"unknown",modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M}),timeToFirstTokenMs:0},e=>{(0,d.iu)("response_start_streaming",e.toString(),{location:"response-store:streamResponse",conversationId:ed.conversationId,responseId:eh,modelId:m,ttftMs:e.toString(),modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M})}),ep.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eE=(0,d.hl)("streamCreateAndRespond",{type:"time_to_first_chunk",modelId:m,subscriptionTier:ea||"unknown",modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M}),timeToFirstChunkMs:0},e=>{ep.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return h.chatApi.chatCreateConversationAndRespondRaw({body:ey}).then(async e=>{for await(let i of(eu={...eu,state:"streaming"},ep=ep.map(e=>({...e,state:"streaming"})),e_(eu),ep.forEach(e_),O(ep),(0,d.N8)("streamCreateAndRespond",{type:"send_query_stream_start",subscriptionTier:ea||"unknown",modelId:m,modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M})}),eT(),v(e.raw))){if(eE(),eR(),i.error){let e=Error(i.error.message);throw K(e),e}if(!i.result)continue;let{response:e,conversation:r,title:a}=i.result;if(r){let e=ed.conversationId;ed={...ed,isNew:!0,fromPreset:b,state:"closed",systemPromptName:"",...r},ei.upsertAndCacheConversation(ed,e),ei.idsertAbortControllerById(eS,ed.conversationId),eu={...eu,conversationId:ed.conversationId},ep=ep.map(e=>({...e,parentResponseId:eu.responseId,conversationId:ed.conversationId})),ek(eu),ep.forEach(e_),F(ed);continue}if((null==a?void 0:a.newTitle)&&(ed={...ed,title:a.newTitle},ei.upsertAndCacheConversation(ed)),e){var t,s,n,o;let{userResponse:i,sideBySideIndex:r,isSoftStop:a,modelResponse:l,authNotification:c}=e;if(null==i?void 0:i.error)throw e_(eu={...eu,...i,state:"error"}),(0,d.vV)("response-store:useResponseStore:streamResponse:userResponseChunk",i.error),Error(i.error);if(null==l?void 0:l.error)throw(ep=ep.map(e=>({...e,...l,state:"error"}))).forEach(e_),(0,d.vV)("response-store:useResponseStore:streamResponse:modelResponseChunk",l.error),Error(l.error);let u=this.processSideBySide({responseChunk:e,toggledExperiment:eC,conversationId:ed.conversationId,parentResponseId:eu.responseId,modelName:m});if(u&&(eC=!0,u.uiLayout=null==(t=ep[0])?void 0:t.uiLayout,ep.push(u),e_(u),q(ep.map(e=>e.responseId))),i){ek(eu={...eu,...i,conversationId:ed.conversationId,state:"closed"}),H(eu),ew=!0,(ep=ep.map(e=>({...e,parentResponseId:null==eu?void 0:eu.responseId}))).forEach(e_);continue}let h=null!=r?r:0,p=ep[h];if(!p)continue;p=this.processResponseChunk({currentStreamResponse:p,responseChunk:e,onCitations:()=>G(p),onHasImage:Q,onDisclaimer:Z,onFollowUpSuggestedMode:e=>{var t;(0,d.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:p.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{ep=ep.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&eP(),ek(p),ep[h]=p,a&&(p=this.processSoftStop({currentStreamResponse:p,responseChunk:e,startTimeMs:ex}),(0,d.iu)("generation_time_ms",null==(s=p.generationTimeMs)?void 0:s.toString(),{location:"response-store",conversationId:ed.conversationId,responseId:p.responseId}),e_(p),ep.every(e=>"closed"===e.state)&&((0,d.iu)("finished_query",null==(n=ep[0])?void 0:n.responseId,{location:"response-store",conversationId:ed.conversationId,toggledExperiment:eC.toString(),secondResponse:(null==(o=ep[1])?void 0:o.responseId)||"",isReasoning:T?T.toString():"",deepsearchPreset:M||""}),ep.forEach(e_),W(ep),eb=!0)),c&&(eb=!0)}}if(ew||(this.ensureUserResponseSaved({conversationId:ed.conversationId,message:u,userResponse:eu,onUserResponse:H,forceUpsertResponse:e_}).then(z(ep)).then(e=>ep=e).catch((0,d.HX)("response-store:useResponseStore:streamCreateAndRespond")),ew=!0),!eb){let e=Error(I.CZ);(0,d.vV)("response-store:useResponseStore:streamCreateAndRespond:closedStream",e,{conversationId:ed.conversationId,modelName:m,modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M})})}(0,d.N8)("streamCreateAndRespond",{type:"send_query_stream_success",subscriptionTier:ea||"unknown",modelId:m,modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M})})}).catch(e=>{(0,c.GQ)(e)&&((0,d.vV)("response-store:useResponseStore:streamCreateAndRespond",e,{conversationId:ed.conversationId,modelName:m,isReasoning:T?T.toString():"",deepsearchPreset:M||""}),(0,d.N8)("streamCreateAndRespond",{type:"send_query_stream_error",subscriptionTier:ea||"unknown",modelId:m,modelMode:(0,a.yv)({isReasoning:T,deepsearchPreset:M})}));let t=$(e);if(N&&t)P(m,ed.conversationId,ep,T,M,O,G,Z,Q,W,K).catch(e=>{throw(0,d.vV)("response-store:useResponseStore:streamCreateAndRespond:handleStreamError",e),e});else throw(ep=ep.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(e_),W(ep),e}).finally(()=>{eM()})},this.ensureUserResponseSaved=e=>{let{conversationId:t,message:s,userResponse:n,onUserResponse:o,forceUpsertResponse:i}=e;return this.get().addUserResponse(t,s).then(e=>(i(e),o(e),e)).catch(()=>{if(!n)return;let e={...n,state:"error"};return i(e),e})},this.abortStream=async(e,t)=>{let s=this.get(),n=k.w.getState(),o=s.byId[t];if(!o.state||!["streaming","error","reconnecting"].includes(o.state))return Promise.resolve(t);let i=n.abortControllerById[e];return i&&(i.abort(),n.removeAbortControllerById(e)),h.chatApi.chatStopConversationInflightResponses({conversationId:e}).then(()=>{let t={...o,responseId:o.inflightResponseId,conversationId:e,state:"closed",partial:!0,liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};return s.upsertResponse(t),t.responseId}).catch(e=>{let t={...o,state:"error",liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};throw s.upsertResponse(t),e})},this.addUserResponse=(e,t,s)=>h.chatApi.chatAddUserResponse({conversationId:e,body:{message:t,parentResponseId:s}}).then(t=>{let s=this.get(),n={...t,conversationId:e};return s.upsertResponse(n),n}),this.addToolResponse=(e,t)=>h.chatApi.chatAddToolResponse({body:{responseId:e,toolResponse:t}}).then(()=>{let s=this.get(),n=s.byId[e];if(n){let e={...n,toolResponses:[...n.toolResponses||[],t]};return s.upsertResponse(e),e}throw Error("Response not found in state")}),this.createVoiceUserMessage=e=>{let{userResponseId:t,conversationId:s,parentResponseId:n,message:o,onUserResponse:i,onOptimisticModelResponse:r}=e,a=this.get(),l=V({responseId:t,parentResponseId:n,message:o,conversationId:s,state:"closed",partial:!1});a.upsertResponse(l),i(l);let d=A({conversationId:s,responseId:"streaming_in_progress_".concat(S()()),parentResponseId:l.responseId,sender:"ASSISTANT",state:"streaming"});a.upsertResponse(d),r(d)}}}async function P(e,t,s,n,o,i,r,l,u,m,p){let g=E.getState(),f=k.w.getState(),I=_.x.getState().bestSubscription,y=s.map(e=>({...e,state:"reconnecting"}));y.forEach(g.upsertResponse);let S=e=>new Promise(t=>setTimeout(t,e));if(t.startsWith("optimistic_conversation_"))return void(y=y.map(e=>({...e,state:"error"}))).forEach(g.upsertResponse);let C={type:"milliseconds_per_token",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o}),millisecondsPerTokenList:[]},{log:w,stop:b,resetTime:x}=(0,d.Pp)("handleStreamError",C);(0,d.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_start",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})});for(let s=1;s<=10;s++){try{let s=await g.fetchListInflightResponses(t,!0);if(s.length>0&&s[0].responseId&&y[0].parentResponseId){await h.chatApi.chatReconnectResponseV2Raw({responseId:s[0].responseId}).then(async c=>{var h,S,C,b,k,_,R,M,T,P,E,N,B,V,L,z,U,D,O,F;(0,d.N8)("handleStreamError",{type:"send_query_stream_reconnect_start",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})}),x();let H=v(c.raw);w();let q=await H.next();if(!(null==(h=q.value)?void 0:h.result)||!(null==(b=q.value)||null==(C=b.result)||null==(S=C.response)?void 0:S.modelResponse))throw Error("No initial state received from reconnect");let{title:G,response:Z}=q.value.result;if(G){let e=f.byId[t];f.upsertAndCacheConversation({...e,title:G.newTitle})}let Q=A({...Z.modelResponse,conversationId:t,responseId:y[0].responseId,parentResponseId:y[0].parentResponseId,sender:y[0].sender,state:"streaming",...s[0].createTime&&{createTime:s[0].createTime}});if(((null==(k=Z.queryAction)?void 0:k.type)==="aurora"||(null==(_=Z.queryAction)?void 0:_.type)==="flux")&&(Q.hasImages=!0,u()),(null==(R=Z.queryAction)?void 0:R.type)==="x"&&(Q.hasSearches=!0),(null==(M=Z.followUpSuggestions)?void 0:M.suggestions)&&(Q.suggestions=Z.followUpSuggestions.suggestions),Z.followUpSuggestedMode&&(Q.followUpSuggestedMode=Z.followUpSuggestedMode),Z.finalMetadata&&(Z.finalMetadata.followUpSuggestions&&(Q.suggestions=Z.finalMetadata.followUpSuggestions),Z.finalMetadata.disclaimer&&l(Z.finalMetadata.disclaimer,Q.conversationId)),Z.cachedImageGenerationResponse&&Z.cachedImageGenerationResponse.imageUrl&&(Q.generatedImageUrls=Q.generatedImageUrls.concat([Z.cachedImageGenerationResponse.imageUrl])),Z.cardAttachment&&Z.cardAttachment.jsonData&&(Q.cardAttachmentsJson=Q.cardAttachmentsJson.concat([Z.cardAttachment.jsonData])),(null==(P=Z.modelResponse)||null==(T=P.steps)?void 0:T.length)&&(Q.searchingStartTime=new Date(Q.createTime).getTime(),(null==(L=Z.modelResponse)?void 0:L.message)&&(Q.searchingEndTime=Date.now())),Z.bannerMessage&&Z.bannerMessage.message&&l(Z.bannerMessage.message,Q.conversationId),Z.disclaimer&&Z.disclaimer.message&&l(Z.disclaimer.message,Q.conversationId),(null==(E=Z.modelResponse)?void 0:E.thinkingTrace)&&(Q.liveThinkingStartTime=new Date(Q.createTime).getTime(),Z.isThinking||Q.liveThinkingEndTime||(Q.liveThinkingEndTime=Date.now())),y=[Q],g.upsertResponse(Q),i(y),Z.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=Z.streamingImageGenerationResponse;if(e&&t){let s=null!=(z=Q.streamingImageById)?z:{};Z.streamingImageGenerationResponse.progress&&(Q.streamingImageById={...s,[e]:{...null!=(U=s[e])?U:{},[Z.streamingImageGenerationResponse.progress]:Z.streamingImageGenerationResponse}}),g.setOneImageIdByUrl(e,t)}}((null==(N=Q.webSearchResults)?void 0:N.length)||(null==(B=Q.citedWebSearchResults)?void 0:B.length)||(null==(V=Q.xposts)?void 0:V.length))&&r(Q);let[W,K]=j(),$=new Date(Q.createTime).getTime();for await(let e of H){if(w(),e.error){let t=Error(e.error.message);throw p(t),t}if(!e.result)continue;let{title:s,response:i}=e.result;if(null==s?void 0:s.newTitle){let e=f.byId[t];f.upsertAndCacheConversation({...e,title:s.newTitle})}if(i){if(null==(D=i.modelResponse)?void 0:D.error)throw(0,d.vV)("response-store:handleStreamError:modelResponse",i.modelResponse.error),Error(i.modelResponse.error);Q={...g.processResponseChunk({currentStreamResponse:Q,responseChunk:i,onCitations:()=>r(Q),onHasImage:u,onDisclaimer:l,onFollowUpSuggestedMode:e=>{var t;(0,d.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:Q.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:y[0].parentResponseId},W(Q),y[0]=Q,i.isSoftStop&&(Q=g.processSoftStop({currentStreamResponse:Q,responseChunk:i,startTimeMs:$}),(0,d.iu)("generation_time_ms",null==(O=Q.generationTimeMs)?void 0:O.toString(),{location:"response-store",conversationId:t,responseId:Q.responseId}),K(Q),y.every(e=>"closed"===e.state)&&((0,d.iu)("finished_query",null==(F=y[0])?void 0:F.responseId,{location:"response-store",conversationId:t,isReasoning:n?n.toString():"",deepsearchPreset:o||""}),y.forEach(K),m(y,y.map(e=>e.responseId))))}}("streaming"===Q.state||"reconnecting"===Q.state)&&(Q={...Q,state:"closed",liveThinkingEndTime:Q.liveThinkingStartTime&&!Q.liveThinkingEndTime?Date.now():Q.liveThinkingEndTime,searchingEndTime:Q.searchingStartTime&&!Q.searchingEndTime?Date.now():Q.searchingEndTime},y[0]=Q,K(Q)),m(y,y.map(e=>e.responseId)),(0,d.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_success",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})}),(0,d.N8)("handleStreamError",{type:"send_query_stream_reconnect_success",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})})});break}(y=y.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(g.upsertResponse),(0,d.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})});break}catch(t){if(b(),(0,d.vV)("response-store:handleStreamError:retryError",t),(0,c.GQ)(t)&&((0,d.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_error",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})}),(0,d.N8)("handleStreamError",{type:"send_query_stream_reconnect_error",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})})),10===s)throw(0,d.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,a.yv)({isReasoning:n,deepsearchPreset:o})}),(y=y.map(e=>({...e,state:"error"}))).forEach(g.upsertResponse),t;await S(2e3),(y=y.map(e=>({...e,state:"reconnecting"}))).forEach(g.upsertResponse)}b()}}let E=(0,u.y$)(T,"useResponseStore");function N(e,t){return E(s=>{var n;return e?null==(n=s.byId[e])?void 0:n[t]:void 0})}(0,u.lB)(E,"byId","byConversationId",(e,t)=>{let s=Object.values(e),n=E.getState().byConversationId,o=new Set(w()(s).filter(e=>e!==t[e.responseId]||!!e.state&&"closed"!==e.state).map(e=>e.conversationId).value()),i=s.filter(e=>o.has(e.conversationId)),r=b.A(e=>e.conversationId,i);return{...n,...w().pick(r,[...o.values()])}}),(0,u.lB)(E,"byId","nodesByConversationId",e=>{let t=E.getState().nodesByConversationId,s=!1,n={};for(let o in e){let i=e[o],r=i.conversationId,a=t[r]||[],l=a.find(e=>e.responseId===o);l?"streaming"===i.state&&l.parentResponseId!==i.parentResponseId&&(s=!0,n[r]=[...a,{...l,parentResponseId:i.parentResponseId}]):(s||(s=!0,n={...t}),n[r]?n[r]===a&&(n[r]=[...a]):n[r]=[...a],n[r].push({responseId:o,parentResponseId:i.parentResponseId,sender:i.sender}))}return s?n:t});let B=2;function V(e){return{sender:"human",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"optimistic",parentResponseId:"",parentQuotedText:void 0,steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},uiLayout:{reasoningUiLayout:"UNSPECIFIED"},selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,toolResponses:[],toolUsageResultById:{},traceSteps:[],...e}}function A(e,t,s){let n="default"===t?Date.now():void 0,o=s?Date.now():void 0;return{message:"",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"streaming",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},deepsearchPreset:t,generatedImageHeight:void 0,generatedImageWidth:void 0,...e,liveThinkingStartTime:o,searchingStartTime:n,selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,uiLayout:{reasoningUiLayout:"UNSPECIFIED"},toolResponses:[],toolUsageResultById:{},traceSteps:[]}}function j(){let e,t={};return[s=>{if(!e){E.getState().upsertResponse(s),e=setTimeout(()=>{let s=Object.values(t);t={},s.length&&E.getState().appendResponses(s),e=void 0},30);return}t[s.responseId]=s},s=>{s&&(t[s.responseId]=s),clearTimeout(e);let n=Object.values(t);t={},n.length&&E.getState().appendResponses(n),e=void 0}]}function L(e){var t;return e.liveThinkingStartTime||e.searchingStartTime||e.thinkingStartTime||(null==(t=e.progressReport)?void 0:t.category)==="HEAVY_ROLLOUT"}function z(e){return t=>(t&&e.forEach(e=>{e.parentResponseId=t.responseId}),e)}function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},s=[];for(let n of e){if(n.toolUsageResults)for(let e of n.toolUsageResults)e.toolUsageCardId&&(t[e.toolUsageCardId]=w().merge(t[e.toolUsageCardId],e));n.text&&n.tags&&w()(n.tags).zip(n.text).sortBy(e=>{var t;return null!=(t=D[e[0]||""])?t:3}).forEach(e=>{let[t,n]=e;if(n)switch(t){case"summary":{let e=n.match(/(- .*)|(<xai:tool_usage_card>[\s\S]*<\/xai:tool_usage_card>)/g);null==e||e.forEach(e=>{e.startsWith("-")?s.push({type:"summary",text:e}):s.push({type:"tool",text:e})});break}case"header":s.push({type:"header",text:n})}})}return{toolUsageResultById:t,traceSteps:s}}let D={header:0,summary:1,tool:1}},44347:(e,t,s)=>{s.d(t,{C$:()=>S,DC:()=>p,K2:()=>h,Qy:()=>g});var n=s(65258),o=s(56173),i=s(31352),r=s.n(i),a=s(96892),l=s.n(a),d=s(6132),c=s(4890),u=s(17823);let h={web_search:"web_search",google_web_search:"google_web_search",bing_web_search:"bing_web_search",web_search_with_snippets:"web_search_with_snippets",browse_page_with_js:"browse_page_with_js",browse_page_no_js:"browse_page_no_js",code_execution_training_parity:"code_execution_training_parity",get_x_user_handle:"get_x_user_handle",get_x_user_profile_pic_description:"get_x_user_profile_pic_description",x_post_lookup:"x_post_lookup",x_search:"x_search",x_keyword_search:"x_keyword_search",x_semantic_search:"x_semantic_search",get_top_us_news_from_x_trends:"get_top_us_news_from_x_trends",get_x_user_timeline:"get_x_user_timeline",get_x_bookmarks:"get_x_bookmarks",get_x_liked_posts:"get_x_liked_posts",render_x_posts:"render_x_posts",render_x_users:"render_x_users",render_card:"render_card"},m=d.z.object({model_name:d.z.string().nullish(),system_prompt_name:d.z.string().nullish(),enable_unified_layout:d.z.boolean().nullish(),tools_set:d.z.string().nullish(),system_turn_prompt:d.z.string().nullish(),tool_definition_prompt:d.z.string().nullish()}),p=d.z.object({promptMap:d.z.object({toolUseFc:d.z.string().nullish(),noToolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),modelMap:d.z.object({noToolUse:d.z.string().nullish(),toolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish(),imageGenModel:d.z.string().nullish(),imageEditModel:d.z.string().nullish()}).nullish(),useSingleModelEverything:d.z.boolean().nullish(),tools:d.z.record(d.z.nativeEnum(h),d.z.boolean()).nullish(),useToolOverrides:d.z.boolean().nullish(),sideBySideParams:m.array().nullish(),useSideBySideParams:d.z.boolean().nullish()});function g(e){let t=Object.values(null!=e?e:{});return!!t&&t.some(e=>"object"==typeof e&&e?Object.values(e).length>0:!e)}d.z.object({displayUserMessageMarkdown:d.z.boolean(),showFollowUpSuggestions:d.z.boolean(),autoWrapLongLinesCode:d.z.boolean(),browserNotificationsEnabled:d.z.boolean(),selectedSystemPromptId:d.z.string().optional(),showConversationPreviews:d.z.boolean().optional(),hideArtifacts:d.z.boolean().optional(),autoDetectWebpageAttachments:d.z.boolean(),showActiveTabs:d.z.boolean().optional(),disableTypeahead:d.z.boolean().optional(),disableAutoScroll:d.z.boolean().optional(),showGrok3ModeButtons:d.z.boolean().optional(),enableTiptapEditorForQueryBar:d.z.boolean().optional()});let v={displayUserMessageMarkdown:!1,showFollowUpSuggestions:!0,autoWrapLongLinesCode:!1,browserNotificationsEnabled:!1,selectedSystemPromptId:void 0,showConversationPreviews:!0,hideArtifacts:!1,autoDetectWebpageAttachments:!1,showActiveTabs:!0,disableTypeahead:!1,disableAutoScroll:!1,showGrok3ModeButtons:!1,enableTiptapEditorForQueryBar:!0},f={isIncognito:!1,userSettingsPromise:void 0,userSettings:{excludeFromTraining:!1,allowXPersonalization:!0,preferences:v,enableMemory:!0},selectedLanguage:void 0,showAgeVerification:!1,ageVerificationCallback:void 0,modelConfigOverride:void 0,modelConfigOverrideByModel:{}},I={excludeFromTraining:!0,allowXPersonalization:!1,preferences:v,enableMemory:!1};class y{constructor(e,t){this.set=e,this.get=t,this.isIncognito=f.isIncognito,this.userSettingsPromise=f.userSettingsPromise,this.userSettings=f.userSettings,this.selectedLanguage=f.selectedLanguage,this.showAgeVerification=f.showAgeVerification,this.ageVerificationCallback=f.ageVerificationCallback,this.modelConfigOverride=f.modelConfigOverride,this.modelConfigOverrideByModel=f.modelConfigOverrideByModel,this.isToolComposer2=f.isToolComposer2,this.sideBySideMode=f.sideBySideMode,this.setIsIncognito=(0,n.kp)(this.set,"isIncognito"),this.setUserSettingsPromise=(0,n.kp)(this.set,"userSettingsPromise"),this.setUserSettings=(0,n.kp)(this.set,"userSettings"),this.setSelectedLanguage=(0,n.kp)(this.set,"selectedLanguage"),this.setShowAgeVerification=(0,n.kp)(this.set,"showAgeVerification"),this.setAgeVerificationCallback=(0,n.kp)(this.set,"setAgeVerificationCallback"),this.setModelConfigOverrideByModel=(0,n.kp)(this.set,"modelConfigOverrideByModel"),this.setIsToolComposer2=(0,n.kp)(this.set,"isToolComposer2"),this.setSideBySideMode=(0,n.kp)(this.set,"sideBySideMode"),this.initializeGdprUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();void 0===e.excludeFromTraining||void 0===e.enableMemory?t.fetchSetUserSettings(I).catch(console.error):t.setUserSettings(w(e,t.userSettings))}),this.initializeEnterpriseUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();e.excludeFromTraining?t.setUserSettings(w(e,t.userSettings)):t.fetchSetUserSettings(I).catch(console.error)}),this.fetchGetUserSettings=()=>{let e=this.get();if(e.userSettingsPromise)return e.userSettingsPromise;let t=o.aK.settingsGetUserSettings().then(t=>w(t,e.userSettings));return e.setUserSettingsPromise(t),t.then(e.setUserSettings).catch(console.error),t},this.fetchSetUserSettings=e=>{let t=this.get();t.setUserSettings({...t.userSettings,...e});let s=o.aK.settingsSetUserSettings({body:e}).then(e=>w(e,this.get().userSettings));return t.setUserSettingsPromise(s),s.then(t.setUserSettings).catch(e=>{console.error(e)}),s},this.fetchSetPreference=(e,t)=>{let s=this.get();return s.fetchSetUserSettings({...s.userSettings,preferences:{...s.userSettings.preferences,[e]:t}})}}}let S=(0,c.v)()((0,u.lt)((0,u.eh)((0,u.Zr)((e,t)=>new y(e,t),{name:"settings-store",partialize:e=>({modelConfigOverrideByModel:e.modelConfigOverrideByModel,isToolComposer2:e.isToolComposer2,sideBySideMode:e.sideBySideMode}),version:2})),{name:"useSettingsStore"}));function C(e,t){return d.z.object({displayUserMessageMarkdown:d.z.boolean().catch(e.displayUserMessageMarkdown),showFollowUpSuggestions:d.z.boolean().catch(e.showFollowUpSuggestions),autoWrapLongLinesCode:d.z.boolean().catch(e.autoWrapLongLinesCode),browserNotificationsEnabled:d.z.boolean().catch(e.browserNotificationsEnabled),selectedSystemPromptId:d.z.string().optional().catch(e.selectedSystemPromptId),showConversationPreviews:d.z.boolean().optional().catch(e.showConversationPreviews),hideArtifacts:d.z.boolean().optional().catch(e.hideArtifacts),autoDetectWebpageAttachments:d.z.boolean().catch(e.autoDetectWebpageAttachments),showActiveTabs:d.z.boolean().optional().catch(e.showActiveTabs),disableTypeahead:d.z.boolean().optional().catch(e.disableTypeahead),disableAutoScroll:d.z.boolean().optional().catch(e.disableAutoScroll),showGrok3ModeButtons:d.z.boolean().optional().catch(e.showGrok3ModeButtons),enableTiptapEditorForQueryBar:d.z.boolean().optional().catch(e.enableTiptapEditorForQueryBar)}).catch(e).parse(t)}function w(e,t){let s=l()(e,r());return{...t,...s,preferences:C(t.preferences,e.preferences)}}(0,n.CP)(S,"userSettings","user-settings",f.userSettings,function(e){return e&&"object"==typeof e?{excludeFromTraining:f.userSettings.excludeFromTraining,allowXPersonalization:f.userSettings.allowXPersonalization,preferences:{...C(v,e.userSettings),disableTypeahead:!1,showGrok3ModeButtons:!1},enableMemory:f.userSettings.enableMemory}:f.userSettings})},44845:(e,t,s)=>{s.d(t,{Ku:()=>i,TM:()=>o,ot:()=>a,yv:()=>r});var n=s(6132);let o=n.z.union([n.z.literal("none"),n.z.literal("unknown"),n.z.literal("deepsearch"),n.z.literal("deepersearch"),n.z.literal("think")]);function i(e){return"deepersearch"===e?"deeper":"deepsearch"===e?"default":void 0}function r(e){let{isReasoning:t,deepsearchPreset:s}=e;return t?"think":"deeper"===s?"deepersearch":"default"===s?"deepsearch":s?"unknown":"none"}function a(e){return"deepersearch"===e?"DEEPERSEARCH":"deepsearch"===e?"DEEPSEARCH":"think"===e?"REASONING":"DEFAULT"}},48992:(e,t,s)=>{s.d(t,{Cg:()=>l,Mb:()=>d,Po:()=>u,Wm:()=>function e(t,s){let n=t[s];if(!n)return s;let o=n[n.length-1];return o&&o.responseId?e(t,o.responseId):s},d7:()=>r,m$:()=>a,zp:()=>c});var n=s(38541),o=s.n(n),i=s(17703);function r(e,t,s){let n=o().keyBy(t,"responseId"),i=n[e];if(!i)return[];let r=[i],a=i.parentResponseId;for(;a&&(!s||r.length<s);){let e=n[a];if(!e)break;r.push(e),a=e.parentResponseId}return r}function a(e,t){let s;for(let n of e)if(t.find(e=>e.responseId===n.responseId))s=n;else break;return s}function l(e,t){let s=[],n=e,o=new Set;for(;n;){if(o.has(n.responseId||"")){(0,i.vV)("conversation-utils:getAncestorIds","Cycle detected in response hierarchy: ".concat(n.responseId));break}o.add(n.responseId||""),s.unshift(n.responseId||"");let e=n.parentResponseId;if(!e)break;n=t[e]}return s}function d(e){let t=new Set(e.map(e=>e.parentResponseId)),s=e.filter(e=>!t.has(e.responseId));if(0!==s.length)return o().maxBy(s,e=>e.createTime)}function c(e,t,s){if(!s)return!1;for(let n of r(s,t))if(n.responseId&&!e.some(e=>e.responseId===n.responseId))return!0;return!1}function u(e){if(!e||0===e.length)return 0;let t=new Set(e.map(e=>e.parentResponseId).filter(e=>e&&!(0,n.isEmpty)(e))),s=e.filter(e=>!t.has(e.responseId)),o=0;for(let t of s)o=Math.max(o,r(t.responseId,e).length);return o}},49972:(e,t,s)=>{s.d(t,{b:()=>C,w:()=>S});var n=s(2376),o=s(17703),i=s(65258),r=s(56173),a=s(94980),l=s(3275),d=s(74995),c=s(6230),u=s(23831),h=s(53915),m=s(3814),p=s(54542),g=s(98451),v=s(43893);function f(e){return{...e,personaId:(0,n._c)(e.systemPromptName),isNew:!1,state:"closed"}}let I=a.A(f);class y{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.abortControllerById={},this.listPromiseByQuery={},this.nextPageTokenByQuery={},this.upsertConversation=(0,i.el)(this.set,"byId","conversationId"),this.appendConversations=(0,i.BC)(this.set,"byId","conversationId"),this.removeConversation=(0,i.TF)(this.set,"byId"),this.setById=(0,i.kp)(this.set,"byId"),this.idsertConversationPromise=(0,i.q5)(this.set,"promiseById"),this.removeConversationPromise=(0,i.TF)(this.set,"promiseById"),this.setPromiseById=(0,i.kp)(this.set,"promiseById"),this.idsertAbortControllerById=(0,i.q5)(this.set,"abortControllerById"),this.removeAbortControllerById=(0,i.TF)(this.set,"abortControllerById"),this.setListPromiseByQuery=(0,i.kp)(this.set,"listPromiseByQuery"),this.idsertListPromiseByQuery=(0,i.q5)(this.set,"listPromiseByQuery"),this.idsertNextPageTokenByQuery=(0,i.q5)(this.set,"nextPageTokenByQuery"),this.upsertAndCacheConversation=(e,t)=>{let s=this.get();t&&t in s.byId&&t!==e.conversationId&&(s.removeConversation(t),s.removeConversationPromise(t)),s.upsertConversation(e),s.idsertConversationPromise(Promise.resolve(e),e.conversationId)},this.appendAndCacheConversations=e=>{let t=l.A(d.A("conversationId"),e),s=c.A(e=>Promise.resolve(e),t),{byId:n,promiseById:o}=this.get();this.set({byId:{...n,...t},promiseById:{...o,...s}})},this.fetchCreateConversation=e=>{var t;let s=this.get(),i=v.A3.getState(),a=r.chatApi.chatCreateConversation({body:e}).then(e=>({...e,personaId:(0,n._c)(e.systemPromptName),isNew:!0,state:"closed"})),l=null==(t=e.addResponseRequest)?void 0:t.conversationId;return l&&(s.idsertConversationPromise(a,l),i.nodesByConversationId[l]=[]),a.then(e=>{s.upsertConversation(e),s.idsertConversationPromise(a,e.conversationId),i.nodesByConversationId[e.conversationId]=[]}).catch((0,o.HX)("fetchCreateConversation")),a},this.fetchUpdateConversation=(e,t)=>{let s=this.get(),n=r.chatApi.chatUpdateConversation({conversationId:e,body:t}).then(t=>({...s.byId[t.conversationId]||{conversationId:e,isNew:!1,state:"closed"},...t})).then(u.A(s.upsertConversation)),i={...s.byId[e]||{conversationId:e,isNew:!1,state:"closed"},...t};return s.upsertConversation(i),s.idsertConversationPromise(Promise.resolve(i),e),n.then(()=>s.idsertConversationPromise(n,e)).catch((0,o.HX)("fetchUpdateConversation")),n},this.fetchDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),t.setListPromiseByQuery(c.A(t=>t.then(t=>t.filter(t=>t.conversation.conversationId!==e)),t.listPromiseByQuery)),s},this.fetchSoftDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatSoftDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchGetConversation=e=>{let t=this.get();if(e in t.promiseById)return t.promiseById[e];let s=r.chatApi.chatGetConversation({conversationId:e,includeWorkspaces:!0,includeTaskResult:!0}).then(f);return t.set(h.A(m.A(["promiseById",e]),s)),s.then(t.upsertConversation).catch(console.error),s},this.fetchGetManyConversations=e=>{let t=this.get(),s={},n=[];if(e.forEach(e=>{e in t.promiseById?s[e]=t.promiseById[e]:n.push(e)}),0===n.length)return Promise.all(Object.values(s));let o=n.length>0?r.chatApi.chatGetConversations({conversationIds:n,includeWorkspaces:!0,includeTaskResult:!0}).then(e=>{let{conversations:t}=e;return t||[]}).then(I):Promise.resolve([]);return o.then(e=>{e.forEach(e=>{let s=Promise.resolve(e);t.idsertConversationPromise(s,e.conversationId)}),t.appendConversations(e)}).catch(console.error),Promise.all([...Object.values(s),o.then(e=>e||[])]).then(e=>e.flat())},this.fetchListConversations=(e,t)=>{let s=this.get(),n=JSON.stringify(function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);let s=Object.keys(t).sort(),n={};for(let o of s)n[o]=e(t[o]);return n}(p.A(e=>!!e,e||{})),null,void 0);if(!t&&n in s.listPromiseByQuery)return s.listPromiseByQuery[n];let o=t?s.nextPageTokenByQuery[n]:void 0,i=r.chatApi.chatListConversations({pageSize:"60",pageToken:o,...e}).then(e=>{let{conversations:t,textSearchMatches:o,nextPageToken:i}=e;return(i&&s.idsertNextPageTokenByQuery(i,n),null==o?void 0:o.length)?o.map(e=>{if(e.conversation)return{...e,conversation:f(e.conversation)}}):(null==t?void 0:t.length)?t.map(e=>({conversation:f(e)})):[]}).then(e=>e.filter(e=>!!e)).then(u.A(e=>{s.appendConversations(e.map(e=>e.conversation)),s.setPromiseById(c.A(e=>Promise.resolve(e.conversation),l.A(e=>e.conversation.conversationId,e)))}));if(t){let e=s.listPromiseByQuery[n];if(e)return Promise.all([e,i]).then(g.A);s.idsertListPromiseByQuery(i,n)}else s.idsertListPromiseByQuery(i,n);return i},this.fetchSoftDeleteAllConversations=()=>(this.setById({}),this.setPromiseById({}),r.chatApi.chatSoftDeleteAllConversations())}}let S=(0,i.y$)(y,"useConversationStore");function C(e){let t=new Date().toISOString();return{title:"New conversation",createTime:t,modifyTime:t,starred:!1,temporary:!1,isNew:!0,state:"optimistic",mediaTypes:[],workspaces:[],taskResult:{},...e}}(0,i.lB)(S,"byId","list",Object.values)},56096:(e,t,s)=>{s.d(t,{x:()=>i});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t}}let i=(0,n.y$)(o,"useSubscriptionsStore")},58192:(e,t,s)=>{s.d(t,{E8:()=>r,Sk:()=>n,Wl:()=>i,fG:()=>a,oQ:()=>o});let n="grok-3",o="Grok 3",i="Grok 3",r="grok-3",a="Grok 2"},58711:(e,t,s)=>{s.d(t,{e:()=>r});var n=s(24429),o=s(65258);class i{constructor(e,t){this.set=e,this.get=t,this.isUpselling=!1,this.targetTier=n.i.SuperGrok,this.setIsUpselling=(0,o.kp)(this.set,"isUpselling"),this.setTargetTier=(0,o.kp)(this.set,"targetTier")}}let r=(0,o.y$)(i,"useUpsellStore");function a(e){switch(e.toLowerCase()){case"supergrok":return n.i.SuperGrok;case"supergrokpro":case"supergrok-pro":return n.i.SuperGrokPro;default:return null}}!function(e){let t=window.location.hash,s=new URLSearchParams(window.location.search);"#subscribe"===t&&e.getState().setIsUpselling(!0);let o=s.get("target");if(o){let t=a(o);null!==t&&e.getState().setTargetTier(t)}e.subscribe((e,t)=>{var s;e.isUpselling!==t.isUpselling&&(s=e.isUpselling?"subscribe":void 0,window.history.pushState({},"","".concat(window.location.pathname).concat(window.location.search).concat(s?"#".concat(s):"")))}),window.addEventListener("popstate",()=>{let t=window.location.hash,s=new URLSearchParams(window.location.search);e.getState().setIsUpselling("#subscribe"===t);let o=s.get("target");if(o){let t=a(o);null!==t&&e.getState().setTargetTier(t)}else e.getState().setTargetTier(n.i.SuperGrok)})}(r)},65258:(e,t,s)=>{s.d(t,{BC:()=>S,CP:()=>w,L$:()=>p,MQ:()=>x,TF:()=>g,WQ:()=>h,_q:()=>R,dX:()=>m,el:()=>v,gN:()=>I,kp:()=>u,lB:()=>C,oQ:()=>y,ok:()=>_,q5:()=>f,y$:()=>b});var n=s(85431),o=s(3275),i=s(74995),r=s(53915),a=s(46815),l=s(4890),d=s(17823),c=s(76328);function u(e,t){return s=>{e(e=>({...e,[t]:s}),void 0,"assign:".concat(k(arguments)))}}function h(e,t){return s=>{e(e=>({...e,[t]:[...e[t]||[],s]}),void 0,"add:".concat(k(arguments)))}}function m(e,t,s){return()=>{e(e=>({...e,[t]:s}),void 0,"presign:".concat(k(arguments)))}}function p(e,t){return()=>{e(e=>({...e,[t]:!e[t]}),void 0,"toggle:".concat(k(arguments)))}}function g(e,t){return s=>{e(e=>({...e,[t]:n.A([s],e[t])}),void 0,"remove:".concat(k(arguments)))}}function v(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(i.A(s),[n])}}),void 0,"upsert:".concat(k(arguments)))}}function f(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:s}}),void 0,"idsert:".concat(k(arguments)))}}function I(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:[...e[t][n]||[],s]}}),void 0,"lisert:".concat(k(arguments)))}}function y(e,t,s){return(n,o)=>{let i=!1;return e(e=>{var r;return{...e,[t]:{...e[t],[n]:null==(r=e[t][n])?void 0:r.filter(e=>{let t=e[s]!==o;return t||(i=!0),t})}}},void 0,"delist:".concat(k(arguments))),i}}function S(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(i.A(s),n)}}),void 0,"append:".concat(k(arguments)))}}function C(e,t,s,n){let{subscribe:o,setState:l}=e;return o(i.A(t),(e,t)=>{l(r.A(a.A(s),n(e,t)))},{fireImmediately:!0})}function w(e,t,s,n,o){let{subscribe:l,setState:d}=e;try{let e=localStorage.getItem(s);if(null!=e){let s=JSON.parse(e);if(o){let e=o(s);d(r.A(a.A(t),e))}else d(r.A(a.A(t),s))}}catch(e){localStorage.setItem(s,JSON.stringify(n))}l(i.A(t),e=>{localStorage.setItem(s,JSON.stringify(e))})}function b(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((t,s)=>new e(t,s)),{name:t,store:t}))}function x(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((0,c.D)((t,s)=>({...new e(t,s)}))),{name:t,store:t}))}function k(e){return String([...e].slice(1))}function _(e){return{data:e,status:"success",error:null}}function R(e){return{data:null,status:"error",error:e instanceof Error?e:Error("unknown error")}}},68332:(e,t,s)=>{s.d(t,{o:()=>m});var n=s(38614),o=s(41739),i=s(17703),r=s(84499),a=s(49972),l=s(39116),d=s(12110),c=s(88382);let u=[new d.w("/chat/:chatId"),new d.w("/chat"),new d.w("/")],h=new d.w("/share/:shareLinkId");function m(){let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{push:s}=(0,r.wK)(),d=(0,c.useMemo)(()=>!!t&&u.some(e=>e.test(t)),[t]),m=(0,c.useMemo)(()=>!!t&&h.test(t),[t]),p=(0,c.useMemo)(()=>{if(m){var e;return{shareLinkId:null==(e=h.test(t))?void 0:e.shareLinkId}}},[m,t]),g=(0,c.useCallback)((t,r,l)=>{let c=n.aP.getState();c.setConversationId(t),c.setSidePanelContent(void 0);let{fetchGetConversation:u,byId:h}=a.w.getState();if(t&&l){let e=o.a.getState();u(t).then(e.upsertConversationAsTab).catch((0,i.HX)("use-chat-router:routeToConversation:addToTabs"))}if(!r)if(t){var m,p;let n=null!=(p=null==(m=h[t])?void 0:m.temporary)&&p;s({page:"chat",conversationId:t,temporary:n}),d||e.push("/chat/".concat(t))}else s({page:"main"})},[d,s,e]);return{isChatPage:d,isSharePage:m,pageData:p,routeToConversation:g,signInWithReturnTo:(0,c.useCallback)((s,n)=>{let o=new URLSearchParams({q:s||"",reasoningMode:n||"none"}).toString(),i=o?"".concat(t,"?").concat(o):t,r=i?new URLSearchParams({return_to:i}).toString():void 0;e.push("/sign-in".concat(r?"?".concat(r):""))},[e,t])}}},69648:(e,t,s)=>{s.d(t,{w:()=>a});var n=s(79342),o=s(90808),i=s(88382),r=s(61312);let a=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:a=!0,...l}=e;return(0,n.jsx)(o.b,{ref:t,decorative:a,orientation:i,className:(0,r.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...l})});a.displayName=o.b.displayName},70888:(e,t,s)=>{s.d(t,{x:()=>c});var n=s(17703),o=s(65258),i=s(56173),r=s(14908),a=s(86530).hp;let l={listByConversationId:{},fileMetaPromiseById:{},fileMetaById:{},attachListByConversationId:{}};class d{constructor(e,t){this.set=e,this.get=t,this.listByConversationId=l.listByConversationId,this.fileMetaPromiseById=l.fileMetaPromiseById,this.fileMetaById=l.fileMetaById,this.attachListByConversationId=l.attachListByConversationId,this.lisertByConversationId=(0,o.gN)(this.set,"listByConversationId"),this.removeByConversationId=(0,o.TF)(this.set,"listByConversationId"),this.delistByConversationId=(0,o.oQ)(this.set,"listByConversationId","file"),this.upsertFileMetadata=(0,o.el)(this.set,"fileMetaById","fileMetadataId"),this.idsertFileMetadataPromise=(0,o.q5)(this.set,"fileMetaPromiseById"),this.lisertAttachByConversationId=(0,o.gN)(this.set,"attachListByConversationId"),this.removeAttachByConversationId=(0,o.TF)(this.set,"attachListByConversationId"),this.delistAttachByConversationId=(0,o.oQ)(this.set,"attachListByConversationId","assetId"),this.fetchUploadFile=(e,t)=>{let s=this.get(),o=e.arrayBuffer().then(t=>i.chatApi.chatUploadFile({body:{fileName:e.name,fileMimeType:e.type,content:a.from(t).toString("base64")}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e})),r={file:e,metadataPromise:o};return s.lisertByConversationId(r,t),o.then(n=>{s.delistByConversationId(t,e)&&s.lisertByConversationId({...r,metadata:n},t)}).catch(o=>{s.delistByConversationId(t,e)&&(s.lisertByConversationId({...r,metadata:o},t),(0,n.vV)("fetchUploadFile",o))}),r},this.fetchFileMetadata=e=>{let t=this.get();if(e in t.fileMetaById)return Promise.resolve(t.fileMetaById[e]);if(e in t.fileMetaPromiseById)return t.fileMetaPromiseById[e];let s=i.chatApi.chatGetFileMetadata({fileMetadataId:e}).then(e=>e);return t.idsertFileMetadataPromise(s,e),s.then(t.upsertFileMetadata),s},this.fetchAttachThirdPartyFile=(e,t,s,o,a)=>{let l=this.get(),d=i.chatApi.chatUploadFile({body:{fileName:e,fileMimeType:t,fileSource:s,thirdPartyFileId:o}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e}),c=new File([o],e),u={file:c,metadataPromise:d};return l.lisertByConversationId(u,a),d.then(e=>{l.delistByConversationId(a,c)&&l.lisertByConversationId({...u,metadata:e},a)}).catch(e=>{l.delistByConversationId(a,c)&&(l.lisertByConversationId({...u,metadata:e},a),(0,n.vV)("fetchAttachThirdPartyFile",e)),e.message&&r.oR.error(e.message)}),u}}}let c=(0,o.y$)(d,"useFileStore")},73772:(e,t,s)=>{s.d(t,{M5:()=>p,SQ:()=>g,_2:()=>v,dc:()=>u,hO:()=>f,lv:()=>h,mB:()=>I,nV:()=>m,rI:()=>d,ty:()=>c});var n=s(79342),o=s(61312),i=s(19287),r=s(52970),a=s(39441),l=s(88382);let d=i.bL,c=i.l9;i.YJ;let u=i.ZL,h=i.Pb;i.z6;let m=l.forwardRef((e,t)=>{let{className:s,inset:a,children:l,...d}=e;return(0,n.jsxs)(i.ZP,{ref:t,className:(0,o.cn)("flex cursor-pointer select-none items-center rounded-xl px-3 py-1.5 text-sm outline-none focus:bg-button-ghost-hover data-[state=open]:bg-button-ghost-hover [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...d,children:[l,(0,n.jsx)(r.vKP,{className:"ms-auto text-fg-secondary"})]})});m.displayName=i.ZP.displayName;let p=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.G5,{ref:t,className:(0,o.cn)("z-50 overflow-hidden rounded-2xl border bg-popover p-1 text-popover-foreground shadow-lg data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})});p.displayName=i.G5.displayName;let g=l.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...a}=e;return(0,n.jsx)(i.ZL,{children:(0,n.jsx)(i.UC,{ref:t,sideOffset:r,collisionPadding:{top:16,left:16,right:16,bottom:16},className:(0,o.cn)("z-50 overflow-hidden rounded-2xl bg-surface-l4 border border-border-l1 text-primary backdrop-blur-md p-1 shadow-sm shadow-black/5","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-[--radix-dropdown-menu-content-available-height] overflow-auto",s),...a})})});g.displayName=i.UC.displayName;let v=l.forwardRef((e,t)=>{let{className:s,inset:r,...a}=e;return(0,n.jsx)(i.q7,{ref:t,className:(0,o.cn)("relative flex select-none items-center cursor-pointer px-3 py-2 rounded-xl text-sm outline-none focus:bg-button-ghost-hover aria-disabled:opacity-50 aria-disabled:cursor-not-allowed",r&&"pl-8",s),...a})});v.displayName=i.q7.displayName;let f=l.forwardRef((e,t)=>{let{className:s,children:a,checked:l,...d}=e;return(0,n.jsxs)(i.H_,{ref:t,className:(0,o.cn)("relative flex cursor-pointer select-none items-center rounded-xl py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-button-ghost-hover focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...d,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(i.VF,{children:(0,n.jsx)(r.Srz,{className:"w-4 h-4"})})}),a]})});f.displayName=i.H_.displayName,l.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,n.jsxs)(i.hN,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-popover-hover focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(i.VF,{children:(0,n.jsx)(a.A,{className:"w-2 h-2 fill-current"})})}),r]})}).displayName=i.hN.displayName,l.forwardRef((e,t)=>{let{className:s,inset:r,...a}=e;return(0,n.jsx)(i.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...a})}).displayName=i.JU.displayName;let I=l.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.wv,{ref:t,className:(0,o.cn)("mx-2 my-1 h-px bg-border-l1",s),...r})});I.displayName=i.wv.displayName},83626:(e,t,s)=>{function n(e){let t=!1;return()=>{t||(e(),t=!0)}}function o(e,t){if(void 0!==e)return t(e)}s.d(t,{F:()=>o,S:()=>n})},84499:(e,t,s)=>{s.d(t,{KQ:()=>E,N_:()=>R,wK:()=>M});var n=s(79342),o=s(38614),i=s(61884),r=s(17703),a=s(44347),l=s(39116),d=s(12110),c=s(88382),u=s(61657);let h=["conversations","attachments"],m=["name","size","used","created"],p="used",g=["image","document","spreadsheet","code","pdf"],v=["user","grok"],f=new d.w("/files"),I=new d.w("/workspace"),y=new d.w("/workspace/:id"),S=new d.w("/project"),C=new d.w("/project/:id"),w=new d.w("/chat/:id"),b=new d.w("/chat"),x=new d.w("/images"),k=new d.w("/tasks");function _(e,t){switch(e.page===t.page&&(e=function(e){let t={...e};for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}(e),e={...t,...e}),e.page){case"main":case"unknown":return{pathname:"/"};case"files":return{pathname:"/files",query:{file:e.fileId||void 0,emptyView:"default"===e.emptyView?void 0:e.emptyView,search:e.search||void 0,sort:e.sort===p?void 0:e.sort,fileType:e.fileType,createdBy:e.createdBy}};case"workspaces":return{pathname:"/project"};case"workspace":return{pathname:"/project/"+e.workspaceId,query:{tab:"attachments"!==e.tab?e.tab:void 0}};case"chat":if(e.temporary)return{pathname:"/chat"};if(!e.conversationId)return{pathname:"/"};return{pathname:"/chat/"+e.conversationId};case"images":return{pathname:"/images".concat(e.tab?"/".concat(e.tab):"")};case"tasks":return{pathname:"/tasks",query:{taskId:e.taskId||void 0,tab:e.tab||void 0}};case"plans":return{pathname:"/plans"};default:let s=e;return(0,r.vV)("routeToUrlObject","Unhandled route case:"+s),{}}}let R=(0,c.forwardRef)((e,t)=>{let{route:s,onClick:r,tooltip:d,tooltipContentProps:u,showTooltip:h=!0,...m}=e,{route:p}=M(),g=(0,c.useMemo)(()=>P(_(s,p)),[JSON.stringify(s),JSON.stringify(p)]),v=(0,l.useRouter)(),{route:f}=M(),I=(0,c.useCallback)(e=>{var t;if(null==r||r(e),!function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||2===e.button}(e)&&(e.preventDefault(),null==(t=globalThis)||t.window.history.pushState({},"",g),("unknown"===f.page||"unknown"===s.page)&&v.push(g),"main"===s.page)){let{setIsIncognito:e}=a.C$.getState();if(e(!1),"chat"===p.page){let{setOptimisticConversationId:e,setConversationId:t,setSidePanelContent:s}=o.aP.getState();e(void 0),t(void 0),s(void 0)}}},[f.page,v,r,s.page,g,p.page]);return d?(0,n.jsxs)(i.m_,{children:[(0,n.jsx)(i.k$,{asChild:!0,children:(0,n.jsx)("a",{...m,onClick:I,href:g,ref:t})}),h&&(0,n.jsx)(i.ZI,{...u,children:d})]}):(0,n.jsx)("a",{...m,onClick:I,href:g,ref:t})});function M(){let e=(0,l.usePathname)(),t=(0,l.useSearchParams)(),s=(0,c.useMemo)(()=>(function(e,t){var s,n,o,i,r;if("/"===e)return{page:"main"};if(f.test(e))return{page:"files",fileId:t.get("file")||null,emptyView:"image"===t.get("emptyView")?"image":"default",search:t.get("search")||void 0,sort:null!=(s=T(m,t.get("sort")))?s:p,fileType:T(g,t.get("fileType")),createdBy:T(v,t.get("createdBy"))};if(I.test(e)||S.test(e))return{page:"workspaces"};let a=y.test(e);if(null==a?void 0:a.id){let e=null!=(n=t.get("tab"))?n:"";return{page:"workspace",workspaceId:a.id,tab:null!=(o=T(h,e))?o:"attachments"}}let l=C.test(e);if(null==l?void 0:l.id){let e=null!=(i=t.get("tab"))?i:"";return{page:"workspace",workspaceId:l.id,tab:null!=(r=T(h,e))?r:"attachments"}}let d=w.test(e);return(null==d?void 0:d.id)?{page:"chat",conversationId:d.id,temporary:!1}:b.test(e)?{page:"chat",conversationId:null,temporary:!0}:x.test(e)?{page:"images"}:k.test(e)?{page:"tasks",taskId:t.get("taskId"),tab:t.get("tab")}:{page:"unknown"}})(e,t),[e,t.toString()]),n=(0,c.useCallback)(e=>{var t;let n=P(_(e,s));null==(t=globalThis)||t.window.history.pushState({},"",n)},[s]),o=(0,c.useCallback)(e=>{var t;let n=P(_(e,s));null==(t=globalThis)||t.window.history.replaceState({},"",n)},[s]);return(0,c.useMemo)(()=>({push:n,replace:o,route:s}),[n,o,s])}function T(e,t,s){return e.includes(t)?t:s}function P(e){if(e.query&&"string"!=typeof e.query)for(let t in e.query)void 0===e.query[t]&&delete e.query[t];return(0,u.format)(e)}function E(e,t){let s=P(_(e,e));return"".concat(t).concat(s)}},98100:(e,t,s)=>{s.d(t,{I2:()=>w,$E:()=>I,QG:()=>y,GB:()=>S});var n=s(38614),o=s(58192),i=s(6132);let r=i.z.object({modelId:i.z.string(),name:i.z.string().optional(),description:i.z.string().optional(),tags:i.z.array(i.z.string()).optional(),badgeText:i.z.string().optional()});i.z.object({models:i.z.array(r).optional().default([]),defaultFreeModel:i.z.string().optional(),defaultProModel:i.z.string().optional(),unavailableModels:i.z.array(r).optional().default([]),defaultAnonModel:i.z.string().optional()});let a=e=>["get-models",e];var l=s(56173),d=s(70888),c=s(13511),u=s(61683),h=s(38541),m=s.n(h),p=s(74995),g=s(3275),v=s(88382),f=s(75500);function I(){let e=(0,f.h)();return(0,v.useMemo)(()=>e.FORCE_SIGN_IN_MODELS.value.forceSignInModels&&Array.isArray(e.FORCE_SIGN_IN_MODELS.value.forceSignInModels)?e.FORCE_SIGN_IN_MODELS.value.forceSignInModels:[],[e.FORCE_SIGN_IN_MODELS.value])}function y(e){var t,s;let o=(0,d.x)(p.A("listByConversationId")),i=(0,d.x)(p.A("attachListByConversationId")),r=(0,n.aP)(p.A("conversationId"))||"no_conversation_id",a=(0,n.aP)(p.A("reasoningMode")),l="deepsearch"==a||"deepersearch"==a,c="think"==a,u=o[r],h=i[r],m=((null==u?void 0:u.length)||0)+((null==h?void 0:h.length)||0),g=null==e||null==(t=e.tags)?void 0:t.includes("no_attachments_for_think"),f=null==e||null==(s=e.tags)?void 0:s.includes("no_attachments_for_deepsearch"),I=!!(m&&g),y=!!(m&&f);return{isAttachDisabled:(0,v.useMemo)(()=>!!g&&!!c||!!f&&!!l,[l,c,g,f]),isThinkDisabled:I,isDeepsearchDisabled:y,isThinkSelected:c,isDeepsearchSelected:l}}function S(){var e,t,s,n,i;let d=u.Ay.language,h=(0,f.h)(),{data:I,isPending:y}=(0,c.IT)({queryKey:a(d),queryFn:async()=>{var e,t,s,n,i;return{models:((e=await l.FI.modelsGetModels({body:{locale:d}})).models||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data).sort((e,t)=>e.name===o.Wl?-1:t.name===o.Wl||e.name===o.fG?1:t.name===o.fG?-1:0),unavailableModels:(e.unavailableModels||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data),defaultAnonModelId:null!=(t=e.defaultAnonModel)?t:o.Sk,defaultFreeModelId:null!=(s=e.defaultFreeModel)?s:o.Sk,defaultProModelId:null!=(n=e.defaultProModel)?n:o.Sk,defaultHeavyModelId:null!=(i=e.defaultHeavyModel)?i:o.Sk}},staleTime:3e5}),S=(0,v.useMemo)(()=>{var e;if(!I)return[];let t=k.safeParse(h.GROK35_FLEXIBLE_INPUT.value),s=new Set(null==(e=b.safeParse(h.HIDE_MODELS.value).data)?void 0:e.hideModels);return m().sortBy(I.models.filter(e=>!s.has(e.modelId)),"name").map(e=>({...e,...C(e.modelId,t)}))},[I,h.HIDE_MODELS,h.GROK35_FLEXIBLE_INPUT]),w=(0,v.useMemo)(()=>S?g.A(p.A("modelId"),S):{},[S]);return{models:S,unavailableModels:null!=(e=null==I?void 0:I.unavailableModels)?e:[],defaultAnonModelId:null!=(t=null==I?void 0:I.defaultAnonModelId)?t:o.Sk,defaultFreeModelId:null!=(s=null==I?void 0:I.defaultFreeModelId)?s:o.Sk,defaultProModelId:null!=(n=null==I?void 0:I.defaultProModelId)?n:o.Sk,defaultHeavyModelId:null!=(i=null==I?void 0:I.defaultHeavyModelId)?i:o.Sk,modelById:w,isPending:y}}function C(e,t){var s,n,o,i,r,a,l,d;let c={modelId:e};return(null==(n=t.data)||null==(s=n[e])?void 0:s.name_override)&&(c.name=null==(a=t.data)||null==(r=a[e])?void 0:r.name_override),(null==(i=t.data)||null==(o=i[e])?void 0:o.description_override)&&(c.description=null==(d=t.data)||null==(l=d[e])?void 0:l.description_override),c}function w(e,t){return C(e,k.safeParse(t.GROK35_FLEXIBLE_INPUT.value))}let b=i.z.object({hideModels:i.z.array(i.z.string())}),x=i.z.object({name_override:i.z.string().nullish(),description_override:i.z.string().nullish()}).catch({}),k=i.z.record(i.z.string(),x).catch({})}}]);