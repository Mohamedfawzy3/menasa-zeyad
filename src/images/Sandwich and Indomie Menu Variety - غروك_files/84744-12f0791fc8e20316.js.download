!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="665c05a3-30dc-44b0-be0b-9a5e97bf7958",e._sentryDebugIdIdentifier="sentry-dbid-665c05a3-30dc-44b0-be0b-9a5e97bf7958")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[84744],{30693:(e,t,a)=>{a.d(t,{F:()=>G});var i=a(79342),s=a(13829),n=a(99241),r=a(61853),l=a(10781),o=a(55804),d=a(89890),c=a(82123),u=a(71090),p=a(3628),g=a(52871),m=a(92442),f=a(79041),v=a(39696),h=a(83686),x=a(70650),b=a(22399),y=a(29104),j=a(67014),w=a(15748),I=a(76010),S=a(31347),k=a(81361),N=a(85368),C=a(94016),A=a(96279),E=a(54376),P=a(36880),_=a(92684),M=a(17171),T=a(75486),U=a(98567),R=a(77660),D=a(8757),z=a(81588),O=a(97887),L=a(88382),K=a(65146),B=a(75500);function G(){let e=(0,B.h)();return(0,L.useMemo)(()=>{var t,a;let i=Array.isArray(null==(a=e.EDIT_IMAGE_PRESETS)||null==(t=a.value)?void 0:t.presets)?e.EDIT_IMAGE_PRESETS.value.presets:[];return{editImagePresets:H.map(e=>({...e,label:e.label,presets:e.presets.map(e=>{var t,a;return{...e,prompt:null!=(a=null==(t=i.find(t=>t.presetId===e.presetId))?void 0:t.prompt)?a:""}})})).filter(e=>e.presets.some(e=>e.prompt)).map(e=>({...e,presets:e.presets.filter(e=>e.prompt)}))}},[e])}let H=[{category:"creative",icon:s.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.categories.creative",defaults:"Creative"}),presets:[{presetId:"water-color",icon:n.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.water-color",defaults:"Watercolor"}),previewUrl:"/image-editing-preset-previews/water-color.jpg"},{presetId:"15th-century",icon:r.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.15th-century",defaults:"15th Century"}),previewUrl:"/image-editing-preset-previews/15th-century.jpg"},{presetId:"graffiti",icon:l.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.graffiti",defaults:"Graffiti"}),previewUrl:"/image-editing-preset-previews/graffiti.jpg"},{presetId:"renaissance-painting",icon:o.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.renaissance-painting",defaults:"Renaissance Painting"}),previewUrl:"/image-editing-preset-previews/renaissance-painting.jpg"},{presetId:"symbolist-painting",icon:d.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.symbolist-painting",defaults:"Symbolist Painting"}),previewUrl:"/image-editing-preset-previews/symbolist-painting.jpg"},{presetId:"expressionist-painting",icon:c.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.expressionist-painting",defaults:"Expressionist Painting"}),previewUrl:"/image-editing-preset-previews/expressionist-painting.jpg"},{presetId:"cubist-painting",icon:u.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cubist-painting",defaults:"Cubist Painting"}),previewUrl:"/image-editing-preset-previews/cubist-painting.jpg"},{presetId:"ukiyo-e-painting",icon:p.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.ukiyo-e-painting",defaults:"Ukiyo-e Painting"}),previewUrl:"/image-editing-preset-previews/ukiyo-e-painting.jpg"},{presetId:"bright-anime",icon:g.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.bright-anime",defaults:"Bright Anime"}),previewUrl:"/image-editing-preset-previews/bright-anime.jpg"},{presetId:"dark-anime",icon:m.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dark-anime",defaults:"Dark Anime"}),previewUrl:"/image-editing-preset-previews/dark-anime.jpg"},{presetId:"cyberpunk",icon:f.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cyberpunk",defaults:"Cyberpunk"}),previewUrl:"/image-editing-preset-previews/cyberpunk.jpg"},{presetId:"retro-game",icon:v.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-game",defaults:"Retro Game"}),previewUrl:"/image-editing-preset-previews/retro-game.jpg"}]},{category:"background",icon:h.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.categories.background",defaults:"Background"}),presets:[{presetId:"paris",icon:x.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.paris",defaults:"Paris"}),previewUrl:"/image-editing-preset-previews/paris.jpg"},{presetId:"london",icon:x.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.london",defaults:"London"}),previewUrl:"/image-editing-preset-previews/london.jpg"},{presetId:"tokyo",icon:x.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tokyo",defaults:"Tokyo"}),previewUrl:"/image-editing-preset-previews/tokyo.jpg"},{presetId:"mars",icon:b.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mars",defaults:"Mars"}),previewUrl:"/image-editing-preset-previews/mars.jpg"},{presetId:"tropical-paradise",icon:y.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tropical-paradise",defaults:"Tropical Paradise"}),previewUrl:"/image-editing-preset-previews/tropical-paradise.jpg"},{presetId:"cosmic-void",icon:j.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cosmic-void",defaults:"Cosmic Void"}),previewUrl:"/image-editing-preset-previews/cosmic-void.jpg"},{presetId:"urban-rooftop",icon:x.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.urban-rooftop",defaults:"Urban Rooftop"}),previewUrl:"/image-editing-preset-previews/urban-rooftop.jpg"},{presetId:"enchanted-cave",icon:w.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.enchanted-cave",defaults:"Enchanted Cave"}),previewUrl:"/image-editing-preset-previews/enchanted-cave.jpg"},{presetId:"misty-forest",icon:I.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.misty-forest",defaults:"Misty Forest"}),previewUrl:"/image-editing-preset-previews/misty-forest.jpg"},{presetId:"retro-arcade",icon:S.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-arcade",defaults:"Retro Arcade"}),previewUrl:"/image-editing-preset-previews/retro-arcade.jpg"},{presetId:"space-station",icon:k.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.space-station",defaults:"Space Station"}),previewUrl:"/image-editing-preset-previews/space-station.jpg"},{presetId:"desert-oasis",icon:y.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.desert-oasis",defaults:"Desert Oasis"}),previewUrl:"/image-editing-preset-previews/desert-oasis.jpg"},{presetId:"volcano-lair",icon:N.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.volcano-lair",defaults:"Volcano Lair"}),previewUrl:"/image-editing-preset-previews/volcano-lair.jpg"},{presetId:"post-apocalypse",icon:C.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.post-apocalypse",defaults:"Post-Apocalypse"}),previewUrl:"/image-editing-preset-previews/post-apocalypse.jpg"}]},{category:"subject",icon:A.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.categories.subject",defaults:"Subject"}),presets:[{presetId:"stylish-hat",icon:E.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.stylish-hat",defaults:"Stylish Hat"}),previewUrl:"/image-editing-preset-previews/stylish-hat.jpg"},{presetId:"mustache",icon:P.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mustache",defaults:"Mustache"}),previewUrl:"/image-editing-preset-previews/mustache.jpg"},{presetId:"superhero-costume",icon:_.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.superhero-costume",defaults:"Superhero Costume"}),previewUrl:"/image-editing-preset-previews/superhero-costume.jpg"},{presetId:"golden-glow",icon:M.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.golden-glow",defaults:"Golden Glow"}),previewUrl:"/image-editing-preset-previews/golden-glow.jpg"},{presetId:"mecha-warrior",icon:T.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mecha-warrior",defaults:"Mecha Warrior"}),previewUrl:"/image-editing-preset-previews/mecha-warrior.jpg"},{presetId:"sunglasses-jacket",icon:U.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.sunglasses-jacket",defaults:"Sunglasses & Jacket"}),previewUrl:"/image-editing-preset-previews/sunglasses-jacket.jpg"},{presetId:"medieval-armor",icon:R.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.medieval-armor",defaults:"Medieval Armor"}),previewUrl:"/image-editing-preset-previews/medieval-armor.jpg"},{presetId:"time-traveler",icon:D.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.time-traveler",defaults:"Time Traveler"}),previewUrl:"/image-editing-preset-previews/time-traveler.jpg"},{presetId:"hologram-effect",icon:z.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.hologram-effect",defaults:"Hologram Effect"}),previewUrl:"/image-editing-preset-previews/hologram-effect.jpg"},{presetId:"dragon-rider",icon:N.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dragon-rider",defaults:"Dragon Rider"}),previewUrl:"/image-editing-preset-previews/dragon-rider.jpg"},{presetId:"remove-people",icon:O.A,label:(0,i.jsx)(K.x6,{ns:"base",i18nKey:"edit-image-presets.presets.remove-people",defaults:"Remove People"}),previewUrl:"/image-editing-preset-previews/remove-people.jpg"}]}]},40016:(e,t,a)=>{a.d(t,{q:()=>m});var i=a(79342),s=a(38614),n=a(39945),r=a(61312),l=a(43893),o=a(71090),d=a(33846),c=a(74995),u=a(88382),p=a(65146),g=a(63174);let m=e=>{let{className:t,hasImage:a,inputValue:m,isStreaming:f,onInputValueChange:v,onSend:h,onAbort:x}=e,{t:b}=(0,p.Bd)("base"),y=(0,s.aP)(c.A("lastMessageId")),j=(0,s.aP)(c.A("streamedMessageId")),w=(0,l.A3)(c.A("byId")),I=(0,u.useRef)(null),S=(0,u.useRef)(null),[k,N]=(0,u.useState)(!1),C=(0,u.useMemo)(()=>f||!a,[f,a]),A=(0,u.useMemo)(()=>!k&&!f&&a&&!!m.trim(),[k,a,m,f]),E=(0,u.useCallback)(async e=>{var t;e.preventDefault(),!C&&m.trim()&&(N(!0),await (null==(t=h(m))?void 0:t.finally(()=>{var e;null==(e=S.current)||e.focus(),N(!1)})))},[h,C,m]),P=(0,u.useMemo)(()=>{let e=j?w[j]:void 0;if((null==e?void 0:e.parentResponseId)===y)return e},[j,w,y]),_=(0,u.useMemo)(()=>{if(f)return(null==P?void 0:P.state)||"closed"},[f,P]),M=(0,u.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=I.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,i.jsxs)("form",{className:(0,r.cn)("w-full rounded-[32px] p-3 bg-input-background shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset",t),onSubmit:E,ref:I,children:[(0,i.jsx)(g.A,{ref:S,className:(0,r.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5",f&&"animate-pulse"),onChange:e=>v(e.target.value),value:m,placeholder:a?f?b("Editing image","Editing image"):b("Describe your edits","Describe your edits"):b("Upload an image to begin","Upload an image to begin"),minRows:1,onKeyDown:M,autoFocus:!0,disabled:C,name:"query",maxRows:5}),(0,i.jsx)("div",{className:(0,r.cn)("ml-auto flex flex-row items-end gap-1"),children:f&&("streaming"===_||"reconnecting"===_)?(0,i.jsx)(d.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),onClick:e=>{e.preventDefault(),x().catch(console.error)},children:(0,i.jsx)("div",{className:(0,r.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,i.jsx)(o.A,{size:20})})}):(0,i.jsx)(d.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:a?{scale:1.1}:void 0,whileTap:a?{scale:.95}:void 0,className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":b("Submit","Submit"),disabled:!A,children:(0,i.jsx)("div",{className:(0,r.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",A?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,i.jsx)(n.Kp,{size:20,className:"relative"})})})})]})}},84744:(e,t,a)=>{a.d(t,{A:()=>tB});var i=a(79342),s=a(81745),n=a(44428),r=a(82591),l=a(10953),o=a(38614),d=a(39489),c=a(23856),u=a(39945),p=a(56691),g=a(30693),m=a(4295),f=a(12220),v=a(17703),h=a(71893),x=a(84969),b=a(33846),y=a(88382),j=a(65146),w=a(43086);let I=e=>{let{hasImage:t,prompt:a,onParentPeek:s,focusedImageUrl:n,parentImageUrl:r,isStreaming:l,onRegenerate:d,onClose:I}=e,{t:S}=(0,j.Bd)("base"),[k,N]=(0,y.useState)(!1),[C,A]=(0,y.useState)(void 0),[E,P]=(0,y.useState)(!1),_=(0,m.c)(),M=(0,o.aP)(e=>e.conversationId),T=(0,o.aP)(e=>e.lastMessageId),{editImagePresets:U}=(0,g.F)(),R=(0,y.useMemo)(()=>{if(!C)return;let e=U.flatMap(e=>e.presets).find(e=>e.prompt===C);return e?(0,i.jsxs)(i.Fragment,{children:[e.icon&&y.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,i.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,i.jsx)("h1",{className:"text-lg font-semibold truncate",children:C})},[C,U]),D=(0,y.useCallback)(()=>{!E&&n&&(P(!0),(0,f.G)(n,null==n?void 0:n.split("/").pop()).catch((0,v.HX)("image-editor:handleDownload")).finally(()=>P(!1)))},[n,E]);return(0,y.useEffect)(()=>{a&&C!==a&&A(a)},[a,C]),(0,y.useEffect)(()=>{r&&!k&&N(!0)},[r,k]),(0,i.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,i.jsxs)(x.N,{mode:"popLayout",children:[C&&(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:R},C),(0,i.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(0,i.jsxs)(i.Fragment,{children:[k&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":S("Compare","Compare"),tooltipContent:S("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>s(!0),onMouseUp:()=>s(!1),onMouseLeave:()=>s(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),s(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),s(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!r,children:(0,i.jsx)(b.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,i.jsx)(h.A,{className:"size-5"})})})},"compare"),(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":S("Regenerate","Regenerate"),tooltipContent:S("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!r,onClick:d,children:(0,i.jsx)(b.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,i.jsx)(u.V$,{className:"size-5"})})})},"regenerate")]}),t&&(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":S("Download Image","Download Image"),tooltipContent:S("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||E,onClick:D,children:E?(0,i.jsx)(w.y,{size:"xs"}):(0,i.jsx)(u.s3,{className:"size-5"})})},"download"),M&&T&&(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(c.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:M,responseId:T,iconProps:{size:20}})},"share")]}),_?(0,i.jsx)(p.$n,{"aria-label":S("Close Image Editor","Close Image Editor"),variant:"filled",size:"iconMd",rounded:!0,onClick:I,children:(0,i.jsx)(u.uv,{size:20})}):(0,i.jsx)(p.gx,{"aria-label":S("Close Image Editor","Close Image Editor"),tooltipContent:S("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"filled",size:"md",rounded:!0,onClick:I,children:S("Close","Close")})]})]})})};var S=a(28951),k=a(61312);let N=e=>{let{images:t,focusedOption:a,isStreaming:s,onSelect:n}=e;return(0,i.jsx)(b.P.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,i.jsx)(x.N,{mode:"popLayout",children:t.map((e,t)=>(0,i.jsx)(b.P.button,{className:(0,k.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":t===a}),onClick:()=>n(t),whileTap:t!==a?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,i.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,i.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,i.jsx)(S.L,{isModerated:e.isModerated,status:s?"streaming":"finished",iconSize:24,intermediateResults:s?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var C=a(40016),A=a(67153),E=a(75500),P=a(66408),_=a(23232),M=a(24734),T=a(4878),U=a(70888),R=a(59075),D=a(43893),z=a(44347),O=a(72359),L=a(74995),K=a(14908),B=a(94870);let G=e=>{let{isEditingCurrentImage:t,setIsPeekingParent:a,isPeekingParent:s,focusedImage:n,parentImageUrl:r,generatedImageHeight:l,generatedImageWidth:o,isFinalImageLoaded:d,setIsFinalImageLoaded:c,isParentImageLoaded:u,setIsParentImageLoaded:p}=e,[g,m]=(0,y.useState)([]),[f,v]=(0,y.useState)(!1),[h,j]=(0,y.useState)(!1),[w,I]=(0,y.useState)(!0),N=(0,y.useMemo)(()=>!!(l&&o),[l,o]),C=(0,y.useMemo)(()=>l&&o?o/l:4/3,[l,o]);return(0,y.useEffect)(()=>{(t||!w)&&(null==n?void 0:n.progressMap)?m(n.progressMap):!t&&(null==n?void 0:n.url)?m(e=>[...e,{progress:1,imageUrl:n.url||""}]):m([])},[t,null==n?void 0:n.url,null==n?void 0:n.progressMap,w]),(0,y.useEffect)(()=>{if(!f)return void a(!1);let e=setTimeout(()=>{f&&!h&&a(!0)},100);return()=>clearTimeout(e)},[f,h,a]),(0,y.useEffect)(()=>{t&&w&&I(!1),t||!d||w||I(!0)},[t,d,w]),(0,i.jsx)("figure",{className:(0,k.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!t&&r&&(s?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(s)return void e.preventDefault();j(!0)},onDragEnd:()=>{j(!1),v(!1)},onMouseDown:e=>{0===e.button&&v(!0)},onMouseUp:()=>v(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),v(!0)},onTouchEnd:e=>{e.preventDefault(),v(!1)},onMouseLeave:()=>{v(!1),j(!1)},children:(0,i.jsx)(x.N,{mode:"wait",children:t||!w?N?(0,i.jsx)(b.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:C,maxHeight:l},children:(0,i.jsx)(S.L,{status:"streaming",intermediateResults:g,isModerated:null==n?void 0:n.isModerated,aspectRatio:C})},"streaming-image"):(0,i.jsx)(H,{}):(0,i.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,i.jsxs)(i.Fragment,{children:[!d&&(0,i.jsx)(H,{className:"absolute z-20 inset-0"}),(0,i.jsx)(b.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&s||!d?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>c(!0)},"finished-image")]}),(0,i.jsx)(x.N,{children:!t&&r&&s&&(0,i.jsxs)(b.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,i.jsx)(H,{className:"absolute z-20 inset-0"}),(0,i.jsx)(b.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>p(!0)},"parent-image")]},"parent-image-container")})]})})})},H=e=>{let{className:t}=e;return(0,i.jsx)(b.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,k.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,i.jsx)(B.A,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var F=a(41320),W=a(34500),V=a(73772);let $=e=>{let{hasImage:t,onSend:a,isStreaming:s}=e,{editImagePresets:n}=(0,g.F)(),r=(0,F.Di)(),[l,o]=(0,y.useState)(null),d=(0,y.useMemo)(()=>s||!t,[s,t]),c=(0,y.useCallback)(e=>{o(t=>t===e?null:e)},[]),u=(0,y.useCallback)(e=>{if(!s)return o(null),a(e.prompt,e.presetId)},[s,a]);return(0,i.jsx)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:n.map((e,t)=>(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*t},className:"bg-surface-base rounded-full",children:r?(0,i.jsxs)(W._s,{open:e.category===l,onOpenChange:t=>{t?o(e.category):o(null)},children:[(0,i.jsx)(W.Uz,{disabled:d,asChild:!0,children:(0,i.jsx)(q,{category:e,disabled:d})}),(0,i.jsxs)(W.zj,{className:"max-h-[90dvh]",children:[(0,i.jsx)(W.BE,{children:(0,i.jsxs)(W.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&y.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,i.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,i.jsxs)(p.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>u(e),children:[e.icon&&y.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,i.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,i.jsxs)(V.rI,{open:e.category===l,onOpenChange:()=>c(e.category),children:[(0,i.jsx)(V.ty,{disabled:d,asChild:!0,children:(0,i.jsx)(q,{category:e,disabled:d})}),(0,i.jsx)(V.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onWheel:e=>e.stopPropagation(),children:e.presets.map(e=>(0,i.jsxs)(V._2,{className:"flex items-center gap-2",onClick:()=>u(e),children:[e.icon&&y.createElement(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),e.label]},e.presetId))})]})},e.category))})},q=y.forwardRef((e,t)=>{let{category:a,disabled:s,...n}=e;return(0,i.jsxs)(p.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,k.cn)(!s&&"*:hover:text-primary transition-all"),disabled:s,...n,children:[a.icon&&y.createElement(a.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,i.jsx)("span",{children:a.label})]})});var Q=a(13884),X=a(697),Y=a(95088);let J=e=>{let{onUploadImage:t}=e,{t:a}=(0,j.Bd)("base"),s=(0,U.x)(L.A("fetchUploadFile")),n=(0,U.x)(L.A("removeByConversationId")),r=(0,o.aP)(L.A("conversationId")),{ASSET_SERVER_URL:l}=(0,d.v)(),c=(0,M.K)(),u=(0,y.useRef)(null),[g,m]=(0,y.useState)(!1),[f,v]=(0,y.useState)(!1),h=(0,y.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),I=(0,y.useCallback)(async e=>{let i;if(1!==e.length)return void K.oR.error(a("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void K.oR.error(a("Only image files are allowed","Only image files are allowed"));v(!0);try{let t=s(e[0],r||"no_conversation_id");i=await t.metadataPromise}catch(e){c("image-editor-upload:uploadFile",e)}i instanceof Error&&c("image-editor-upload:uploadFile",i,a("Failed to upload file","Failed to upload file")),v(!1),n(r||"no_conversation_id"),!i||i instanceof Error||t({url:(0,T.sU)(l,i.fileUri),metadata:i})},[a,s,r,t,l,n,c]),S=(0,y.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f||m(!0)},[f]),k=(0,y.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),m(!1)},[]),N=(0,y.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),m(!1),!f)return I(Array.from(e.dataTransfer.files))},[I,f]),C=(0,y.useCallback)(e=>{if(e.target.files)return I(Array.from(e.target.files)).finally(()=>{u.current&&(u.current.value="")})},[I]);return(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:S,onDragLeave:k,onDrop:N,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(g&&!f&&"bg-surface-l1 border-border-l1"),children:(0,i.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,i.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,i.jsx)(x.N,{mode:"popLayout",children:g&&!f?(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)(Q.A,{className:"size-6"})},"files"):(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)(X.A,{className:"size-6"})},"image-plus")})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium text-primary",children:a("Upload an image to begin","Upload an image to begin")}),(0,i.jsx)(x.N,{mode:"popLayout",children:f?(0,i.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Uploading image","Uploading image")},"uploading"):g?(0,i.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drop image here","Drop image here")},"dragging"):(0,i.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,i.jsx)("div",{className:"flex gap-3",children:(0,i.jsxs)(p.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:f,autoFocus:!0,onClick:h,children:[f?(0,i.jsx)(w.y,{size:"xxs"}):(0,i.jsx)(Y.A,{className:"size-4 text-fg-secondary"}),a("Upload","Upload")]})}),(0,i.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:C,multiple:!1,"data-testid":"file-input"})]})})},Z=()=>{let{ASSET_SERVER_URL:e}=(0,d.v)(),t=(0,E.h)(),a=(0,_._)(),{t:s}=(0,j.Bd)("base"),n=(0,A.L)(),r=(0,M.K)(),{handleSendStart:l,timeToSendStart:c,consumeTimeToSendMs:u}=(0,P.Q)(),[p,g]=(0,O.Mj)("image-editor-first-open",!0),m=(0,R.j)(L.A("isOpen")),f=(0,R.j)(L.A("currentImage")),h=(0,R.j)(L.A("setImage")),b=(0,o.aP)(L.A("conversationId")),w=(0,o.aP)(L.A("streamedMessageId")),S=(0,o.aP)(L.A("lastMessageId")),k=(0,D.A3)(e=>e.byId[null!=w?w:""]),B=(0,D.A3)(L.A("byId")),H=(0,y.useMemo)(()=>{var e;return null!=(e=D.A3.getState().byConversationId[null!=b?b:""])?e:[]},[b]),[F,W]=(0,y.useState)(""),[V,q]=(0,y.useState)(!1),[Q,X]=(0,y.useState)(null),[Y,Z]=(0,y.useState)(!1),[ee,et]=(0,y.useState)(!1),[ea,ei]=(0,y.useState)(!1),[es,en]=(0,y.useState)(!1),[er,el]=(0,y.useState)(!1),eo=(0,y.useMemo)(()=>!!f,[f]),ed=(0,y.useMemo)(()=>!!(f&&"key"in f),[f]),ec=(0,y.useMemo)(()=>!!(f&&"metadata"in f),[f]),eu=(0,y.useMemo)(()=>{if(ed){if(V)return!Q&&k&&X(k.responseId),k||B[null!=Q?Q:""];let e=H.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let a=e.streamingImageById[t][100];if((null==a?void 0:a.imageUrl)===(null==f?void 0:f.url))return!0}});return e||(null==H?void 0:H.find(e=>{var t,a;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(a=f.assetKey)?a:"")}))}},[f,H,ed,V,k,Q,B]),ep=(0,y.useMemo)(()=>(null==eu?void 0:eu.parentResponseId)?B[eu.parentResponseId]:void 0,[eu,B]),eg=(0,y.useMemo)(()=>ep?(0,T.sU)(e,ep.imageEditUri):void 0,[ep,e]),em=(0,y.useMemo)(()=>{if(ec){var t,a;return[{id:null!=(t=f.metadata.fileUri)?t:"",url:null!=(a=(0,T.sU)(e,f.metadata.fileUri))?a:"",isModerated:!1,progressMap:void 0}]}return ed?eu?V&&eu.streamingImageById?Object.entries(eu.streamingImageById).map(t=>{var a;let[i,s]=t,n=Object.keys(s).map(Number),r=s[Math.max(...n)];return{id:i,url:null!=(a=(0,T.sU)(e,r.imageUrl))?a:"",isModerated:!1,progressMap:n.map(t=>{var a;return{progress:t/100,imageUrl:null!=(a=(0,T.sU)(e,s[t].imageUrl))?a:""}})}}):eu.generatedImageUrls.map(t=>{var a,i,s;let n=null!=(i=Object.values(null!=(a=eu.streamingImageById)?a:{})[0])?i:{},r=Object.keys(n).map(Number);return{id:t,url:null!=(s=(0,T.sU)(e,t))?s:"",isModerated:!1,progressMap:r.length>0?r.map(t=>{var a;return{progress:t/100,imageUrl:null!=(a=(0,T.sU)(e,n[t].imageUrl))?a:""}}):void 0}}):[]:[]},[f,eu,ed,V,e,ec]),ef=(0,y.useMemo)(()=>em.length>1?em.find(e=>e.id===(null==f?void 0:f.key)||e.id===(null==f?void 0:f.assetKey)):em[0],[em,f]),ev=(0,y.useMemo)(()=>(0,i.jsx)(G,{isEditingCurrentImage:V,focusedImage:ef,parentImageUrl:es?void 0:eg,isPeekingParent:Y,setIsPeekingParent:Z,generatedImageWidth:null==eu?void 0:eu.generatedImageWidth,generatedImageHeight:null==eu?void 0:eu.generatedImageHeight,isParentImageLoaded:ea,isFinalImageLoaded:er,setIsFinalImageLoaded:el,setIsParentImageLoaded:ei}),[V,ef,Y,eg,null==eu?void 0:eu.generatedImageWidth,null==eu?void 0:eu.generatedImageHeight,ea,er,es]),eh=(0,y.useCallback)(e=>{e&&h(e)},[h]),ex=(0,y.useCallback)(e=>{let t=em[e];V&&h({key:t.id}),h({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1})},[em,V,h]),eb=(0,y.useCallback)(async()=>{let e=o.aP.getState(),t=D.A3.getState();if(e.conversationId&&e.streamedMessageId)return et(!0),t.abortStream(e.conversationId,e.streamedMessageId).then(t=>{let a=o.aP.getState();a.conversationId===e.conversationId&&(a.setLastMessageId(t),a.setStreamedMessageId(t))}).catch(t=>{let a=o.aP.getState(),i=R.j.getState();a.conversationId===e.conversationId&&(r("image-editor:handleAbort",t),e.setStreamedMessageId(void 0),i.close())}).finally(()=>{o.aP.getState().conversationId===e.conversationId&&(e.setUsingExperiment(!1),et(!1))})},[r]),ey=(0,y.useCallback)(async(e,a)=>{if(!e.trim()||!(null==f?void 0:f.url))throw Error("No message or image");let i=o.aP.getState(),s=z.C$.getState(),r=D.A3.getState(),l=U.x.getState(),d=a.replace(/^https?:\/\/[^/]+\/?/,"");W(""),l.removeByConversationId(i.conversationId||"no_conversation_id"),l.removeAttachByConversationId(i.conversationId||"no_conversation_id"),await n();let c=i.lastMessageId?r.byId[i.lastMessageId]:void 0;if(i.lastMessageId&&!c)throw Error("Last message is missing");if((null==c?void 0:c.sender)==="human")throw Error("Last message is human");"none"!==i.reasoningMode&&i.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:d,enableRetries:t.ENABLE_AUTO_STREAM_RETRY},p=ec&&f.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[f.metadata.fileMetadataId]:[];if(ec)return i.conversationId?i.sendResponse({...u,parentResponseId:i.lastMessageId,conversationId:i.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t}):i.establishNewConversation({...u,fileAttachmentIds:[f.metadata.fileMetadataId],temporary:s.isIncognito,ff:t});if(!i.conversationId)throw Error("No conversation id");return i.sendResponse({...u,parentResponseId:i.lastMessageId,conversationId:i.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t})},[f,n,ec,ep,t]),ej=(0,y.useCallback)(async(e,t)=>{let a=o.aP.getState(),i=D.A3.getState(),s=a.streamedMessageId?i.byId[a.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==s?void 0:s.state)||"closed")&&await eb(),q(!0),ey(e,t).catch(()=>{R.j.getState().close()})},[ey,eb]),ew=(0,y.useCallback)(async(e,t)=>{if(e.trim()&&(null==ef?void 0:ef.url))return a("edit_image_start",(0,P.r)(ef.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(u())}),ej(e,ef.url).catch(e=>{(0,v.vV)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[ej,ef,a,u]),eI=(0,y.useCallback)(()=>{if((null==ep?void 0:ep.message)&&eg)return a("edit_image_start",(0,P.r)(eg),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(u())}),ej(ep.message,eg).catch(e=>{(0,v.vV)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,eg,ej,a,u]);(0,y.useEffect)(()=>{V&&em.length&&!em.find(e=>e.id===f.key)&&h({key:em[0].id})},[em,V,f,h]),(0,y.useEffect)(()=>{let t=R.j.getState();if(V&&k&&"error"===k.state)return t.close();if(V&&Q&&k&&"closed"===k.state){var i,s,n,r;if(q(!1),X(null),!S)return t.close();let l=B[S];if(!l)return t.close();let o=null==(n=l.streamingImageById)||null==(s=n[null!=(r=null==f?void 0:f.key)?r:""])||null==(i=s[100])?void 0:i.imageUrl;if(!o)return t.close();a("edit_image_end",(0,P.r)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),h({key:o,assetKey:o,url:(0,T.sU)(e,o),progress:100,isModerated:!1})}},[ep,k,V,Q,S,B,e,a,h]),(0,y.useEffect)(()=>{V||ee||void 0!==c||l()},[u,l,V,ee,c]),(0,y.useEffect)(()=>{if(null==ef?void 0:ef.url){el(!1);let e=new Image;e.onload=()=>el(!0),e.src=ef.url}},[null==ef?void 0:ef.url]),(0,y.useEffect)(()=>{if(eg){ei(!1),en(!1);let e=new Image;e.onload=()=>ei(!0),e.onerror=()=>en(!0),e.src=eg}},[eg]),(0,y.useEffect)(()=>{p&&m&&(g(!1),K.oR.message((0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-fg-primary font-bold",children:s("image-editor-welcome.title","Welcome to Image Editor")}),(0,i.jsx)("p",{className:"text-fg-secondary",children:s("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[p,m,g,s]);let eS=(0,R.j)(L.A("close"));return(0,i.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,i.jsx)(I,{hasImage:eo,prompt:eg?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==ef?void 0:ef.url,parentImageUrl:es?void 0:eg,isStreaming:V||ee,onParentPeek:e=>Z(e),onClose:eS,onRegenerate:eI}),eo?ev:m&&(0,i.jsx)(J,{onUploadImage:eh}),(0,i.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,i.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,i.jsx)(x.N,{mode:"popLayout",children:eo&&em&&em.length>1&&(0,i.jsx)(N,{isStreaming:V||ee,images:em,focusedOption:em.findIndex(e=>e.id===(null==ef?void 0:ef.id))||0,onSelect:ex})}),(0,i.jsx)($,{hasImage:eo,isStreaming:V||ee,onSend:ew}),(0,i.jsx)(C.q,{hasImage:eo,inputValue:F,isStreaming:V||ee,onInputValueChange:W,onSend:ew,onAbort:eb})]})})]})};var ee=a(13103),et=a(53592),ea=a(84852);let ei=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,_._)(),a=(0,R.j)(L.A("isOpen")),s=(0,R.j)(L.A("close")),n=(0,o.aP)(L.A("conversationId")),[r,l]=(0,y.useState)(void 0),{handleEditorOpen:d,consumeEditorTimeMs:c,editorOpenTime:u}=(0,P.Q)();return(0,y.useEffect)(()=>{a&&void 0===u?d():a||void 0===u||t("image_editor_close",void 0,{timeInEditorMs:String(c()),location:"image-editor-dialog"})},[a,d,c,t,u]),(0,y.useEffect)(()=>{n!==r&&(r&&s(),l(n))},[n,s,r]),(0,i.jsx)(et.lG,{open:a,onOpenChange:e=>{e||s()},children:(0,i.jsxs)(ee.ZJ,{children:[(0,i.jsx)(et.LC,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,i.jsxs)(et.Cf,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,k.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,i.jsx)(ea.s,{children:(0,i.jsx)(ee.L3,{children:e("image-editor.title","Image editor")})}),(0,i.jsx)(Z,{})]})]})})};var es=a(36653),en=a(49972),er=a(41739),el=a(68332);let eo=e=>{let t=(0,y.useRef)(null);return(0,y.useEffect)(()=>{let a=a=>{t.current&&!t.current.contains(a.target)&&e()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[e]),t};var ed=a(86035),ec=a(86067),eu=a(62903),ep=a(38541),eg=a.n(ep),em=a(32033),ef=a(2376),ev=a(35181),eh=a(82263),ex=a(18585),eb=a(80226);let ey=(0,y.forwardRef)((e,t)=>{let{onSelect:a,tab:s,onRemove:n,isEditing:r,newTitle:l,onNewTitleChange:o,onEditStart:d,onEditSave:c,onEditCancel:g,isActive:m=!1,isDragging:f=!1,isStreaming:v=!1,isLoading:h=!1,isReconnecting:x=!1,showActions:b,className:w,...I}=e,{t:S}=(0,j.Bd)("base"),N=(0,en.w)(L.A("fetchGetConversation")),C=(0,ev.v)(N(s.conversationId));(0,y.useEffect)(()=>{if(C.data&&(C.data.temporary!==s.isTemporary||C.data.title!==s.title)){let{upsertConversationAsTab:e}=er.a.getState();e(C.data,s.conversationId)}},[C.data,s]);let A=(0,y.useCallback)(e=>{("keydown"!==e.type||"Enter"===e.key)&&(f||(e.preventDefault(),a(s.conversationId)))},[s.conversationId,a,f]),E=(0,y.useCallback)(e=>{e.stopPropagation(),n(s.conversationId)},[s.conversationId,n]),P=(0,y.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&d(s.conversationId)},[d,s.conversationId]),_=(0,y.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&c(s.conversationId)},[c,s.conversationId]),M=(0,y.useCallback)(e=>{o(e.target.value)},[o]),T=(0,y.useCallback)(e=>{e.stopPropagation(),"Enter"===e.key?c(s.conversationId):"Escape"===e.key&&g()},[g,c,s.conversationId]),U=(0,y.useMemo)(()=>{var e;if(s.isTemporary)return S("Temporary Chat","Temporary Chat");if(s.title)return s.title;if(null==(e=C.data)?void 0:e.createTime){let e=new Date(C.data.createTime);return"".concat(S("Chat on","Chat on")," ").concat(e.toLocaleDateString())}return S("Untitled Chat","Untitled Chat")},[S,s,C.data]);return h?(0,i.jsx)(eb.E,{className:"w-full h-10 my-1 rounded-2xl"}):(0,i.jsxs)("div",{...I,ref:t,className:(0,k.cn)("group pl-3 pr-1 py-1 text-sm hover:bg-button-ghost-hover w-full h-10 flex items-center rounded-2xl border gap-1.5","focus:outline-none focus-visible:ring-1 ring-ring ring-inset",m?"bg-button-ghost-hover text-fg-primary border-border-l1":"text-fg-secondary border-transparent",w),onClick:A,onKeyDown:A,tabIndex:0,role:"button",children:[r?(0,i.jsx)("input",{className:"w-full bg-transparent focus-visible:outline-none",value:l,onKeyDown:T,onChange:M,autoFocus:!0}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ej,{isStreaming:v,isReconnecting:x,conversation:C.data}),(0,i.jsx)("span",{className:(0,k.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",!s.isPreserved&&"italic"),style:{maskImage:"linear-gradient(to right, black 85%, transparent 100%)",WebkitMaskImage:"linear-gradient(to right, black 85%, transparent 100%)"},children:U})]}),r?(0,i.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,i.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:e=>{e.stopPropagation(),g()},tooltipContent:S("Cancel","Cancel"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.uv,{size:16,className:"text-fg-primary"})}),(0,i.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:_,tooltipContent:S("Save","Save"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(eh.A,{size:16,className:"text-fg-primary"})})]}):(0,i.jsxs)("div",{className:"flex items-center justify-end",children:[!s.isTemporary&&!f&&(0,i.jsx)(p.gx,{tabIndex:-1,className:(0,k.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:P,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:S("Rename","Rename"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.rZ,{})}),!f&&(0,i.jsx)(p.gx,{className:(0,k.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:E,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:S("Close","Close"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.uv,{})})]})]})}),ej=e=>{let{conversation:t}=e,{personaById:a}=(0,ef.v5)(),s=(0,y.useMemo)(()=>{if(!(null==t?void 0:t.personaId)||!(0,ef.sS)(t.personaId))return;let e=a[t.personaId];if(e)return{...e,...(0,ex.e8)(e.personaId)}},[null==t?void 0:t.personaId,a]);return(null==t?void 0:t.temporary)?(0,i.jsx)(u.fz,{className:"h-4 w-4"}):s&&(0,i.jsx)("span",{className:(0,k.cn)("[&>svg]:h-4 [&>svg]:w-4",s.colorClassName),children:s.icon})};var ew=a(85703);function eI(e){let{id:t,element:a,children:s,options:n,isDragging:r,disabled:l=!1}=e,{attributes:o,listeners:d,setNodeRef:c,transform:u,transition:p}=(0,eu.gl)({id:t,transition:{duration:150,easing:"cubic-bezier(0.25, 1, 0.5, 1)"},disabled:l,...n}),g={transform:ew.Ks.Transform.toString(u),transition:p,opacity:+!r};return(0,i.jsx)(a||"div",{ref:c,...d,...o,style:g,children:s})}let eS=()=>{let{routeToConversation:e}=(0,el.o)(),t=(0,_._)(),a=(0,M.K)(),s=(0,er.a)(L.A("drawerOpen")),n=(0,er.a)(L.A("menuFixed")),r=(0,er.a)(L.A("menuHidden")),l=(0,er.a)(L.A("tabByConversationId")),d=(0,er.a)(L.A("inEditId")),c=(0,o.aP)(L.A("conversationId")),[g,f]=(0,y.useState)(),[h,x]=(0,y.useState)(""),[w,I]=(0,y.useState)(!1);!function(){let e=(0,o.aP)(L.A("conversationId"));(0,y.useEffect)(()=>{if(e){let{upsertConversationAsTab:t,tabByConversationId:a}=er.a.getState(),{fetchGetConversation:i}=en.w.getState();a[e]||i(e).then(e=>{t(e,void 0,!1)}).catch((0,v.HX)("use-observe-conversation-id:fetchGetConversation"))}},[e])}();let S=(0,m.c)(),{t:N}=(0,j.Bd)("base"),C=(0,y.useMemo)(()=>Object.values(l).sort((e,t)=>e.index-t.index),[l]),A=(0,y.useCallback)(a=>{let i=l[a];if(a===c){if(!i)return;if(0===i.index){let t=C[i.index+1];t?e(t.conversationId,i.isTemporary):e(void 0)}else{let t=C[i.index-1];t?e(t.conversationId,i.isTemporary):e(void 0)}}let{removeTab:s}=er.a.getState();s(a),t("close_tab",a,{location:"tabs-manager"})},[c,e,C,t,l]),E=(0,y.useCallback)(e=>{let t=l[e];if(!t)return;let{setInEditId:a}=er.a.getState();a(t.conversationId),x(t.title)},[l]),P=(0,y.useCallback)(async e=>{if(d!==e)return;let i=h.trim();if(""===i)return;let{setInEditId:s}=er.a.getState();try{let{fetchUpdateConversation:a}=en.w.getState();await a(e,{title:i}),s(void 0),t("update_conversation",e,{location:"tabs-manager"})}catch(e){a("tabs-manager:handleEditSave",e)}},[d,h,t,a]),T=eo(()=>{d&&U()}),U=(0,y.useCallback)(()=>{let{setInEditId:e}=er.a.getState();e(void 0),x("")},[]),R=(0,ed.MS)(ed.cA,{activationConstraint:{distance:8}}),D=(0,ed.FR)(R),z=(0,y.useCallback)(e=>{let{setInEditId:t}=er.a.getState();f(e.active.id),t(void 0)},[]),O=(0,y.useCallback)(e=>{let{appendTabByConversationId:a}=er.a.getState(),{active:i,over:s}=e,n=null==i?void 0:i.id,r=null==s?void 0:s.id;if(n&&r&&n!==r){let e=C.findIndex(e=>e.conversationId===n),t=C.findIndex(e=>e.conversationId===r);if(-1===e||-1===t)return;a((0,eu.be)(C,e,t).map((e,t)=>({...e,index:t})))}f(void 0),t("reorder_tab","",{location:"tabs-manager:handleDragEnd"})},[C,t]),K=(0,y.useCallback)(()=>{f(void 0)},[]),B=(0,y.useCallback)(()=>{let{setMenuHidden:e,toggleMenuFixed:t,menuFixed:a}=er.a.getState();t(),e(!a)},[]),G=(0,y.useCallback)(e=>{let{setMenuHidden:t,setInEditId:a}=er.a.getState();e.clientX>24&&t(!0),a(void 0)},[]),H=(0,y.useCallback)(e=>{let{setMenuHidden:t}=er.a.getState();e.clientX<64&&t(!1)},[]),F=(0,y.useCallback)(()=>{let{setDrawerOpen:e}=er.a.getState();e(!1)},[]),V=(0,y.useCallback)(()=>{let{setTabByConversationId:e,tabByConversationId:a,setDrawerOpen:i}=er.a.getState();e(c?eg().pick(a,c):{}),I(!1),i(!1),t("clear_all_tabs","",{location:"tabs-manager:handleClearAll"})},[c,t]),$=(0,y.useMemo)(()=>{if(!g)return;let{tabByConversationId:e}=er.a.getState();return e[g]},[g]),q=(0,y.useCallback)(a=>{let{setDrawerOpen:i,inEditId:s,upsertTab:n}=er.a.getState();if(a===s)return;U(),i(!1);let r=l[a];r&&(r.isPreserved||n({...r,isPreserved:!0}),e(r.conversationId,r.isTemporary),t("select_conversation",r.conversationId,{location:"tabs-manager"}))},[U,e,t,l]),Q=(0,y.useMemo)(()=>C.map(e=>e.conversationId),[C]),X=(0,y.useMemo)(()=>{let{tabByConversationId:e}=er.a.getState();return Object.values(e).length},[]);return S&&X>0?(0,i.jsx)(W._s,{open:s,onClose:F,dismissible:!0,children:(0,i.jsxs)(W.zj,{className:"bg-surface-base px-2 max-h-[90vh] focus:outline-none",children:[(0,i.jsxs)(W.BE,{className:"px-2 w-full pb-0 flex items-center h-8 gap-1",children:[(0,i.jsx)(W.gk,{className:"text-primary flex-1 whitespace-nowrap text-sm font-medium truncate text-left",children:N("active-tabs.label",{count:X,defaultValue_one:"Tab",defaultValue_other:"Tabs"})}),(0,i.jsx)("div",{className:"h-5 min-w-5 p-1 bg-surface-l1 text-xs flex items-center justify-center border border-border-l2 rounded-lg ms-1.5",children:X}),X>1&&(0,i.jsx)(p.$n,{className:(0,k.cn)("text-fg-secondary h-6 inline-block w-fit transition-[max-width] duration-200 ease-in-out overflow-hidden px-2",w?"opacity-100 max-w-full":"opacity-70 hover:opacity-100 max-w-6"),onClick:V,variant:"ghost",size:"iconSm",children:(0,i.jsx)(b.P.span,{variants:ek,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.2},className:"flex items-center justify-center whitespace-nowrap",children:w?(0,i.jsx)("span",{className:"text-xs font-medium",children:N("clear-tabs-button.label","Clear")}):(0,i.jsx)(u.uv,{className:"w-4 h-4"})},w?"clear":"xicon")})]}),(0,i.jsx)("div",{className:(0,k.cn)("flex flex-col z-[200] h-full w-full gap-1 py-4 min-h-[50dvh] overflow-y-auto","mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)"),children:C.map(e=>(0,i.jsx)(ey,{showActions:!0,className:"py-3 rounded-xl",isLoading:!1,isEditing:d===e.conversationId,newTitle:h,onNewTitleChange:x,onEditStart:E,onRemove:A,onEditSave:P,onEditCancel:U,tab:e,onSelect:q,isActive:c===e.conversationId,isDragging:e.conversationId===g},e.conversationId))})]})}):!S&&X>0?(0,i.jsxs)("div",{ref:T,className:(0,k.cn)("group/menu mx-1 flex flex-col absolute top-16 left-0","max-h-[calc(100dvh-80px)] h-full px-2 py-1 pb-2","z-[200]","border border-border-l1","w-52 @[1440px]/mainview:w-64","bg-surface-l3 shadow-md rounded-3xl","transition-all duration-200 ease-in-out",r?"-translate-x-[220px] @[1440px]/mainview:-translate-x-[268px] px-2 pb-2":"translate-x-0 ",n&&"@7xl/mainview:!translate-x-0 @7xl/mainview:shadow-none @7xl/mainview:bg-surface-base @7xl/mainview:border-0 @7xl/mainview:p-0"),onMouseEnter:H,onMouseLeave:G,children:[(0,i.jsx)("div",{onMouseEnter:H,className:"h-full absolute -right-6 w-6 @4xl/mainview:-right-9 @4xl/mainview:w-9"}),(0,i.jsxs)(ed.Mp,{sensors:D,collisionDetection:ed.fp,onDragStart:z,onDragEnd:O,onDragCancel:K,modifiers:[ec.gj],children:[(0,i.jsx)(eu.gB,{items:Q,strategy:eu._G,children:(0,i.jsx)("div",{className:(0,k.cn)("flex flex-col gap-1 h-full overflow-y-auto py-1","mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)"),children:C.map(e=>(0,i.jsx)(eI,{disabled:d===e.conversationId,id:e.conversationId,isDragging:e.conversationId===g,children:(0,i.jsx)(ey,{isEditing:d===e.conversationId,isLoading:!1,newTitle:h,onNewTitleChange:x,onEditStart:E,onRemove:A,onEditSave:P,onEditCancel:U,tab:e,onSelect:q,isActive:c===e.conversationId,isDragging:e.conversationId===g})},e.conversationId))})}),(0,i.jsx)(ed.Hd,{children:$?(0,i.jsx)(e=>{let{tab:t,isMobile:a}=e;return(0,i.jsx)(ey,{onRemove:A,isEditing:d===t.conversationId,newTitle:h,onNewTitleChange:x,onEditStart:E,onEditSave:P,onEditCancel:U,tab:t,onSelect:q,isActive:c===t.conversationId,isDragging:!0,showActions:a,className:(0,k.cn)(a?"py-3 rounded-xl":"","!bg-surface-l3 !text-fg-primary shadow-sm !opacity-100 absolute -translate-y-16 cursor-move z-[100]")},t.conversationId)},{tab:$,isMobile:!1}):null})]}),(0,i.jsxs)("div",{className:" flex items-center group w-full justify-between py-1 h-8 rounded-xl transition-colors focus:outline-none focus-visible:ring-1 ring-ring ring-inset max-w-full",children:[(0,i.jsx)(p.$n,{onClick:V,variant:"ghostSecondary",rounded:!0,size:"sm",className:"opacity-50 group-hover/menu:opacity-100 transition-opacity",children:(0,i.jsx)("span",{className:"text-xs font-medium",children:N("clear-tabs-button.label","Clear")})}),(0,i.jsx)(p.$n,{onClick:B,variant:"ghostSecondary",size:"iconSm",rounded:!0,"aria-label":n?N("toggle-tabs-visibility.close","Hide tabs"):N("toggle-tabs-visibility.lock","Lock tabs"),className:(0,k.cn)("hidden @4xl/mainview:flex opacity-50 group-hover/menu:opacity-100 transition-opacity"),children:(0,i.jsx)(em.A,{className:(0,k.cn)("h-4 w-4 transition-transform text-fg-secondary",n?"rotate-0":"rotate-180")})})]})]}):null},ek={initial:{opacity:0,translateX:-1},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:-1}};var eN=a(95739),eC=a(46748),eA=a(89482),eE=a(84499),eP=a(39116),e_=a(31265),eM=a(10084),eT=a(5790),eU=a(13504),eR=a(5663),eD=a(33231),ez=a(26067),eO=a(63209),eL=a(82767),eK=a(48795),eB=a(65912),eG=a(98100),eH=a(24429),eF=a(27636),eW=a(44845),eV=a(6132);let e$=eV.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport"]),eq=eV.z.object({prefix:eV.z.string().optional(),prompt:eV.z.string().optional(),label:eV.z.string(),type:e$,icon:eV.z.string().optional()}),eQ=eV.z.object({label:eV.z.string(),prompt:eV.z.string().optional(),type:e$,img:eV.z.string().optional(),description:eV.z.string().optional(),prefix:eV.z.string().optional()}),eX=["en"],eY=[{type:"createImage",prefix:"Draw ",label:"Create Images"},{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}],eJ={deepsearch:"deepsearch",brainstorm:"think",analyzeData:"think",createImage:"none",code:"none",search:"none",createReport:"none"},eZ={deepsearch:{},createReport:{},brainstorm:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},analyzeData:{},createImage:{imageGen:!0},code:{},search:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}};var e0=a(42557);let e1=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,R.j)(L.A("open")),a=(0,_._)(),{user:s}=(0,e0.wV)(),n=(0,eP.useRouter)(),r=(0,y.useCallback)(()=>{if(!s){a("sign_in_redirect",void 0,{location:"edit-image-suggestion-pill"}),n.push("/sign-in");return}a("image_editor_open",void 0,{location:"suggestion-pill"}),t()},[s,t,a,n]);return(0,i.jsxs)(p.gx,{variant:"outline",rounded:!0,tooltipProps:{delayDuration:100},tooltipContentProps:{side:"bottom",className:"bg-fg-primary text-background"},tooltipContent:s?void 0:e("Sign in to edit images","Sign in to edit images"),onClick:r,children:[(0,i.jsx)(u.mg,{size:18,strokeWidth:2,className:"text-secondary"}),(0,i.jsx)("span",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("Edit Image","Edit Image")})]})};var e2=a(21782),e8=a(92684),e4=a(48802),e6=a(10636);function e3(e){let{suggestion:t,onClick:a}=e,{label:s}=t,n=(0,y.useCallback)(()=>{a(t)},[a,t]);return(0,i.jsxs)(p.$n,{size:"md",variant:"outline",rounded:!0,onClick:n,children:[(0,i.jsx)(e9,{suggestion:t}),(0,i.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s})]})}function e5(e){let{suggestions:t,onClick:a,handleSend:s}=e,{user:n}=(0,e0.wV)(),r=(0,z.C$)(L.A("isIncognito")),l=!r,o=Math.min(t.length,5)-!!l-!!(n&&!r)-2,d=(0,e2.f)(),c=eX.includes(d);return(0,i.jsx)("div",{className:"flex flex-col gap-2",children:(0,i.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[c&&t.slice(0,o).map(e=>{let t=e.type+e.prefix+e.prompt;return(0,i.jsx)(e3,{suggestion:e,onClick:a},t)}),l&&(0,i.jsx)(e1,{}),(0,i.jsx)(ex.Ph,{handleSend:s})]})})}function e9(e){let{suggestion:t}=e,[a,s]=(0,y.useState)(!1),[n,r]=(0,y.useState)(!0);return t.icon&&!a?(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsx)(te,{suggestion:t}),(0,i.jsx)("img",{src:t.icon,alt:"".concat(t.type," icon"),className:"me-2 h-[18px] w-[18px] object-contain",onError:()=>s(!0),onLoad:()=>r(!1),style:{display:n?"none":"block"}})]}):(0,i.jsx)(te,{suggestion:t})}let e7={className:"text-secondary",strokeWidth:2,size:18};function te(e){let{suggestion:t}=e;switch(t.type){case"deepsearch":return(0,i.jsx)(u.Dd,{...e7});case"brainstorm":return(0,i.jsx)(e8.A,{...e7});case"analyzeData":case"createReport":return(0,i.jsx)(e4.A,{...e7});case"createImage":return(0,i.jsx)(u.XG,{...e7});case"code":return(0,i.jsx)(e6.A,{...e7});default:return(0,i.jsx)(i.Fragment,{})}}let tt=(e,t)=>{var a,i;let s="",n=0;for(;n<e.length&&(null==(a=e[n])?void 0:a.toLowerCase())===(null==t||null==(i=t[n])?void 0:i.toLowerCase());)s+=e[n],n++;return s},ta=e=>{let{suggestion:t}=e,a=t.label||"",s=t.prefix||"",n=a.split(" ").map(e=>({text:e,isHighlighted:!1})),r=s.split(" ");return n=n.map((e,t)=>{if(t>=r.length)return e;let a=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:a}}),(0,i.jsx)(i.Fragment,{children:n.map((e,t)=>{if(t===r.length-1&&e.text.toLowerCase().includes(r[t])){var a;let s=tt(e.text,r[t]);return(0,i.jsxs)(y.Fragment,{children:[(0,i.jsx)("span",{className:"font-medium text-primary",children:s}),(0,i.jsxs)("span",{className:"text-muted-foreground",children:[null==(a=e.text)?void 0:a.slice(null==s?void 0:s.length),"\xa0"]})]},t)}return e.isHighlighted?(0,i.jsxs)("span",{className:"font-medium text-primary",children:[e.text,"\xa0"]},t):(0,i.jsxs)("span",{className:"text-muted-foreground",children:[e.text,"\xa0"]},t)})})},ti=e=>{let{suggestions:t,currentInput:a,onClickSuggestion:s,onKeyboardSelectSuggestion:n,direction:r="column",prefix:l,setPrefix:o,position:d,setPosition:c,incrementSuggestionsShownCount:u,areReasoningModeSuggestions:p}=e,[g,m]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{if(!a&&!p){c(void 0),o("");return}if((null==a?void 0:a.includes("\n"))||(null==l?void 0:l.length)>75)return;let e=e=>{let i=null==t?void 0:t.length;if(!i||p)return;if("Backspace"===e.key){o(""),c(void 0);return}let s=0;"ArrowDown"===e.key&&(e.preventDefault(),void 0!==d&&(s=(d+1)%i),d===i-1&&(s=void 0)),"ArrowUp"===e.key&&(e.preventDefault(),void 0!==d&&(s=(d-1)%i),0===d&&(s=void 0),void 0===d&&(s=i-1)),("ArrowUp"===e.key||"ArrowDown"===e.key)&&(void 0===s&&n({label:l}),void 0===s||l||o(a),void 0!==s&&n(null==t?void 0:t[s]),c(s)),function(e){return!(e.key.length>1||e.ctrlKey||e.altKey||e.metaKey||32>e.key.charCodeAt(0))&&/[ -~]/.test(e.key)}(e)&&(o(""),c(void 0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,d,c,o,n,t,l,p]),(0,i.jsx)(b.P.ul,{className:"pb-2 overflow-hidden bg-background min-h-36",style:{display:"flex",flexDirection:r},children:(0,i.jsx)(x.N,{children:(t||[]).map((e,t)=>{let n=(0,i.jsx)(ta,{suggestion:e});return(null==e?void 0:e.img)&&!g&&(n=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:null==e?void 0:e.img,alt:"suggestion icon",className:"rounded-sm h-full me-2",onError:()=>m(!0)}),(0,i.jsx)("div",{className:"leading-[1.2]",children:(0,i.jsx)(ta,{suggestion:e})})]})),(0,i.jsx)(b.P.li,{className:(0,k.cn)("py-2 cursor-pointer sm:px-3 rounded-xl h-12 flex flex-row items-center",d===t?"sm:border-input-border-focus sm:bg-button-ghost-hover":""),onMouseEnter:()=>{void 0===d&&o(a),c(t)},initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.05}},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{var a;s(null!=(a=e.prompt)?a:e.label,null==e?void 0:e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.05*t},onAnimationComplete:()=>{null==u||u()},children:n},t)})})})};function ts(){var e;let t=null==(e=(0,E.h)().EXTRA_SUGGESTIONS.value)?void 0:e.extraSuggestions;return(0,y.useMemo)(()=>{if(t)return[...Array.isArray(t)?t.map(e=>eq.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],...eY];return eY},[t])}var tn=a(48589),tr=a(13511);let tl=e=>({ar:"SA",bn:"IN",de:"DE",en:"US",es:"ES",fa:"US",fil:"US",fr:"FR",id:"ID",it:"IT",ja:"JP",ko:"KR",nl:"NL",pl:"PL",pt:"PT",ru:"RU",sv:"SE",tr:"TR","uk-UA":"US",vi:"US",zh:"CN","zh-TW":"TW",cs:"US",hi:"US",hu:"US",mr:"US",ta:"US",te:"US"})[e]||"US",to=e=>({ar:"ar",bn:"bn",de:"de",en:"en",es:"es",fr:"fr",id:"en",it:"it",ja:"jp",ko:"ko",nl:"nl",pl:"pl",pt:"pt-pt",ru:"ru",sv:"sv",tr:"tr","uk-UA":"uk",vi:"vi",zh:"zh-hans","zh-TW":"zh-hant"})[e]||"en",td=eV.z.object({results:eV.z.array(eV.z.object({query:eV.z.string(),img:eV.z.string().optional(),description:eV.z.string().optional()}))}).catch(e=>((0,v.vV)("use-completions",e),{results:[]}));var tc=a(44465);let tu=e=>Array.isArray(e)?e.map(e=>eQ.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],tp=[{label:"Help me analyze Bitcoin during downturns",prompt:"Analyze the historical performance of Bitcoin during major global economic crises and project its potential behavior in a future downturn.",type:"analyzeData",prefix:"Help me "},{label:"Help me understand successful hedge fund strategies",prompt:"Analyze the 10 most successful options trading strategies used by hedge funds and their risk profiles.",type:"analyzeData",prefix:"Help me "},{label:"Help me predict interest rates",prompt:"Based on X post trends over the last month, what is the probability that the Fed will hold interest rates steady?",type:"analyzeData",prefix:"Help me "},{label:"How can I save on grocery bills each month?",prompt:"Explain how to save money on grocery bills each month for a family of four, step by step. Use a simple analogy, like planning a road trip where you map out the cheapest gas stations and snacks, to show strategies like meal planning, bulk buying, and using coupons.",type:"brainstorm",prefix:"How "},{label:"How would one plan and build a university in 1885?",prompt:"How much would it cost to plan and build a university in 1885?",type:"brainstorm",prefix:"How "},{label:"How would one design and build the Eiffel Tower in 1889?",prompt:"Describe the major engineering challenges and cultural motivations behind constructing the Eiffel Tower in 1889. Include details on the materials and construction techniques used, the societal and artistic influences of the time, and how the project reflected Frances technological ambitions during that era.",type:"brainstorm",prefix:"How "},{label:"Research the best gaming laptop",prompt:"Compare the best gaming laptops under $2,500 for GPU performance, cooling, and battery life.",type:"deepsearch",prefix:"Research "},{label:"Research best home kits for building your own robot",prompt:"What are the best microcontrollers and kits for building a beginner-friendly robot, comparing Arduino, Raspberry Pi, and ESP32?",type:"deepsearch",prefix:"Research "},{label:"Research best running shoes",prompt:"Compare the best running shoes for marathons based on cushioning, durability, and energy return.",type:"deepsearch",prefix:"Research "},{label:"Draw a river otter playing a ukulele",type:"createImage",prefix:"Draw "},{label:"Draw Isaac Newton with an apple falling from his hand",type:"createImage",prefix:"Draw "},{label:"Draw astronauts on the surface of the moon having a picnic in spacesuits",type:"createImage",prefix:"Draw "},{label:"Help me write a function",prompt:"Can you help me write a function? I have the requirements and need assistance with implementation.",type:"code",prefix:"Help me "},{label:"Help me debug my code",prompt:"Can you help me debug my code? I'll share the code snippet with you.",type:"code",prefix:"Help me "},{label:"Help me learn Python",prompt:"Can you help me learn Python? Start by asking me about my current level of programming knowledge.",type:"code",prefix:"Help me "}],tg=(e,t,a)=>("none"===a?tp:tp.filter(e=>{var t,a;return!(null==e||null==(a=e.label)||null==(t=a.toLowerCase())?void 0:t.startsWith("draw"))})).filter(t=>{var a;return null==t||null==(a=t.label)?void 0:a.startsWith(e)}).filter(e=>!t||(null==e?void 0:e.type)===t).map(t=>{var a;return{...t,prefix:e,label:e+(null==t||null==(a=t.label)?void 0:a.slice(null==e?void 0:e.length))}}),tm=()=>{let e=(0,E.h)(),t=(0,e2.f)(),a=null;return"en"===t&&(a=e.INPUT_SUGGESTIONS),"es"===t&&(a=e.INPUT_SUGGESTIONS_ES),"de"===t&&(a=e.INPUT_SUGGESTIONS_DE),"pt"===t&&(a=e.INPUT_SUGGESTIONS_PT),"fr"===t&&(a=e.INPUT_SUGGESTIONS_FR),"id"===t&&(a=e.INPUT_SUGGESTIONS_ID),"ja"===t&&(a=e.INPUT_SUGGESTIONS_JA),"vi"===t&&(a=e.INPUT_SUGGESTIONS_VI),"zh"===t&&(a=e.INPUT_SUGGESTIONS_ZH),{allDsSuggestions:(0,y.useMemo)(()=>{var e;return tu(null==a||null==(e=a.value)?void 0:e.deepsearchModeSuggestions)||[]},[a]),allThinkSuggestions:(0,y.useMemo)(()=>{var e;return tu(null==a||null==(e=a.value)?void 0:e.thinkModeSuggestions)||[]},[a])}},tf=Math.random(),tv=e=>{var t,a;let{prefix:i,type:s="",incrementTypeaheadReqCount:n=()=>{}}=e,r=(0,o.aP)(L.A("reasoningMode")),{allDsSuggestions:l,allThinkSuggestions:d}=tm(),{suggestions:c}=function(e){let{prefix:t,incrementTypeaheadReqCount:a=()=>{}}=e,i=(0,e2.f)(),s=(0,z.C$)(L.A("userSettings")),n=(0,e2.f)(),[r,l]=(0,y.useState)([]),o=(0,tn.o)(t,50),d=(0,E.h)(),c=ts(),u=(0,y.useMemo)(()=>r.some(e=>t.startsWith(e)),[r,t]),p=(0,y.useMemo)(()=>c.some(e=>o===e.prefix)&&"en"===i,[c,o,i]),g=!s.preferences.disableTypeahead&&d.ENABLE_BRAVE_COMPLETIONS&&!p&&!u&&o.length>0&&o.length<=400&&o.split(" ").length<=50&&o.length>=3,{data:m}=(0,tr.IT)({queryKey:["typeahead",n,o],queryFn:async()=>{let e=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",a=new URLSearchParams;a.set("q",e),a.set("rich","1"),a.set("lang",to(t)),a.set("country",tl(t));let i=Date.now();return fetch("/search?".concat(a.toString())).then(e=>e.json()).then(td.parse).then(t=>({source:"brave",msTaken:Date.now()-i,suggestions:t.results.map(t=>({label:t.query,prompt:t.query,prefix:e,type:"search",...t})).filter(t=>t.label!==e)}))}(o,n);return null==a||a(),e.suggestions.length||l(e=>[...e,o]),e},enabled:g});return m}({prefix:i,incrementTypeaheadReqCount:n})||{},{isThinkSelected:u,isDeepsearchSelected:p}=(0,eG.QG)();return!i&&p?{suggestions:null==(t=(0,tc.N)(l,tf))?void 0:t.slice(0,4),areReasoningModeSuggestions:!0}:!i&&u?{suggestions:null==(a=(0,tc.N)(d,tf))?void 0:a.slice(0,4),areReasoningModeSuggestions:!0}:tp.some(e=>i===e.prefix)?{suggestions:tg(i,s,r)}:{suggestions:c||[]}};function th(e){let{className:t,handleSend:a,position:s,setPosition:n,incrementTypeaheadReqCount:r=()=>{},incrementSuggestionsShownCount:l=()=>{},focusTextArea:d=()=>{}}=e,c=(0,o.aP)(L.A("setReasoningMode")),u=(0,E.h)(),[p,g]=(0,y.useState)(),[m,f]=(0,y.useState)(""),v=(0,o.aP)(L.A("conversationId"))||"no_conversation_id",h=(0,o.aP)(e=>e.queryByConversationId[v])||"",x=(0,y.useCallback)(e=>{let{idsetQueryByConversationId:t}=o.aP.getState();t(e,v)},[v]),{isThinkSelected:b,isDeepsearchSelected:j}=(0,eG.QG)(),w=(0,_._)(),{suggestions:I,areReasoningModeSuggestions:S}=tv({prefix:m||h,type:p,incrementTypeaheadReqCount:r});(0,y.useEffect)(()=>{h||(f(""),g(void 0))},[h]);let N=(0,y.useCallback)((e,t,a)=>{x(e),f(e),w("click_suggestion",e,{suggestionType:t,position:String(a),location:"chat-autocomplete-suggestions"})},[w,x]),C=!(0,y.useMemo)(()=>j||b?!!(null==I?void 0:I.length):!!h,[h,null==I?void 0:I.length,j,b])||!(null==I?void 0:I.length),A=(0,y.useCallback)(e=>{if(g(e.type),c(eJ[e.type]),e.prefix){var t;let a="".concat(null==(t=e.prefix)?void 0:t.trim()).concat(h?":":"");(null==h?void 0:h.includes(a))||(x("".concat(a," ").concat(h)),null==d||d())}else e.prompt&&a(e.prompt,void 0,void 0,void 0,eZ[e.type],!!u.SUGGESTIONS_USE_CACHE);w("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[x,h,a,u.SUGGESTIONS_USE_CACHE,w,c,d]),P=ts();return(0,i.jsxs)("div",{className:(0,k.cn)("z-10 w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar will-change-[mask-image] @sm:[mask-image:none] min-h-10",eL.Q,t),children:[(0,i.jsx)("div",{className:(0,k.cn)("absolute","bg-background w-full",eL.Q,"transition-opacity",I&&0!==I.length?"opacity-100":"opacity-0 pointer-events-none"),children:(0,i.jsx)(ti,{currentInput:h,suggestions:I,onClickSuggestion:N,onKeyboardSelectSuggestion:e=>x((null==e?void 0:e.label)||m),prefix:m,setPrefix:f,direction:"column",position:s,setPosition:n,incrementSuggestionsShownCount:l,areReasoningModeSuggestions:S})}),C&&(0,i.jsx)(e5,{suggestions:P,onClick:A,handleSend:a})]})}let tx=e=>{let{suggestions:t,onSelect:a,direction:s="column"}=e;return(null==t?void 0:t.length)?(0,i.jsx)(b.P.ul,{className:"pb-2 space-y-2 overflow-hidden bg-background",style:{display:"flex",flexDirection:s},children:(0,i.jsx)(x.N,{children:t.map((e,t)=>(0,i.jsx)(b.P.li,{className:"py-2 cursor-pointer sm:px-4 rounded-xl sm:hover:border-input-border-focus sm:hover:bg-button-ghost-hover",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.1}},onClick:()=>{var i;return a(null!=(i=e.prompt)?i:e.label,e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.1*t},children:(0,i.jsx)(ta,{suggestion:e})},t))})}):null};var tb=a(62810);function ty(e){let{className:t,handleSend:a,focusTextArea:s}=e,[n,r]=(0,y.useState)(),l=(0,o.aP)(L.A("setReasoningMode")),d=(0,E.h)(),c=(0,_._)(),{scrollRef:u,className:p}=(0,tb.r)(),g=(0,o.aP)(L.A("conversationId"))||"no_conversation_id",m=(0,o.aP)(L.A("idsetQueryByConversationId")),f=(0,o.aP)(e=>e.queryByConversationId[g])||"",v=(0,y.useCallback)(e=>m(e,g),[g,m]),{suggestions:h}=tv({prefix:f,type:n});(0,y.useEffect)(()=>{0===f.length&&r(void 0)},[f]);let x=(0,y.useCallback)((e,t,a)=>{v(e),null==s||s(),c("click_suggestion",e,{suggestionType:t,location:"chat-prompt-suggestions-new",sugguestion:e,position:String(a)}),r(void 0)},[c,v,s]),b=(0,y.useCallback)(e=>{l(eJ[e.type]),e.prefix?(v(e.prefix),r(e.type),null==s||s()):e.prompt&&a(e.prompt,void 0,void 0,void 0,eZ[e.type],!!d.SUGGESTIONS_USE_CACHE),c("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-prompt-suggestions:handleClickTile"})},[l,c,v,s,a,d.SUGGESTIONS_USE_CACHE]),j=ts();return(0,i.jsx)("div",{ref:u,className:(0,k.cn)("w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar",eL.Q,p,t),children:(null==h?void 0:h.length)>0?(0,i.jsx)(tx,{suggestions:null==h?void 0:h.slice(0,3),onSelect:x}):(0,i.jsx)(e5,{suggestions:j,onClick:b,handleSend:a})})}var tj=a(73304),tw=a(10684),tI=a(67811),tS=a(70907);let tk=()=>{let e=(0,_._)(),t=(0,F.Di)(),{t:a}=(0,j.Bd)("tasks"),{taskPresets:s}=(0,eF.hB)(),n=(0,tj.d)(L.A("setCreateDialogIsOpen")),r=(0,tj.d)(L.A("setTaskToEdit")),[l,o]=(0,y.useState)(tC(s)[0]),d=(0,y.useCallback)(()=>{e("task_preset_clicked",void 0,{location:"PresetTaskPill"}),n(!0),r(l)},[l,n,r,e]),c=(0,y.useCallback)(t=>{e("task_preset_clicked",void 0,{location:"PresetTaskPill"}),n(!0),r(t),o(t)},[n,r,e]);return(0,i.jsxs)("div",{className:(0,k.cn)("rounded-3xl w-full p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"max-w-[500px]":!t}),children:[(0,i.jsx)(tN,{value:l,onValueChange:c}),(0,i.jsxs)(p.$n,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:d,className:"font-semibold",children:[(0,i.jsx)(tw.A,{size:14}),t?a("create-custom-task-dialog.schedule-task-short","Schedule"):a("create-custom-task-dialog.schedule-task","Schedule Task")]})]})};function tN(e){let{value:t,onValueChange:a}=e,[s,n]=(0,y.useState)(!1),{taskPresets:r}=(0,eF.hB)(),{t:l}=(0,j.Bd)("tasks"),o=(0,F.Di)(),d=(0,y.useCallback)(e=>{n(e)},[]);return(0,i.jsxs)(V.rI,{open:s,onOpenChange:d,children:[(0,i.jsx)(V.ty,{asChild:!0,children:(0,i.jsxs)(p.$n,{className:"flex items-center font-semibold",variant:"text","aria-label":l("selected-day.label","Selected day"),size:"sm",children:[t.cta||t.name,(0,i.jsx)(tI.A,{size:14,className:(0,k.cn)("transition-transform duration-200",{"rotate-180":s})})]})}),(0,i.jsx)(V.SQ,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,k.cn)({"w-[500px]":!o}),children:tC(r).map(e=>(0,i.jsxs)(V._2,{onClick:()=>{a(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,i.jsx)(tS.A,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function tC(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}let tA=()=>(0,i.jsx)(i.Fragment,{});function tE(){var e;let{t,i18n:a}=(0,j.Bd)("chat"),{isSuperGrokUser:s,isEnterpriseUser:n,isSuperGrokProUser:r,isPending:d}=(0,eH.Q2)(),{getUserTasksQuery:c}=(0,eF.y$)({fetchActive:!0}),{data:p,isLoading:g}=c,m=(0,z.C$)(L.A("selectedLanguage")),f=(0,y.useMemo)(()=>m||a.languages.find(e=>e in ez.IV)||ez.GG,[a.languages,m]),h=(0,l.a8)({isSuperGrokPro:r,isSuperGrok:s,isEnterprise:n,language:f}),w=(0,y.useRef)(""),{signInWithReturnTo:I}=(0,el.o)(),S=(0,_._)(),N=(0,E.h)(),{handleVoiceModeEnter:C}=(0,eK.F)({location:"chat-new"}),P=(0,o.aP)(L.A("establishNewConversation")),M=(0,z.C$)(L.A("isIncognito")),T=(0,o.aP)(L.A("activeModelId")),D=(0,o.aP)(L.A("defaultAnonModelId")),O=(0,o.aP)(L.A("defaultFreeModelId")),K=(0,o.aP)(L.A("defaultProModelId")),B=(0,o.aP)(L.A("setDefaultAnonModelId")),G=(0,o.aP)(L.A("setDefaultFreeModelId")),H=(0,o.aP)(L.A("setDefaultProModelId")),W=(0,o.aP)(L.A("outputMode")),V=(0,o.aP)(L.A("reasoningMode")),$=(0,o.aP)(L.A("setReasoningMode")),q=(0,eT.iV)(L.A("open")),Q=(0,U.x)(L.A("listByConversationId")),X=(0,U.x)(L.A("attachListByConversationId")),Y=(0,R.j)(L.A("isOpen")),J=(0,y.useMemo)(()=>Q.no_conversation_id||[],[Q]),Z=(0,y.useMemo)(()=>X.no_conversation_id||[],[X]),ee=(0,eG.$E)(),et=(0,F.Di)(),ea=(0,y.useMemo)(()=>!M&&(J.length>0&&!!J.every(e=>e.file.type.includes("image"))||(null==Z?void 0:Z.length)>0&&!!Z.every(e=>e.mimeType.includes("image"))),[J,Z,M]),ei=(0,y.useMemo)(()=>!M&&N.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS&&(J.length>0&&!!J.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==Z?void 0:Z.length)>0&&!!Z.every(e=>e.mimeType.includes("csv"))),[J,Z,N.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS,M]),en=N.REPLACE_HOME_PILLS_WITH_TASKS&&(null==p||null==(e=p.tasks)?void 0:e.length)!==void 0&&0===p.tasks.length,er=(0,A.L)(),eo=(0,es.useSession)().user,ed=(0,y.useRef)(null),ec=(0,y.useCallback)(()=>{var e;null==(e=ed.current)||e.focus()},[ed]);(0,eD.v)(eR.Ib,ec,[]);let{handleKeyDown:eu,consumeCompositionTimeMs:ep,consumeBackspaceCount:eg,consumeAvgKeystrokeLatency:em,consumeKeystrokeCount:ef,position:ev,setPosition:eh,consumePosition:ex,consumeTypeaheadReqCount:eb,incrementTypeaheadReqCount:ey,incrementSuggestionsShownCount:ej,consumeSuggestionsShownCount:ew}=(0,eB.T)(),eI=(0,y.useCallback)(async(e,t,a,i,s,n,r,l,o)=>{if(!e)return!1;if(!eo&&(!N.ENABLE_ANON_USERS||ee.includes(T)))return S("sign_in","chat-new",{location:"chat-new"}),I(e,V),!1;let d=z.C$.getState(),c=ex(),u=s;return(null==N?void 0:N.ENABLE_BRAVE_COMPLETIONS)&&-1!==c&&void 0!==c&&!s&&(u={webSearch:!0}),S("send_query","",{selectedModel:T,fileAttachments:String((null==a?void 0:a.length)||0),webpageUrls:String((null==a?void 0:a.length)||0),location:"chat-new",outputMode:W,toolOverrides:JSON.stringify(u),reasoningMode:V,personalityId:d.userSettings.preferences.selectedSystemPromptId||"",personaId:(null==r?void 0:r.personaId)||"",messageLength:String(e.length),compositionTime:String(ep()),backspaceCount:String(eg()),avgKeystrokeLatency:String(em()),keystrokeCount:String(ef()),position:String(c),typeaheadRequestCount:String(eb()),suggestionsShownCount:String(ew())}),await er(),!!await P({message:e,fileAttachmentIds:a,webpageUrls:i,toolOverrides:u,temporary:null!=l?l:M,isPreset:n,persona:r,enableRetries:N.ENABLE_AUTO_STREAM_RETRY,disableMemory:o,ff:N}).catch(e=>{(0,v.vV)("chat-new:establishNewConversation",e)})},[T,eo,N,S,M,W,V,ee,er,P,em,eg,ep,ef,ex,ew,eb,I]),{modelById:eS,defaultAnonModelId:ek,defaultFreeModelId:eN,defaultProModelId:eC,isPending:eA}=(0,eG.GB)(),eE=(0,o.aP)(L.A("setActiveModelId"));(0,y.useEffect)(()=>{if(eA||d&&eo)return;let e=new URLSearchParams(location.search),t=e.get("q"),a=e.get("reasoningMode"),i=e.get("fileid"),l=location.hash===eO.oE;if(K!==eC&&(n||s||r)&&eC&&eS[eC]){H(eC),eE(eC);return}if(O!==eN&&eo&&eN&&eS[eN]){G(eN),eE(eN);return}if(D!==ek&&ek&&eS[ek]){B(ek),eE(ek);return}if(a){let e=eW.TM.parse(a);e&&$(e)}let{setUsingExperiment:c}=o.aP.getState();c(!1),t&&!w.current&&(eI(t,void 0,i?[i]:void 0,[],void 0,void 0,void 0,l,!0).catch(e=>{(0,v.vV)("chat-new:mount:handleSend",e)}),w.current="auto-start")},[eA,d]);let eP=(0,y.useCallback)(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];eI(...t).catch(e=>{(0,v.vV)("chat-new:handleClickSuggestion",e)})},[eI]),eV=(0,y.useCallback)(()=>{let e=[...J.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...Z.map(e=>e.assetId)];eI(t("create-report-prompt","Create a report"),void 0,e).catch(e=>{(0,v.vV)("chat-new:handleClickCreateReport",e)})},[eI,J,Z,t]);return(0,i.jsxs)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:[N.SHOW_GROK_4_PROMOTION_DIALOG&&(0,i.jsx)(tA,{}),(0,i.jsxs)("div",{className:"flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate",children:[(0,i.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",eL.Q),children:[(0,i.jsx)(h,{height:64,width:320}),!g&&et&&(en?(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:M}),children:(0,i.jsx)(tk,{})},"task-pill"):(0,i.jsx)(ty,{focusTextArea:ec,className:(0,k.cn)("@sm:hidden",{invisible:M}),handleSend:eP}))]}),(0,i.jsxs)("div",{className:(0,k.cn)("absolute bottom-0 mx-auto inset-x-0",eL.Q,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,i.jsxs)("div",{className:(0,k.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,i.jsx)(e_.s,{className:"mt-2",textAreaClassName:"min-h-14 pt-5 my-0 mb-5",placeholder:t("query-bar-placeholder.1","What do you want to know?"),onQuery:eI,onFrontPage:!Y,ref:ed,isIncognito:M,enableVoiceMode:!0,onKeyDown:eu,onVoiceModeEnter:C},"query-bar"),(0,i.jsxs)(x.N,{mode:"popLayout",initial:!1,children:[ea&&!M&&(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,i.jsxs)(eM.R,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,i.jsx)(u.mg,{className:"size-5 text-secondary"}),t("Edit Image","Edit Image")]})},"edit"),ei&&!M&&(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,i.jsx)(e3,{suggestion:{type:"createReport",label:t("create-report","Create Report")},onClick:eV})},"edit"),!g&&!et&&(en?(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:M}),children:(0,i.jsx)(tk,{})},"task-pill"):!et&&!ea&&!ei&&(0,i.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"w-full flex justify-center",children:(0,i.jsx)(th,{className:(0,k.cn)("hidden @sm:block overflow-visible",M&&"invisible"),handleSend:eP,position:ev,setPosition:eh,incrementTypeaheadReqCount:ey,incrementSuggestionsShownCount:ej,focusTextArea:ec})},"suggestions"))]})]}),eo?null:(0,i.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,i.jsx)(j.x6,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,i.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,i.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]}),!(n||s||r)&&!q&&(0,i.jsx)(eU.Fp,{})]})}var tP=a(48992),t_=a(39560);function tM(e){let{conversationIsLoading:t,conversationError:a,optimisticConversationId:s,conversationId:n,conversation:r}=e,l=(0,M.K)(),d=(0,o.aP)(L.A("reconnectToInflightResponses")),[c,u]=(0,y.useState)(!1),p=(0,o.aP)(L.A("setUsingExperiment")),g=(0,E.h)();return((0,y.useEffect)(()=>{if(!(null==r?void 0:r.conversationId))return;r.isNew||(u(!0),d(r.conversationId,g.ENABLE_AUTO_STREAM_RETRY,g).catch(e=>{l("chat-page:reconnectToInflightResponses",e)}).finally(()=>u(!1)));let e=D.A3.getState();p(!1),e.loadInitialResponses(r.conversationId).then(e=>{var t;let a=o.aP.getState();if(a.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,tP.Mb)(e);if(!t)return void a.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){a.setLastMessageId(t.parentResponseId),a.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){a.setLastMessageId(t.parentResponseId),a.setOptimisticMessageId(t.responseId);return}a.setLastMessageId(t.responseId)}}).catch(e=>{l("chat-page:loadInitialResponses",e)})},[null==r?void 0:r.conversationId,l]),s)?(0,i.jsx)(t_.T,{conversationId:s,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:t,conversationError:a,enableVoiceMode:!0},"chat-interaction"):n?(0,i.jsx)(t_.T,{conversationId:n,conversation:r||void 0,isOptimisticConversation:!1,conversationIsLoading:t,conversationError:a,isReconnecting:c,enableVoiceMode:!0},"chat-interaction"):null}var tT=a(52553),tU=a(92437),tR=a(40938);function tD(e){let{conversationId:t,containerRef:a,user:s}=e,{t:n}=(0,j.Bd)("chat"),r=function(e,t){let a=(0,o.aP)(L.A("activeModelId")),{modelById:i}=(0,eG.GB)(),s=null==i?void 0:i[a],{isAttachDisabled:n}=(0,eG.QG)(s),{attachFiles:r}=(0,tT.S)(),l=(0,_._)(),{user:d}=(0,es.useSession)(),c=(0,U.x)(L.A("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,tU.t)({onDrop:e=>{d&&(r(e),e.forEach(e=>{l("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>!n&&!!e.files.length&&(!c.length||!c.find(t=>t.file.name===e.files[0].name)),ref:t},[c,d,n,r])}(t,a),l=(0,o.aP)(L.A("activeModelId")),{modelById:d}=(0,eG.GB)(),c=null==d?void 0:d[l],{isAttachDisabled:u,isThinkSelected:p,isDeepsearchSelected:g}=(0,eG.QG)(c);return(0,i.jsx)(x.N,{children:r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,i.jsx)(b.P.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:s?u?(0,i.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,i.jsx)("div",{children:(0,i.jsx)(tR.A,{size:32,className:"text-red-400"})}),(0,i.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Attachments are disabled","Attachments are disabled")}),(0,i.jsxs)("p",{className:"text-secondary",children:[n("Attachments are disabled for","Attachments are disabled for")," ",(0,i.jsx)("span",{className:"font-semibold",children:p?"Think":g?"DeepSearch":void 0})]})]}):(0,i.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,i.jsx)("div",{children:(0,i.jsx)(X.A,{size:32,className:"text-secondary"})}),(0,i.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Drop your files here","Drop your files here")}),(0,i.jsx)("p",{className:"text-secondary",children:n("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,i.jsx)("div",{children:(0,i.jsx)(X.A,{size:32,className:"text-secondary"})}),(0,i.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:n("Sign in to attach files!","Sign in to attach files!")}),(0,i.jsx)("p",{className:"text-secondary",children:n("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}var tz=a(45049);let tO=e=>!!(null==e?void 0:e.liveThinkingStartTime)||!!(null==e?void 0:e.searchingStartTime),tL=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,E.h)(),[a,s]=(0,y.useState)(""),[n,r]=(0,y.useState)(0),l=(0,o.aP)(e=>null==e?void 0:e.lastMessageId),d=(0,o.aP)(e=>null==e?void 0:e.streamedMessageId),c=(0,D.A3)(e=>{var t;return null==e||null==(t=e.byId)?void 0:t[l||""]}),u=(0,D.A3)(e=>{var t;return null==e||null==(t=e.byId)?void 0:t[d||""]}),[p,g]=(0,O.Mj)("notifications-ask-count",0),m=(0,z.C$)(e=>e.userSettings.preferences.browserNotificationsEnabled);(0,y.useEffect)(()=>{if(0===n||m)return;let e=setTimeout(()=>r(e=>e+1e3),1e3);return()=>clearTimeout(e)},[n]),(0,y.useEffect)(()=>{if(!m&&tO(u)){if((null==u?void 0:u.state)==="streaming")return void r(1e3);(null==c?void 0:c.state)==="closed"&&r(0)}},[null==u?void 0:u.state,null==c?void 0:c.state]),(0,y.useEffect)(()=>{let e=n>=6e3&&n<7e3;!a&&!m&&e&&!(p>=2)&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&(s((0,K.oR)((0,i.jsx)(tK,{onDismiss:f}),{duration:1/0,className:"inset-x-0 mx-auto"})),g(p+1))},[a,n]),(0,y.useEffect)(()=>{m&&((null==c?void 0:c.liveThinkingStartTime)||(null==c?void 0:c.searchingStartTime))&&(null==c?void 0:c.state)==="closed"&&v()},[c]);let f=()=>{K.oR.dismiss(a),s("")},v=()=>{var a;if((null==(a=document)||!a.hasFocus())&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)){if(null==u?void 0:u.searchingStartTime)return void new Notification(e("notifications_answer_ready_search",'Your "DeepSearch" answer is ready'));new Notification(e("notifications_answer_ready",'Your "Think" answer is ready'))}};return v},tK=e=>{let{onDismiss:t=()=>{}}=e,{t:a}=(0,j.Bd)("base"),[s,n]=(0,y.useState)("ASK"),r=(0,z.C$)(L.A("fetchSetPreference")),l=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,y.useEffect)(()=>{if("ASK"===s){let e=setTimeout(()=>t(),4e3);return()=>clearTimeout(e)}if("WAIT"===s)return;let e=setTimeout(()=>t(),2e3);return()=>clearTimeout(e)},[s]),(0,m.f)()||"DENIED"===s)?null:"ALLOWED"===s?(0,i.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,i.jsx)(eh.A,{className:"size-5"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_enabled_title","Notifications enabled")}),(0,i.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,i.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[348px]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(tz.A,{className:"size-5"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_ask_title","Get notified when answer ready")}),(0,i.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_ask_subtitle","Enable notifications")})]})]}),(0,i.jsx)(p.$n,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===s,onClick:l,children:a("notifications_enable","Enable")})]})};function tB(){let e=(0,eP.useSearchParams)(),t=(0,E.h)(),a=(0,M.K)(),{user:l}=(0,es.useSession)(),d=(0,o.aP)(L.A("optimisticConversationId")),c=(0,o.aP)(L.A("conversationId")),u=(0,en.w)(L.A("fetchGetConversation")),p=(0,o.aP)(L.A("conversationMode")),g=(0,o.aP)(L.A("exitVoiceMode")),m=(0,z.C$)(e=>e.userSettings.preferences.showActiveTabs),f=(0,R.j)(L.A("isOpen")),{route:v,replace:h}=(0,eE.wK)();(0,y.useEffect)(()=>{var e;if("chat"===v.page&&v.temporary)return;let t="chat"===v.page&&null!=(e=v.conversationId)?e:void 0;o.aP.setState({conversationId:t})},[v]);let x=e.get("reasoningMode");(0,y.useEffect)(()=>{x&&h({...v})},[v,x,h]),tL(),function(){let e=(0,eP.useSearchParams)(),{t}=(0,j.Bd)("chat"),a=(0,eP.useRouter)(),i=(0,y.useRef)(!1),s=e.get(eN.il),n=(0,eA.M4)(s||"");(0,y.useEffect)(()=>{if(!i.current&&s){setTimeout(()=>K.oR.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),i.current=!0;let e=new URL(window.location.href);e.searchParams.delete(eN.il),a.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,s,a,t])}(),function(e){let t=(0,en.w)(t=>e?t.byId[e]:void 0);(0,eC.r)(null==t?void 0:t.title)}(c);let{data:b,isLoading:w,error:I}=(0,ev.v)(c?u(c):void 0);(0,y.useEffect)(()=>{o.aP.getState().setChatPageLoaded(!0)},[]),(0,y.useEffect)(()=>{f&&"voice"===p&&g("navigation").catch(e=>{a("chat-page:exitVoiceMode",e)})},[f,p,g,a]);let S=(0,y.useRef)(null);return(0,i.jsx)(r.t,{fallbackRender:()=>(0,i.jsx)(tG,{}),children:(0,i.jsxs)("main",{ref:S,className:(0,k.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[(0,i.jsx)(n.a,{hidden:!0}),(0,i.jsx)(tD,{conversationId:c,containerRef:S,user:l}),(0,i.jsx)(eO.hx,{showTasks:!0,conversationIsLoading:w,conversation:b||void 0,isOptimisticConversation:!!d}),(0,i.jsx)(s.CommandMenu,{}),d||c?(0,i.jsx)(tM,{optimisticConversationId:d,conversationIsLoading:w,conversationError:I,conversationId:c,conversation:b},"conversation-view"):(0,i.jsx)(tE,{}),(0,i.jsx)(ei,{}),t.ENABLE_CONVERSATION_TABS&&!t.USE_APP_SIDEBAR_V2&&m&&(0,i.jsx)(eS,{})]},"chat-page")})}function tG(){let{t:e}=(0,j.Bd)("chat");return(0,i.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,i.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,i.jsx)(eE.N_,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,i.jsx)(l.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,i.jsx)("div",{children:e("There was an error","There was an error")}),(0,i.jsx)("div",{className:"mt-6",children:(0,i.jsx)(p.$n,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}}}]);